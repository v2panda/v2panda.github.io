<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title><![CDATA[v2panda's blog]]></title>
  <subtitle><![CDATA[subtitle]]></subtitle>
  <link href="/atom.xml" rel="self"/>
  <link href="http://v2panda.com/"/>
  <updated>2016-08-15T13:00:53.000Z</updated>
  <id>http://v2panda.com/</id>
  
  <author>
    <name><![CDATA[ç†ŠçŒ«]]></name>
    <email><![CDATA[pdxuzhen@gmail.com]]></email>
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title><![CDATA[ã€è¯‘ã€‘Xcode Search the Hidden Gems]]></title>
    <link href="http://v2panda.com/2016/08/15/xcodesearch/"/>
    <id>http://v2panda.com/2016/08/15/xcodesearch/</id>
    <published>2016-08-15T12:44:08.000Z</published>
    <updated>2016-08-15T13:00:53.000Z</updated>
    <content type="html"><![CDATA[<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_0.png" alt=""></p>
<p>ä½œä¸ºè½¯ä»¶å¼€å‘äººå‘˜,æˆ‘ä»¬å¸¸å¸¸ä¼šèŠ±å¤§é‡æ—¶é—´å»é˜…è¯»ä»£ç ã€‚ <a href="https://twitter.com/unclebobmartin" target="_blank" rel="external">Robert C. Martin</a> åœ¨ä»–çš„<a href="http://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882" target="_blank" rel="external">Clean Code</a>ä¸­è¯´é“:</p>
<blockquote>
<p>Indeed, the ratio of time spent reading versus writing is well over 10 to 1. We are constantly reading old code as part of the effort to write new code.</p>
</blockquote>
<p>ç„¶è€Œç›´æ¥é˜…è¯»æ•´ä¸ªä»£ç åº“æ˜¯ä¸å®é™…çš„ï¼Œå½“ä½ åŠ å…¥ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œæµè§ˆä¸€äº›å¼€æºåº“æˆ–ç€ä¸ºä¸€ä¸ªå¤§å‹ä»£ç åº“æäº¤ä»£ç ã€‚æœç´¢å°±ä¼šæˆä¸ºä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†å»æ·±å…¥äº†è§£éšè—åœ¨ Xcode çš„å¯¼èˆªå™¨é‡Œçš„æœç´¢ã€‚</p>
<a id="more"></a>
<h3 id="1_:_Patterns">1 : Patterns</h3><p>ç›´æ¥åœ¨ Xcode æœç´¢æ–‡æœ¬æ˜¯éå¸¸å®¹æ˜“çš„ï¼ŒæŒ‰ä¸‹ Command-Shift-F è¾“å…¥ä½ æƒ³æœç´¢çš„æ–‡æœ¬å°±å¯ä»¥äº†ã€‚è€Œä»…ä»…è¿™æ ·æ˜¯ä¸å¤Ÿçš„ï¼Œå½“æˆ‘ä»¬æƒ³è¦ä¸€ä¸ªæ›´é«˜çº§çš„æœç´¢ï¼Œæ¯”å¦‚æƒ³è¦æœç´¢ä¸€ä¸ªåŒ…å« URLs çš„å­—ç¬¦ä¸²ã€‚è¿™æ˜¯å¾ˆå¸¸è§çš„éœ€æ±‚ï¼Œè‹¹æœä¹Ÿå¸®æˆ‘ä»¬å®ç°äº†è¿™ä¸ªåŠŸèƒ½å³ â€“ é€šé…ç¬¦æ¨¡å¼ã€‚</p>
<p>é¦–å…ˆå•å‡»æ”¾å¤§é•œæŒ‰é’®æ—è¾¹çš„ä¸‹æ‹‰æŒ‰é’®ï¼Œå¦‚ä¸‹å›¾ï¼š</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_1.png" alt="Search Options"></p>
<p>ç„¶åä¼šçœ‹åˆ°ä¸€ä¸ªä¸‹æ‹‰é€‰æ‹©åˆ—è¡¨ï¼š</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_2.png" alt="List of Available Patterns"></p>
<p>ç‚¹å‡»åˆ—è¡¨ä¸­çš„ URL æ¨¡å¼æœç´¢å­—æ®µï¼Œå°±ä¼šå¾—åˆ°æƒ³è¦çš„ç»“æœï¼š</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_3.png" alt="Strings Representing URLs"></p>
<h3 id="2_:_Definitions">2 : Definitions</h3><p>Xcode è¿˜æä¾›äº†æœç´¢é€‰é¡¹æ¥å¸®åŠ©æˆ‘ä»¬ç†è§£é¡¹ç›®ä»£ç ç»“æ„ã€‚æ¯”æ–¹è¯´ï¼Œæƒ³æœç´¢åˆ°é¡¹ç›®ä¸­æ‰€æœ‰å¸¦ shared çš„å®šä¹‰ï¼Œè€Œä¸”å‡è®¾é¡¹ç›®ä¸­æ‰€æœ‰çš„å•ä¾‹ä¹Ÿæ˜¯ä»¥ <code>shared</code> å¼€å¤´ï¼Œç±»ä¼¼ <code>shared*</code>ã€‚</p>
<p>å¦‚æœä»…ä»…æœç´¢ <code>shared</code>ï¼Œä¼šå¾—åˆ°å¾ˆå¤šç»“æœï¼š</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_4.png" alt="Default Search Results"></p>
<p>è¿™å½“ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ï¼Œç‚¹å‡» Text åˆ‡æ¢é€‰æ‹©åˆ° Definitions æ¥ç¼©å°æœç´¢ç»“æœï¼š</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_5.png" alt="Definitions Option
"></p>
<p>å°±åƒè¿™æ ·ï¼š</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_6.png" alt="Search Results Narrowed to Definitions"></p>
<p>å¾—åˆ°äº†æˆ‘ä»¬æƒ³è¦çš„ç»“æœï¼Œå½“ç„¶ä¹Ÿå¯ä»¥ä½¿ç”¨è¿™ä¸ªå»è¿‡æ»¤ç»“æ„ä½“ã€æšä¸¾ã€æšä¸¾é€‰é¡¹ç­‰ç­‰ã€‚</p>
<h3 id="3:_Search_Scopes">3: Search Scopes</h3><p>é€‰æ‹©ä¸€ä¸ªç»å¸¸è¦æœç´¢çš„é¡¹ç›®:</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_7.png" alt="Scopes Menu"></p>
<p>è®©æˆ‘ä»¬æƒ³è±¡ä¸€ä¸‹ï¼Œå‡å¦‚æˆ‘ä»¬çš„é¡¹ç›®æ˜¯ Objective-C/Swift ä»£ç æ··åˆçš„ä»£ç åº“ã€‚(å®ƒä¸æ˜¯å¾ˆéš¾æƒ³è±¡,å¯¹å§?ğŸ˜‰)ã€‚è¿™æ—¶æˆ‘ä»¬æƒ³åœ¨ Swift æ–‡ä»¶é‡Œæœç´¢äº›ä¸œè¥¿ï¼Œæˆ‘ä»¬å¯ä»¥å¾ˆå®¹æ˜“çš„è‡ªå®šä¹‰æœç´¢èŒƒå›´ã€‚ç‚¹å‡» <em>New Scope</em> æŒ‰é’®ï¼Œé€‰æ‹©æœç´¢ç»“æœçš„è¿‡æ»¤ï¼š<em>Location, Name, Path, Path Extension and Type</em>ã€‚Type ä¼¼ä¹æ˜¯ä¸€ä¸ªéå¸¸åˆé€‚çš„é€‰æ‹©ï¼Œä½†ä¸å¹¸çš„æ˜¯ï¼Œè¿™é‡Œæ²¡æœ‰ Swift :</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_8.png" alt="No Swift here Â¯\_(ãƒ„)_/Â¯"></p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬ç”¨ <em>Path Extension</em> æ¥æ›¿ä»£ï¼Œå¦‚ï¼š</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_9.png" alt="Scope Filtering .swift Files"></p>
<h3 id="4:_Call_Hierarchy">4: Call Hierarchy</h3><p>Xcode 7ä¸­å¢åŠ äº†ä¸€ä¸ªæ–°åŠŸèƒ½ï¼Œå¯ä»¥ç›´æ¥æœç´¢è°ƒç”¨çš„å±‚æ¬¡ç»“æ„ã€‚é€šè¿‡å®ƒï¼Œæˆ‘ä»¬å¯ä»¥æ›´ç›´è§‚çš„æŸ¥çœ‹æˆ–ä½¿ç”¨æ–¹æ³•å’Œå‡½æ•°ã€‚æˆ‘ä¸ç»å¸¸ä½¿ç”¨å®ƒï¼Œä½†æ˜¯å½“æˆ‘ç”¨åˆ°å®ƒæ—¶ä¼šèŠ‚çœå¾ˆå¤šæ—¶é—´ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_10.png" alt="Call Hierarchy Search Example"></p>
<h3 id="When_Not_to_Search">When Not to Search</h3><p>åœ¨Xcodeä¸­ Find navigator éå¸¸å¼ºå¤§ï¼Œå®ƒä¸ä»…ä»…åªæœ‰æœç´¢åŠŸèƒ½ã€‚å½“æˆ‘ä»¬è¦æ‰¾ä¸œè¥¿æ—¶ï¼Œæœç´¢å¹¶ä¸æ€»æ˜¯æœ€å¥½çš„è§£å†³æ–¹æ³•ã€‚ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬è¦æŸ¥çœ‹ä¸€äº›å±æ€§çš„å®šä¹‰æ—¶ï¼Œæœ€å¥½çš„æ–¹æ³•æ˜¯å°†é¼ æ ‡ç§»åŠ¨åˆ°å±æ€§ä¸Šå¹¶æŒ‰ä¸‹ Command-Control-J æŸ¥çœ‹ï¼Œè¿™æ ·æ¯”ç›´æ¥æœç´¢å®ƒçš„å®šä¹‰è¦å¥½å¾—å¤šã€‚æˆ–è€…å½“æˆ‘ä»¬æƒ³çœ‹çœ‹æŸäº›æ–¹æ³•çš„è°ƒç”¨æƒ…å†µï¼Œæˆ‘ä»¬å¯ä»¥ç›´æ¥æŒ‰ä¸‹(Control-1)èœå•æ¥æŸ¥çœ‹ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_11.png" alt="Related Items Menu"></p>
<h3 id="Conclusion">Conclusion</h3><p>æœç´¢åœ¨ Xcode ä¸­å˜å¾—è¶Šæ¥è¶Šå¼ºå¤§ï¼Œå®ƒå¸®åŠ©æˆ‘ä»¬æ›´å®¹æ˜“çš„é˜…è¯»è‡ªå·±çš„ä»£ç æˆ–ç¬¬ä¸‰æ–¹ä»£ç ã€‚æ­£å¦‚æ‰€æœ‰å…¶ä»–å·¥å…·(æˆ–ä»»ä½•ç”Ÿæ´»ä¸­)ä¸€æ ·ï¼Œå®ƒä¹Ÿå¸¦æœ‰ä¸€äº›æƒè¡¡ï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥é€‰æ‹©ä½¿ç”¨æœ€å¥½çš„å·¥å…·æ¥å·¥ä½œã€‚</p>
<blockquote>
<p>ä½œè€…:Arkadiusz Holko</p>
<p>åŸæ–‡é“¾æ¥:<a href="http://holko.pl/2016/04/26/xcode-search/" target="_blank" rel="external">http://holko.pl/2016/04/26/xcode-search/</a></p>
<p>åŸæ–‡æ—¥æœŸ:26 Apr 2016</p>
</blockquote>
]]></content>
    <summary type="html">
    <![CDATA[<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/xcodesearch_0.png" alt=""></p>
<p>ä½œä¸ºè½¯ä»¶å¼€å‘äººå‘˜,æˆ‘ä»¬å¸¸å¸¸ä¼šèŠ±å¤§é‡æ—¶é—´å»é˜…è¯»ä»£ç ã€‚ <a href="https://twitter.com/unclebobmartin">Robert C. Martin</a> åœ¨ä»–çš„<a href="http://www.amazon.com/Clean-Code-Handbook-Software-Craftsmanship/dp/0132350882">Clean Code</a>ä¸­è¯´é“:</p>
<blockquote>
<p>Indeed, the ratio of time spent reading versus writing is well over 10 to 1. We are constantly reading old code as part of the effort to write new code.</p>
</blockquote>
<p>ç„¶è€Œç›´æ¥é˜…è¯»æ•´ä¸ªä»£ç åº“æ˜¯ä¸å®é™…çš„ï¼Œå½“ä½ åŠ å…¥ä¸€ä¸ªæ–°é¡¹ç›®ï¼Œæµè§ˆä¸€äº›å¼€æºåº“æˆ–ç€ä¸ºä¸€ä¸ªå¤§å‹ä»£ç åº“æäº¤ä»£ç ã€‚æœç´¢å°±ä¼šæˆä¸ºä¸€ä¸ªéå¸¸æœ‰ç”¨çš„å·¥å…·ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬å°†å»æ·±å…¥äº†è§£éšè—åœ¨ Xcode çš„å¯¼èˆªå™¨é‡Œçš„æœç´¢ã€‚</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[iOSå•å…ƒæµ‹è¯•]]></title>
    <link href="http://v2panda.com/2016/07/31/unit-tests/"/>
    <id>http://v2panda.com/2016/07/31/unit-tests/</id>
    <published>2016-07-31T03:22:13.000Z</published>
    <updated>2016-07-31T03:27:24.000Z</updated>
    <content type="html"><![CDATA[<h3 id="å‰è¨€">å‰è¨€</h3><p>ä¸å†™å•å…ƒæµ‹è¯•çš„ç¨‹åºå‘˜æ˜¯ä¸åˆæ ¼çš„ï¼Œä¸ºäº†è®©è‡ªå·±æˆä¸ºä¸€ååˆæ ¼çš„ç¨‹åºå‘˜ï¼Œå­¦ä¹ å¦‚ä½•å†™å•å…ƒæµ‹è¯•æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œè¿™é‡Œä»¥Xcodeé›†æˆçš„æµ‹è¯•æ¡†æ¶<a href="https://developer.apple.com/reference/xctest" target="_blank" rel="external">XCTest</a>ä¸ºä¾‹ã€‚æœ¬æ–‡é¦–å…ˆä¼šä»‹ç»XCTestå•å…ƒæµ‹è¯•çš„åŸºç¡€ç”¨æ³•ï¼Œç„¶åç»“åˆå…·ä½“çš„å®ä¾‹åˆ†æï¼Œæœ€ååŠ¨æ‰‹å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ã€‚</p>
<a id="more"></a>
<h3 id="XCTest">XCTest</h3><h5 id="åŸºç¡€ç”¨æ³•">åŸºç¡€ç”¨æ³•</h5><p>é»˜è®¤çš„æµ‹è¯•ç±»ç»§æ‰¿è‡ª<code>XCTestCase</code>ï¼Œå½“ç„¶ä¹Ÿå¯ä»¥è‡ªå®šä¹‰æµ‹è¯•ç±»ï¼Œæ·»åŠ ä¸€äº›å…¬å…±çš„è¾…åŠ©æ–¹æ³•ã€‚ä¾‹å¦‚<code>AFNetworking</code>çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ç±»éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„çˆ¶ç±»<code>AFTestCase</code>ï¼Œå®ƒæ˜¯XCTestCaseçš„å­ç±»ï¼Œ<code>AFNetworking</code>æ‰€æœ‰æµ‹è¯•ç±»éƒ½æ˜¯AFTestCaseç±»çš„å­ç±»ï¼Œè¿™å—åœ¨åé¢ä¼šå…·ä½“è®²åˆ°ã€‚éœ€è¦é¢å¤–æ³¨æ„çš„æ˜¯æ‰€æœ‰çš„æµ‹è¯•æ–¹æ³•éƒ½å¿…é¡»ä»¥<code>test</code>å¼€å¤´ï¼Œä¸”ä¸èƒ½æœ‰å‚æ•°ï¼Œä¸ç„¶ä¸ä¼šè¯†åˆ«ä¸ºæµ‹è¯•æ–¹æ³•ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@interface</span> <span class="attribute">DemoUnitTestsTests </span>: XCTestCase</span><br><span class="line"></span><br><span class="line"><span class="variable">@end</span></span><br><span class="line"></span><br><span class="line"><span class="variable">@implementation</span> DemoUnitTestsTests</span><br><span class="line"><span class="comment">// åœ¨æ¯ä¸€ä¸ªæµ‹è¯•ç”¨ä¾‹å¼€å§‹å‰è°ƒç”¨ï¼Œç”¨æ¥åˆå§‹åŒ–ç›¸å…³æ•°æ®</span></span><br><span class="line">- (void)setUp &#123;</span><br><span class="line">Â  Â  <span class="attr_selector">[super setUp]</span>;</span><br><span class="line">Â  Â  <span class="comment">// Put setup code here. This method is called before the invocation of each test method in the class.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨æµ‹è¯•ç”¨ä¾‹å®Œæˆåè°ƒç”¨ï¼Œå¯ä»¥ç”¨æ¥é‡Šæ”¾å˜é‡ç­‰ç»“å°¾æ“ä½œ</span></span><br><span class="line">- (void)tearDown &#123;</span><br><span class="line">Â  Â  <span class="comment">// Put teardown code here. This method is called after the invocation of each test method in the class.</span></span><br><span class="line">Â  Â  <span class="attr_selector">[super tearDown]</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æµ‹è¯•æ–¹æ³•  </span></span><br><span class="line">- (void)testExample &#123;</span><br><span class="line">Â  Â  <span class="comment">// This is an example of a functional test case.</span></span><br><span class="line">Â  Â  <span class="comment">// Use XCTAssert and related functions to verify your tests produce the correct results.</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ€§èƒ½æµ‹è¯•æ–¹æ³•ï¼Œé€šè¿‡æµ‹è¯•blockä¸­æ–¹æ³•æ‰§è¡Œçš„æ—¶é—´ï¼Œæ¯”å¯¹è®¾å®šçš„æ ‡å‡†å€¼å’Œåå·®è§‰å¾—æ˜¯å¦å¯ä»¥é€šè¿‡æµ‹è¯•</span></span><br><span class="line">- (void)testPerformanceExample &#123;</span><br><span class="line">Â  Â  <span class="comment">// This is an example of a performance test case.</span></span><br><span class="line">Â  Â  <span class="attr_selector">[self measureBlock:^&#123;</span><br><span class="line">Â  Â  Â  Â  // Put the code you want to measure the time of here.</span><br><span class="line">Â  Â  &#125;]</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="æ–­è¨€">æ–­è¨€</h5><p>XCTestçš„æ–­è¨€å…·ä½“å¯æŸ¥é˜…<code>XCTestAssertions.h</code>æ–‡ä»¶ï¼Œè¿™é‡Œè¿˜æ˜¯åšä¸ªç®€å•çš„æ€»ç»“</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//é€šç”¨æ–­è¨€</span></span><br><span class="line"><span class="function"><span class="title">XCTFail</span><span class="params">(formatâ€¦)</span></span></span><br><span class="line"><span class="comment">//ä¸ºç©ºåˆ¤æ–­ï¼Œa1ä¸ºç©ºæ—¶é€šè¿‡ï¼Œåä¹‹ä¸é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertNil</span><span class="params">(a1, format...)</span></span></span><br><span class="line"><span class="comment">//ä¸ä¸ºç©ºåˆ¤æ–­ï¼Œa1ä¸ä¸ºç©ºæ—¶é€šè¿‡ï¼Œåä¹‹ä¸é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertNotNil</span><span class="params">(a1, formatâ€¦)</span></span></span><br><span class="line"><span class="comment">//å½“expressionæ±‚å€¼ä¸ºTRUEæ—¶é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssert</span><span class="params">(expression, format...)</span></span> </span><br><span class="line"><span class="comment">//å½“expressionæ±‚å€¼ä¸ºTRUEæ—¶é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertTrue</span><span class="params">(expression, format...)</span></span> </span><br><span class="line"><span class="comment">//å½“expressionæ±‚å€¼ä¸ºFalseæ—¶é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertFalse</span><span class="params">(expression, format...)</span></span> </span><br><span class="line"><span class="comment">//åˆ¤æ–­ç›¸ç­‰ï¼Œ[a1 isEqual:a2]å€¼ä¸ºTRUEæ—¶é€šè¿‡ï¼Œå…¶ä¸­ä¸€ä¸ªä¸ä¸ºç©ºæ—¶ï¼Œä¸é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertEqualObjects</span><span class="params">(a1, a2, format...)</span></span> </span><br><span class="line"><span class="comment">//åˆ¤æ–­ä¸ç­‰ï¼Œ[a1 isEqual:a2]å€¼ä¸ºFalseæ—¶é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertNotEqualObjects</span><span class="params">(a1, a2, format...)</span></span> </span><br><span class="line"><span class="comment">//åˆ¤æ–­ç›¸ç­‰ï¼ˆå½“a1å’Œa2æ˜¯ Cè¯­è¨€æ ‡é‡ã€ç»“æ„ä½“æˆ–è”åˆä½“æ—¶ä½¿ç”¨,å®é™…æµ‹è¯•å‘ç°NSStringä¹Ÿå¯ä»¥ï¼‰ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertEqual</span><span class="params">(a1, a2, format...)</span></span> </span><br><span class="line"><span class="comment">//åˆ¤æ–­ä¸ç­‰ï¼ˆå½“a1å’Œa2æ˜¯ Cè¯­è¨€æ ‡é‡ã€ç»“æ„ä½“æˆ–è”åˆä½“æ—¶ä½¿ç”¨ï¼‰ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertNotEqual</span><span class="params">(a1, a2, format...)</span></span> </span><br><span class="line"><span class="comment">//åˆ¤æ–­ç›¸ç­‰ï¼Œï¼ˆdoubleæˆ–floatç±»å‹ï¼‰æä¾›ä¸€ä¸ªè¯¯å·®èŒƒå›´ï¼Œå½“åœ¨è¯¯å·®èŒƒå›´ï¼ˆ+/-accuracyï¼‰ä»¥å†…ç›¸ç­‰æ—¶é€šè¿‡æµ‹è¯•ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertEqualWithAccuracy</span><span class="params">(a1, a2, accuracy, format...)</span></span> </span><br><span class="line"><span class="comment">//åˆ¤æ–­ä¸ç­‰ï¼Œï¼ˆdoubleæˆ–floatç±»å‹ï¼‰æä¾›ä¸€ä¸ªè¯¯å·®èŒƒå›´ï¼Œå½“åœ¨è¯¯å·®èŒƒå›´ä»¥å†…ä¸ç­‰æ—¶é€šè¿‡æµ‹è¯•ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertNotEqualWithAccuracy</span><span class="params">(a1, a2, accuracy, format...)</span></span> </span><br><span class="line"><span class="comment">//å¼‚å¸¸æµ‹è¯•ï¼Œå½“expressionå‘ç”Ÿå¼‚å¸¸æ—¶é€šè¿‡ï¼Œåä¹‹ä¸é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertThrows</span><span class="params">(expression, format...)</span></span> </span><br><span class="line"><span class="comment">//å¼‚å¸¸æµ‹è¯•ï¼Œå½“expressionå‘ç”ŸspecificExceptionå¼‚å¸¸æ—¶é€šè¿‡ï¼›åä¹‹å‘ç”Ÿå…¶ä»–å¼‚å¸¸æˆ–ä¸å‘ç”Ÿå¼‚å¸¸å‡ä¸é€šè¿‡</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertThrowsSpecific</span><span class="params">(expression, specificException, format...)</span></span> </span><br><span class="line"><span class="comment">//å¼‚å¸¸æµ‹è¯•ï¼Œå½“expressionå‘ç”Ÿå…·ä½“å¼‚å¸¸ã€å…·ä½“å¼‚å¸¸åç§°çš„å¼‚å¸¸æ—¶é€šè¿‡æµ‹è¯•ï¼Œåä¹‹ä¸é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertThrowsSpecificNamed</span><span class="params">(expression, specificException, exception_name, format...)</span></span> </span><br><span class="line"><span class="comment">//å¼‚å¸¸æµ‹è¯•ï¼Œå½“expressionæ²¡æœ‰å‘ç”Ÿå¼‚å¸¸æ—¶é€šè¿‡æµ‹è¯•ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertNoThrow</span><span class="params">(expression, formatâ€¦)</span></span> </span><br><span class="line"><span class="comment">//å¼‚å¸¸æµ‹è¯•ï¼Œå½“expressionæ²¡æœ‰å‘ç”Ÿå…·ä½“å¼‚å¸¸ã€å…·ä½“å¼‚å¸¸åç§°çš„å¼‚å¸¸æ—¶é€šè¿‡æµ‹è¯•ï¼Œåä¹‹ä¸é€šè¿‡ï¼›</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertNoThrowSpecific</span><span class="params">(expression, specificException, format...)</span></span> </span><br><span class="line"><span class="comment">//å¼‚å¸¸æµ‹è¯•ï¼Œå½“expressionæ²¡æœ‰å‘ç”Ÿå…·ä½“å¼‚å¸¸ã€å…·ä½“å¼‚å¸¸åç§°çš„å¼‚å¸¸æ—¶é€šè¿‡æµ‹è¯•ï¼Œåä¹‹ä¸é€šè¿‡</span></span><br><span class="line"><span class="function"><span class="title">XCTAssertNoThrowSpecificNamed</span><span class="params">(expression, specificException, exception_name, format...)</span></span></span><br></pre></td></tr></table></figure>
<p>å½“ç„¶åœ¨æœ‰äº›ç‰¹æ®Šæƒ…å†µä¸‹ç›´æ¥ä½¿ç”¨è¿™äº›æ–­è¨€ï¼Œä¼šè®©ä»£ç çœ‹èµ·æ¥å¾ˆè‡ƒè‚¿ï¼Œæ¯”å¦‚ï¼š</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">XCTAssertTrue</span>(<span class="attr_selector">[string isKindOfClass:[NSString class]</span>] &amp;&amp; (<span class="attr_selector">[[NSUUID alloc]</span> <span class="rule"><span class="attribute">initWithUUIDString</span>:<span class="value">string] != nil), @<span class="string">"'%@' is not a valid UUID string"</span>, string)</span></span>;</span><br></pre></td></tr></table></figure>
<p>æˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰æ–­è¨€å®æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼š</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">#define AssertIsValidUUIDString(a1) \ <span class="keyword">do</span> &#123; \ NSUUID *_u = ([a1 isKindOfClass:[NSString <span class="class"><span class="keyword">class</span>]] ? [[<span class="title">NSUUID</span> <span class="title">alloc</span>] <span class="title">initWithUUIDString</span>:<span class="typename"></span></span>(a1)] : nil); \ <span class="keyword">if</span> (_u == nil) &#123; \ XCTFail(@<span class="string">"'%@' is not a valid UUID string"</span>, a1); \ &#125; \ &#125; <span class="keyword">while</span> (<span class="number">0</span>)</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨æ—¶åªéœ€è¦è°ƒç”¨<code>AssertIsValidUUIDString(string)</code>å³å¯ï¼Œæ›´å¤šçš„å°è£…ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="hexcolor">#def</span>ine <span class="function"><span class="title">assertTrue</span><span class="params">(expr)</span></span> <span class="function"><span class="title">XCTAssertTrue</span><span class="params">((expr)</span></span>, @<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="hexcolor">#def</span>ine <span class="function"><span class="title">assertFalse</span><span class="params">(expr)</span></span> <span class="function"><span class="title">XCTAssertFalse</span><span class="params">((expr)</span></span>, @<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="hexcolor">#def</span>ine <span class="function"><span class="title">assertNil</span><span class="params">(a1)</span></span> <span class="function"><span class="title">XCTAssertNil</span><span class="params">((a1)</span></span>, @<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="hexcolor">#def</span>ine <span class="function"><span class="title">assertNotNil</span><span class="params">(a1)</span></span> <span class="function"><span class="title">XCTAssertNotNil</span><span class="params">((a1)</span></span>, @<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="hexcolor">#def</span>ine <span class="function"><span class="title">assertEqual</span><span class="params">(a1, a2)</span></span> <span class="function"><span class="title">XCTAssertEqual</span><span class="params">((a1)</span></span>, (a2), @<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="hexcolor">#def</span>ine <span class="function"><span class="title">assertEqualObjects</span><span class="params">(a1, a2)</span></span> <span class="function"><span class="title">XCTAssertEqualObjects</span><span class="params">((a1)</span></span>, (a2), @<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="hexcolor">#def</span>ine <span class="function"><span class="title">assertNotEqual</span><span class="params">(a1, a2)</span></span> <span class="function"><span class="title">XCTAssertNotEqual</span><span class="params">((a1)</span></span>, (a2), @<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="hexcolor">#def</span>ine <span class="function"><span class="title">assertNotEqualObjects</span><span class="params">(a1, a2)</span></span> <span class="function"><span class="title">XCTAssertNotEqualObjects</span><span class="params">((a1)</span></span>, (a2), @<span class="string">""</span>)</span><br><span class="line"></span><br><span class="line"><span class="hexcolor">#def</span>ine <span class="function"><span class="title">assertAccuracy</span><span class="params">(a1, a2, acc)</span></span> <span class="function"><span class="title">XCTAssertEqualWithAccuracy</span><span class="params">((a1)</span></span>,(a2),(acc))</span><br></pre></td></tr></table></figure>
<h5 id="æœŸæœ›">æœŸæœ›</h5><p>æœŸæœ›å®é™…ä¸Šæ˜¯å¼‚æ­¥æµ‹è¯•ï¼Œå½“æµ‹è¯•å¼‚æ­¥æ–¹æ³•æ—¶ï¼Œå› ä¸ºç»“æœå¹¶ä¸æ˜¯ç«‹åˆ»è·å¾—ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªæœŸæœ›ï¼ŒæœŸæœ›æ˜¯æœ‰æ—¶é—´é™å®šçš„çš„ï¼Œfulfillè¡¨ç¤ºæ»¡è¶³æœŸæœ›ã€‚<br>ä¾‹å¦‚ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)testAsynExample &#123; </span><br><span class="line">  XCTestExpectation *<span class="built_in">exp</span> = [self expectationWithDescription:@<span class="string">"è¿™é‡Œå¯ä»¥æ˜¯æ“ä½œå‡ºé”™çš„åŸå› æè¿°ã€‚ã€‚ã€‚"</span>]; </span><br><span class="line">  NSOperationQueue *<span class="built_in">queue</span> = [[NSOperationQueue alloc]init]; </span><br><span class="line">  [<span class="built_in">queue</span> addOperationWithBlock:^&#123;</span><br><span class="line"> <span class="comment">//æ¨¡æ‹Ÿè¿™ä¸ªå¼‚æ­¥æ“ä½œéœ€è¦2ç§’åæ‰èƒ½è·å–ç»“æœï¼Œæ¯”å¦‚ä¸€ä¸ªå¼‚æ­¥ç½‘ç»œè¯·æ±‚ </span></span><br><span class="line">  sleep(<span class="number">2</span>); </span><br><span class="line"><span class="comment">//æ¨¡æ‹Ÿè·å–çš„å¼‚æ­¥æ“ä½œåï¼Œè·å–ç»“æœï¼Œåˆ¤æ–­å¼‚æ­¥æ–¹æ³•çš„ç»“æœæ˜¯å¦æ­£ç¡®</span></span><br><span class="line">   XCTAssertEqual(@<span class="string">"a"</span>, @<span class="string">"a"</span>); </span><br><span class="line"><span class="comment">//å¦‚æœæ–­è¨€æ²¡é—®é¢˜ï¼Œå°±è°ƒç”¨fulfillå®£å¸ƒæµ‹è¯•æ»¡è¶³ </span></span><br><span class="line">  [<span class="built_in">exp</span> fulfill]; </span><br><span class="line">  &#125;]; </span><br><span class="line"><span class="comment">//è®¾ç½®å»¶è¿Ÿå¤šå°‘ç§’åï¼Œå¦‚æœæ²¡æœ‰æ»¡è¶³æµ‹è¯•æ¡ä»¶å°±æŠ¥é”™</span></span><br><span class="line"> [self waitForExpectationsWithTimeout:<span class="number">3</span> handler:^(NSError * _Nullable error) &#123;</span><br><span class="line">   <span class="keyword">if</span> (error) &#123; </span><br><span class="line">      NSLog(@<span class="string">"Timeout Error: %@"</span>, error); </span><br><span class="line">    &#125;</span><br><span class="line"> &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å¼‚æ­¥æµ‹è¯•é™¤äº†ä½¿ç”¨ <code>expectationWithDescription</code>ä»¥å¤–ï¼Œè¿˜å¯ä»¥ä½¿ç”¨ <code>expectationForPredicate</code>å’Œ<code>expectationForNotification</code>,å…·ä½“çš„å¯ä»¥çœ‹çœ‹<a href="http://liuyanwei.jumppo.com/2016/03/10/iOS-unit-test.html" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
<h3 id="å®ä¾‹åˆ†æ">å®ä¾‹åˆ†æ</h3><p>è¿™é‡Œä»¥<code>AFNetworking</code>ä¸ºä¾‹ï¼Œå‰é¢æåˆ°äº†<code>AFNetworking</code>çš„æ‰€æœ‰æµ‹è¯•ç”¨ä¾‹ç±»éƒ½æœ‰ä¸€ä¸ªå…±åŒçš„çˆ¶ç±»<code>AFTestCase</code>ï¼Œå®ƒä¹Ÿæ˜¯<code>XCTestCase</code>çš„å­ç±»ã€‚åœ¨è¿™ä¸ªç±»ä¸­ï¼Œæ·»åŠ äº†ä¸€äº›ç†Ÿæ‚‰å’Œå…¬å…±æ–¹æ³•ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;XCTest/XCTest.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> AFNetworkingTestsBaseURLString;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">AFTestCase</span> : <span class="title">XCTestCase</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span><br><span class="line">Â *Â  é»˜è®¤ https://httpbin.org/ ä¸€ä¸ªhttpåº“æµ‹è¯•å·¥å…·</span><br><span class="line">Â */</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">NSURL</span> *baseURL;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">NSTimeInterval</span> networkTimeout;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)waitForExpectationsWithCommonTimeoutUsingHandler:(XCWaitCompletionHandler)handler;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œæœ‰ä¸¤ä¸ªå±æ€§ï¼Œä¸€ä¸ªæ–¹æ³•ï¼Œ<code>baseURL</code>ä¸ç”¨è¯´æ˜¯æµ‹è¯•åœ°å€ã€‚<code>networkTimeout</code>æ˜¯ç½‘ç»œè¯·æ±‚è¶…æ—¶æ—¶é—´ï¼Œ<code>waitForExpectationsWithCommonTimeoutUsingHandler</code>æ˜¯è¶…æ—¶åçš„æ–¹æ³•æ•è·å›è°ƒï¼Œé‚£ä¹ˆä»€ä¹ˆæ—¶å€™è°ƒç”¨è¿™ä¸ªæ–¹æ³•å‘¢ï¼Œä¸¾ä¸ªä¾‹å­ï¼š<br>åœ¨Xcode 6ä¹‹å‰çš„ç‰ˆæœ¬é‡Œé¢å¹¶æ²¡æœ‰å†…ç½®XCTestï¼Œæƒ³ä½¿ç”¨å¼‚æ­¥æµ‹è¯•çš„åªèƒ½æ˜¯åœ¨ä¸»çº¿ç¨‹çš„RunLoopé‡Œé¢ä½¿ç”¨ä¸€ä¸ªwhileå¾ªç¯,ç„¶åä¸€ç›´ç­‰å¾…å“åº”æˆ–è€…ç›´åˆ°timeoutï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)testAsync &#123;</span><br><span class="line">        <span class="built_in">NSDate</span> *timeoutDate = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:<span class="number">5.0</span>];</span><br><span class="line">        __block <span class="built_in">BOOL</span> responseHasArrived = <span class="literal">NO</span>;</span><br><span class="line">    </span><br><span class="line">        [<span class="keyword">self</span> requestUrl:<span class="string">@"http://httpbin.com"</span></span><br><span class="line">                  completionHandler:^(<span class="built_in">NSString</span> *info) &#123;</span><br><span class="line">                  </span><br><span class="line">            responseHasArrived = <span class="literal">YES</span>;</span><br><span class="line">            XCTAssert(info<span class="variable">.length</span> &gt; <span class="number">0</span>);</span><br><span class="line">        &#125;];</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">while</span> (responseHasArrived == <span class="literal">NO</span> &amp;&amp; ([timeoutDate timeIntervalSinceNow] &gt; <span class="number">0</span>)) &#123;</span><br><span class="line">            <span class="comment">// å¯åŠ¨runloopï¼Œè®¾ç½®RunLoopæœ€å¤§æ—¶é—´ï¼ˆå‡æ— é™å¾ªç¯ï¼‰ï¼Œæ‰§è¡Œå®Œæ¯•æ˜¯å¦é€€å‡º</span></span><br><span class="line">            <span class="built_in">CFRunLoopRunInMode</span>(k<span class="built_in">CFRunLoopDefaultMode</span>, <span class="number">0.01</span>, <span class="literal">YES</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    </span><br><span class="line">        <span class="keyword">if</span> (responseHasArrived == <span class="literal">NO</span>) &#123;</span><br><span class="line">            XCTFail(<span class="string">@"Test timed out"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>whileå¾ªç¯åœ¨ä¸»çº¿ç¨‹é‡Œé¢æ¯éš”0.01ç§’ä¼šè·‘ä¸€æ¬¡ï¼Œç›´åˆ°æœ‰å“åº”æˆ–è€…5ç§’ä¹‹åè¶…å‡ºå“åº”æ—¶é—´é™åˆ¶æ‰ä¼šè·³å‡ºã€‚<br>è€Œä½¿ç”¨XCTestçš„æµ‹è¯•æœŸæœ›æ¥å®ç°è¿™ä¸ªï¼Œæµ‹è¯•æ¡†æ¶å°±ä¼šé¢„è®¡å®ƒåœ¨ä¹‹åçš„æŸä¸€æ—¶åˆ»è¢«å®ç°ã€‚æœ€ç»ˆçš„ç¨‹åºå®Œæˆä»£ç å—ä¸­çš„æµ‹è¯•ä»£ç ä¼šè°ƒç”¨<code>XCTestExpection</code>ç±»ä¸­çš„<code>fulfill</code>æ–¹æ³•æ¥å®ç°æœŸæœ›ã€‚è¿™ä¸€æ–¹æ³•æ›¿ä»£äº†æˆ‘ä»¬ä¹‹å‰ä¾‹å­é‡Œé¢ä½¿ç”¨<code>responseHasArrived</code>ä½œä¸ºFlagçš„æ–¹å¼ï¼Œè¿™æ—¶æˆ‘ä»¬è®©æµ‹è¯•æ¡†æ¶ç­‰å¾…(æœ‰æ—¶é™)æµ‹è¯•æœŸæœ›é€šè¿‡XCTestCaseçš„<code>waitForExpectationsWithTimeout:handler:</code>æ–¹æ³•å®ç°ã€‚å¦‚æœå®Œæˆå¤„ç†çš„ä»£ç åœ¨æŒ‡å®šæ—¶é™é‡Œæ‰§è¡Œå¹¶è°ƒç”¨äº†<code>fulfill</code>æ–¹æ³•ï¼Œé‚£ä¹ˆå°±è¯´æ˜æ‰€æœ‰çš„æµ‹è¯•æœŸæœ›åœ¨æ­¤æœŸé—´éƒ½å·²ç»è¢«å®ç°ã€‚å¦‚:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)testAsync &#123;</span><br><span class="line">  XCTestExpectation *expectation =</span><br><span class="line">  [<span class="keyword">self</span> expectationWithDescription:<span class="string">@"High Expectations"</span>];</span><br><span class="line">  [<span class="keyword">self</span><span class="variable">.pageLoader</span> requestUrl:<span class="string">@"http://httpbin.com"</span></span><br><span class="line">                  completionHandler:^(<span class="built_in">NSString</span> *info) &#123;</span><br><span class="line">                  </span><br><span class="line">            XCTAssert(info<span class="variable">.length</span> &gt; <span class="number">0</span>);</span><br><span class="line">            [expectation fulfill];</span><br><span class="line">        &#125;];</span><br><span class="line">    </span><br><span class="line">        [<span class="keyword">self</span> waitForExpectationsWithTimeout:<span class="number">5.0</span> handler:^(<span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">            <span class="keyword">if</span> (error) &#123;</span><br><span class="line">                <span class="built_in">NSLog</span>(<span class="string">@"Timeout Error: %@"</span>, error);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>åœ¨æœ€åçš„ä»£ç æ®µé‡Œé¢ä½¿ç”¨<code>[expectation fulfill]</code>æ¥å‘ŠçŸ¥æ­¤æ¬¡æµ‹è¯•æ‰€æœŸæœ›çš„éƒ¨åˆ†å·²ç»ç¡®åˆ‡å®ç°è¿‡äº†ã€‚ç„¶åç”¨<code>waitForExpectationsWithTimeout:handler</code>æ–¹æ³•ç­‰å¾…å“åº”ï¼Œè¿™æ®µä¼šåœ¨æ¥å—å“åº”ä¹‹åæ‰§è¡Œæˆ–è€…è¶…æ—¶ä¹‹åä¹Ÿä¼šæ‰§è¡Œã€‚</p>
<h3 id="å®æˆ˜">å®æˆ˜</h3><p>è¿˜æ˜¯ä»¥<code>AFNetworking</code>ä¸ºä¾‹ï¼Œå†™ä¸€ä¸ªæµ‹è¯•ç½‘ç»œè¯·æ±‚çš„æµ‹è¯•ç”¨ä¾‹ï¼Œè¿™é‡Œç”¨cocoapodså¯¼å…¥<code>AFNetworking</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ­¤æ—¶<code>AFNetworking</code>åœ¨å•å…ƒæµ‹è¯•é‡Œæ— æ³•ä½¿ç”¨ï¼Œéœ€è¦æ‰‹åŠ¨é…ç½®è·¯å¾„ï¼Œæ­¥éª¤ä¸ºï¼š</p>
<ul>
<li>1.å¤åˆ¶Target(App) - Build Setting - Header Search Paths çš„è·¯å¾„ã€‚</li>
<li>2.ç²˜è´´åˆ°Target(UnitTests) - Build Setting - Header - Search Pathsé‡Œã€‚</li>
<li>3.å¤åˆ¶Target(App) - Build Setting - User-Defined - PODS_ROOTæ•´æ¡ã€‚</li>
<li>4.åˆ°Target(UnitTests) - Build Setting - User-Definedæ–°å»ºä¸€æ¡PODS_ROOTã€‚</li>
</ul>
<p>å¤§éƒ¨åˆ†ç½‘ç»œè¯·æ±‚éƒ½æ˜¯å¼‚æ­¥æ“ä½œï¼Œä½†æ˜¯æˆ‘ä»¬éœ€è¦åœ¨ä¸»çº¿ç¨‹ä¸­è·å–åˆ°ç½‘ç»œè¯·æ±‚æˆåŠŸè¿˜æ˜¯å¤±è´¥çš„ä¿¡æ¯ã€‚ç”±äºæµ‹è¯•æ–¹æ³•ä¸»çº¿ç¨‹æ‰§è¡Œå®Œå°±ä¼šç»“æŸï¼Œæ‰€ä»¥éœ€è¦è®¾ç½®ä¸€ä¸‹ï¼ŒæŸ¥çœ‹å¼‚æ­¥è¿”å›ç»“æœã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨æœŸæœ›åœ¨æ–¹æ³•ç»“æŸå‰è®¾ç½®ç­‰å¾…ï¼Œå¦‚ä¸‹ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)testRequest&#123;</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  XCTestExpectation *expectation =[<span class="keyword">self</span> expectationWithDescription:<span class="string">@"æ²¡æœ‰æ»¡è¶³æœŸæœ›"</span>];</span><br><span class="line">Â  Â  AFHTTPSessionManager *sessionManager = [AFHTTPSessionManager manager];</span><br><span class="line">Â  Â  sessionManager<span class="variable">.responseSerializer</span> = [AFHTTPResponseSerializer serializer];</span><br><span class="line">Â  Â  [sessionManager GET:<span class="string">@"http://www.weather.com.cn/adat/sk/101110101.html"</span> parameters:<span class="literal">nil</span> success:^(<span class="built_in">NSURLSessionDataTask</span> * _Nonnull task, <span class="keyword">id</span>Â  _Nullable responseObject) &#123;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"responseObject:%@"</span>, [<span class="built_in">NSJSONSerialization</span> JSONObjectWithData:responseObject options:<span class="number">1</span> error:<span class="literal">nil</span>]);</span><br><span class="line">Â  Â  Â  Â  XCTAssertNotNil(responseObject, <span class="string">@"è¿”å›å‡ºé”™"</span>);</span><br><span class="line">Â  Â  Â  Â  [expectation fulfill];</span><br><span class="line">Â  Â  &#125; failure:^(<span class="built_in">NSURLSessionDataTask</span> * _Nullable task, <span class="built_in">NSError</span> * _Nonnull error) &#123;</span><br><span class="line">Â  Â  Â  Â  XCTAssertNil(error, <span class="string">@"è¯·æ±‚å‡ºé”™"</span>);</span><br><span class="line">Â  Â  &#125;];</span><br><span class="line">Â Â  Â <span class="comment">// è®¾ç½®5ç§’çš„è¶…æ—¶æ—¶é—´</span></span><br><span class="line">Â  Â  [<span class="keyword">self</span> waitForExpectationsWithTimeout:<span class="number">5.0</span> handler:^(<span class="built_in">NSError</span> *error) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (error) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSLog</span>(<span class="string">@"Timeout Error: %@"</span>, error);</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç›¸å…³çš„Demoåœ¨<a href="https://github.com/v2panda/PDSourceNotes/tree/master/AFNetworking/DemoUnitTests" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
<h3 id="Reference">Reference</h3><p><a href="https://objccn.io/issue-15-2/" target="_blank" rel="external">XCTestæµ‹è¯•å®æˆ˜</a></p>
<p><a href="http://liuyanwei.jumppo.com/2016/03/10/iOS-unit-test.html" target="_blank" rel="external">iOSå•å…ƒæµ‹è¯•</a></p>
<p><a href="http://www.jianshu.com/p/8bbec078cabe" target="_blank" rel="external">iOSå•å…ƒæµ‹è¯•(ä½œç”¨åŠå…¥é—¨æå‡)</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="å‰è¨€">å‰è¨€</h3><p>ä¸å†™å•å…ƒæµ‹è¯•çš„ç¨‹åºå‘˜æ˜¯ä¸åˆæ ¼çš„ï¼Œä¸ºäº†è®©è‡ªå·±æˆä¸ºä¸€ååˆæ ¼çš„ç¨‹åºå‘˜ï¼Œå­¦ä¹ å¦‚ä½•å†™å•å…ƒæµ‹è¯•æ˜¯å¾ˆæœ‰å¿…è¦çš„ï¼Œè¿™é‡Œä»¥Xcodeé›†æˆçš„æµ‹è¯•æ¡†æ¶<a href="https://developer.apple.com/reference/xctest">XCTest</a>ä¸ºä¾‹ã€‚æœ¬æ–‡é¦–å…ˆä¼šä»‹ç»XCTestå•å…ƒæµ‹è¯•çš„åŸºç¡€ç”¨æ³•ï¼Œç„¶åç»“åˆå…·ä½“çš„å®ä¾‹åˆ†æï¼Œæœ€ååŠ¨æ‰‹å†™ä¸€ä¸ªå•å…ƒæµ‹è¯•ã€‚</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[SDWebImageæºç é˜…è¯»ç¬”è®°]]></title>
    <link href="http://v2panda.com/2016/06/30/SDWebImage-notes/"/>
    <id>http://v2panda.com/2016/06/30/SDWebImage-notes/</id>
    <published>2016-06-30T01:51:07.000Z</published>
    <updated>2016-07-03T01:56:31.000Z</updated>
    <content type="html"><![CDATA[<h3 id="å‰è¨€">å‰è¨€</h3><p><a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">SDWebImage</a>æ˜¯ä¸€ä¸ªå›¾ç‰‡åŠ è½½åº“ï¼Œç›®å‰åœ¨Githubä¸Šå·²æœ‰å°†è¿‘14kçš„staräº†ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•äº†é˜…è¯»SDWebImageæºç çš„ç¬”è®°(Version 3.8)ï¼Œç®€å•çš„ç ”ç©¶äº†å®ƒçš„å®ç°ç»†èŠ‚ã€‚</p>
<h3 id="æµç¨‹">æµç¨‹</h3><p>SDWebImageåŠ è½½å›¾ç‰‡çš„å¤§è‡´æµç¨‹ï¼Œä»¥UIImageView+WebCacheä¸ºä¾‹ã€‚</p>
<p>1.è°ƒç”¨åŸºç¡€å…¥å£æ–¹æ³•<br><code>sd_setImageWithURL:</code>,<code>sd_setImageWithURL:placeholderImage:</code>,<code>sd_setImageWithURL:placeholderImage:options:</code>ç­‰ç­‰</p>
<p>2.è¿›å…¥<code>sd_setImageWithURL:placeholderImage:options:progress:completed:</code></p>
<p>3.è¿›å…¥<code>downloadImageWithURL:options:progress:completed:</code></p>
<p>4.è°ƒç”¨SDWebImageDownloaderä¸‹è½½å›¾ç‰‡<code>downloadImageWithURL:options:progress:completed:</code></p>
<p>5.è°ƒç”¨<code>addProgressCallback:completedBlock:forURL:createCallback:</code></p>
<p>6.åˆå§‹åŒ–SDWebImageDownloaderOperation<br><code>initWithRequest:inSession:options:progress:completed:cancelled:</code></p>
<p>7.ç¼“å­˜å›¾ç‰‡è°ƒç”¨<code>storeImage:recalculateFromImage:imageData:forKey:toDisk:</code></p>
<p>ä»¥ä¸Šæ–¹æ³•æ˜¯è°ƒç”¨é“¾ä¸Šçš„ä¸»è¦æ–¹æ³•ï¼Œå°†åœ¨ä¸‹æ–‡é€ä¸€è§£é‡Šã€‚</p>
<a id="more"></a>
<h3 id="Utils">Utils</h3><p>Utilsæœ‰ä¸‰ä¸ªç±»ï¼š</p>
<ul>
<li><code>SDWebImageManager</code><br>SDWebImageæ ¸å¿ƒç±»ï¼Œç”¨æ¥ç®¡ç†å›¾ç‰‡çš„ä¸‹è½½å’Œç¼“å­˜</li>
<li><code>SDWebImageDecoder</code><br>è§£å‹ç¼©å›¾ç‰‡</li>
<li><code>SDWebImagePrefetcher</code><br>å¯ä»¥é¢„å…ˆä¸‹è½½å›¾ç‰‡</li>
</ul>
<h5 id="SDWebImageManager">SDWebImageManager</h5><p>ç”¨æ¥ç®¡ç†å›¾ç‰‡çš„ä¸‹è½½å’Œç¼“å­˜å·¥å…·ç±»ï¼Œæå–äº†<code>SDImageCache</code>å’Œ<code>SDWebImageDownloader</code>çš„ç›¸å…³æ–¹æ³•ï¼Œåœ¨æµç¨‹3ä¸­ä½¿ç”¨çš„æ–¹æ³•å…·ä½“ä¸ºï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span> &lt;SDWebImageOperation&gt;)downloadImageWithURL:(<span class="built_in">NSURL</span> *)url</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options:(SDWebImageOptions)options</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progress:(SDWebImageDownloaderProgressBlock)progressBlock</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completed:(SDWebImageCompletionWithFinishedBlock)completedBlock &#123;</span><br><span class="line">Â  Â  <span class="comment">// æ²¡æœ‰completedBlockè°ƒç”¨è¿™ä¸ªæ–¹æ³•æ˜¯æ¯«æ— æ„ä¹‰çš„</span></span><br><span class="line">Â  Â  <span class="built_in">NSAssert</span>(completedBlock != <span class="literal">nil</span>, <span class="string">@"If you mean to prefetch the image, use -[SDWebImagePrefetcher prefetchURLs] instead"</span>);</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment">// åˆ¤æ–­urlåˆæ³•æ€§ï¼Œå¹¶å¸®å°†NSStringå½“NSURLçš„æ–°æ‰‹æ“¦å±è‚¡</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> ([url isKindOfClass:<span class="built_in">NSString</span><span class="variable">.class</span>]) &#123;</span><br><span class="line">Â  Â  Â  Â  url = [<span class="built_in">NSURL</span> URLWithString:(<span class="built_in">NSString</span> *)url];</span><br><span class="line">Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment">// åˆ¤æ–­urlåˆæ³•æ€§</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (![url isKindOfClass:<span class="built_in">NSURL</span><span class="variable">.class</span>]) &#123;</span><br><span class="line">Â  Â  Â  Â  url = <span class="literal">nil</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// åˆ›å»ºSDWebImageCombinedOperationå¯¹è±¡</span></span><br><span class="line">Â  Â  __block SDWebImageCombinedOperation *operation = [SDWebImageCombinedOperation new];</span><br><span class="line">Â  Â  __<span class="keyword">weak</span> SDWebImageCombinedOperation *weakOperation = operation;</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="built_in">BOOL</span> isFailedUrl = <span class="literal">NO</span>;</span><br><span class="line">Â  Â  <span class="comment">// ç»™failedURLså±æ€§åŠ é”ï¼Œç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œ</span></span><br><span class="line">Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span><span class="variable">.failedURLs</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// æ£€æŸ¥urlæ˜¯å¦æ˜¯ä¸‹è½½å¤±è´¥çš„</span></span><br><span class="line">Â  Â  Â  Â  isFailedUrl = [<span class="keyword">self</span><span class="variable">.failedURLs</span> containsObject:url];</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// æ£€æŸ¥urlçš„åˆæ³•æ€§</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (url<span class="variable">.absoluteString</span><span class="variable">.length</span> == <span class="number">0</span> || (!(options &amp; SDWebImageRetryFailed) &amp;&amp; isFailedUrl)) &#123;</span><br><span class="line">Â  Â  Â  Â  dispatch_main_sync_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSError</span> *error = [<span class="built_in">NSError</span> errorWithDomain:<span class="built_in">NSURLErrorDomain</span> code:<span class="built_in">NSURLErrorFileDoesNotExist</span> userInfo:<span class="literal">nil</span>];</span><br><span class="line">Â  Â  Â  Â  Â  Â  completedBlock(<span class="literal">nil</span>, error, SDImageCacheTypeNone, <span class="literal">YES</span>, url);</span><br><span class="line">Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> operation;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span><span class="variable">.runningOperations</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.runningOperations</span> addObject:operation];</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// é»˜è®¤ä½¿ç”¨urlä½œkeyï¼Œä¹Ÿå¯ä»¥è‡ªå®šä¹‰cacheKeyFilterè¿‡æ»¤</span></span><br><span class="line">Â  Â  <span class="built_in">NSString</span> *key = [<span class="keyword">self</span> cacheKeyForURL:url];</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="comment">// æŸ¥æ‰¾å†…å­˜æˆ–ç¡¬ç›˜ä¸­æ˜¯å¦æœ‰ç¼“å­˜çš„å›¾ç‰‡</span></span><br><span class="line">Â  Â  operation<span class="variable">.cacheOperation</span> = [<span class="keyword">self</span><span class="variable">.imageCache</span> queryDiskCacheForKey:key done:^(<span class="built_in">UIImage</span> *image, SDImageCacheType cacheType) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (operation<span class="variable">.isCancelled</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span><span class="variable">.runningOperations</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.runningOperations</span> removeObject:operation];</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">return</span>;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> ((!image || options &amp; SDWebImageRefreshCached) &amp;&amp; (![<span class="keyword">self</span><span class="variable">.delegate</span> respondsToSelector:<span class="keyword">@selector</span>(imageManager:shouldDownloadImageForURL:)] || [<span class="keyword">self</span><span class="variable">.delegate</span> imageManager:<span class="keyword">self</span> shouldDownloadImageForURL:url])) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (image &amp;&amp; options &amp; SDWebImageRefreshCached) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  dispatch_main_sync_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// å¦‚æœå›¾ç‰‡å­˜åœ¨ï¼Œä½†é‡‡ç”¨SDWebImageRefreshCachedæ ‡è®°ï¼Œé€šçŸ¥è·å–åˆ°äº†å›¾ç‰‡ï¼Œå¹¶å†æ¬¡ä»ç½‘ç»œä¸‹è½½ï¼Œä½¿NSURLCacheé‡æ–°åˆ·æ–°</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedBlock(image, <span class="literal">nil</span>, cacheType, <span class="literal">YES</span>, url);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// ä¸‹è½½å›¾ç‰‡</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// SDWebImageOptionså’ŒSDWebImageDownloaderOptionså¯¹åº”å…³ç³»</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// a |= b Â  Â  ------&gt; Â  a = a | b</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  SDWebImageDownloaderOptions downloaderOptions = <span class="number">0</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (options &amp; SDWebImageLowPriority) downloaderOptions |= SDWebImageDownloaderLowPriority;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (options &amp; SDWebImageProgressiveDownload) downloaderOptions |= SDWebImageDownloaderProgressiveDownload;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (options &amp; SDWebImageRefreshCached) downloaderOptions |= SDWebImageDownloaderUse<span class="built_in">NSURLCache</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (options &amp; SDWebImageContinueInBackground) downloaderOptions |= SDWebImageDownloaderContinueInBackground;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (options &amp; SDWebImageHandleCookies) downloaderOptions |= SDWebImageDownloaderHandleCookies;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (options &amp; SDWebImageAllowInvalidSSLCertificates) downloaderOptions |= SDWebImageDownloaderAllowInvalidSSLCertificates;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (options &amp; SDWebImageHighPriority) downloaderOptions |= SDWebImageDownloaderHighPriority;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (image &amp;&amp; options &amp; SDWebImageRefreshCached) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// force progressive off if image already cached but forced refreshing</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// ~ æŒ‰ä½å–åè¿ç®—ç¬¦</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  downloaderOptions &amp;= ~SDWebImageDownloaderProgressiveDownload;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// ignore image read from NSURLCache if image if cached but force refreshing</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  downloaderOptions |= SDWebImageDownloaderIgnoreCachedResponse;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// è°ƒç”¨SDWebImageDownloaderä¸‹è½½å›¾ç‰‡</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">id</span> &lt;SDWebImageOperation&gt; subOperation = [<span class="keyword">self</span><span class="variable">.imageDownloader</span> downloadImageWithURL:url options:downloaderOptions progress:progressBlock completed:^(<span class="built_in">UIImage</span> *downloadedImage, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error, <span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (!strongOperation || strongOperation<span class="variable">.isCancelled</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// Do nothing if the operation was cancelled</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// See #699 for more details</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// if we would call the completedBlock, there could be a race condition between this block and another completedBlock for the same object, so if this one is called second, we will overwrite the new data</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">else</span> <span class="keyword">if</span> (error) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dispatch_main_sync_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (strongOperation &amp;&amp; !strongOperation<span class="variable">.isCancelled</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedBlock(<span class="literal">nil</span>, error, SDImageCacheTypeNone, finished, url);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> ( Â  error<span class="variable">.code</span> != <span class="built_in">NSURLErrorNotConnectedToInternet</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &amp;&amp; error<span class="variable">.code</span> != <span class="built_in">NSURLErrorCancelled</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &amp;&amp; error<span class="variable">.code</span> != <span class="built_in">NSURLErrorTimedOut</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &amp;&amp; error<span class="variable">.code</span> != <span class="built_in">NSURLErrorInternationalRoamingOff</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &amp;&amp; error<span class="variable">.code</span> != <span class="built_in">NSURLErrorDataNotAllowed</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &amp;&amp; error<span class="variable">.code</span> != <span class="built_in">NSURLErrorCannotFindHost</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &amp;&amp; error<span class="variable">.code</span> != <span class="built_in">NSURLErrorCannotConnectToHost</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// ä¸‹è½½å¤±è´¥ï¼Œå°†urlæ·»åŠ åˆ°å¤±è´¥urlsé‡Œ</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span><span class="variable">.failedURLs</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.failedURLs</span> addObject:url];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// ä¸‹è½½å¤±è´¥ï¼Œä½†é€‰æ‹©äº†æ ‡è®°SDWebImageRetryFailedï¼Œç§»é™¤å¤±è´¥url</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> ((options &amp; SDWebImageRetryFailed)) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span><span class="variable">.failedURLs</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.failedURLs</span> removeObject:url];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">BOOL</span> cacheOnDisk = !(options &amp; SDWebImageCacheMemoryOnly);</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (options &amp; SDWebImageRefreshCached &amp;&amp; image &amp;&amp; !downloadedImage) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// Image refresh hit the NSURLCache cache, do not call the completion block</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">else</span> <span class="keyword">if</span> (downloadedImage &amp;&amp; (!downloadedImage<span class="variable">.images</span> || (options &amp; SDWebImageTransformAnimatedImage)) &amp;&amp; [<span class="keyword">self</span><span class="variable">.delegate</span> respondsToSelector:<span class="keyword">@selector</span>(imageManager:transformDownloadedImage:withURL:)]) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// åœ¨å…¨å±€é˜Ÿåˆ—ä¸­è°ƒç”¨ï¼Œä»¥ä¸é˜»å¡ä¸»çº¿ç¨‹</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">dispatch_async</span>(dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_HIGH, <span class="number">0</span>), ^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// åœ¨ä¸‹è½½å®Œåï¼Œç¼“å­˜åˆ°å†…å­˜æˆ–ç¡¬ç›˜ä¹‹å‰ï¼Œåšè½¬æ¢å›¾ç‰‡æ“ä½œ</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">UIImage</span> *transformedImage = [<span class="keyword">self</span><span class="variable">.delegate</span> imageManager:<span class="keyword">self</span> transformDownloadedImage:downloadedImage withURL:url];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// å°†è½¬æ¢å®Œçš„å›¾ç‰‡ç¼“å­˜</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (transformedImage &amp;&amp; finished) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">BOOL</span> imageWasTransformed = ![transformedImage isEqual:downloadedImage];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.imageCache</span> storeImage:transformedImage recalculateFromImage:imageWasTransformed imageData:(imageWasTransformed ? <span class="literal">nil</span> : data) forKey:key toDisk:cacheOnDisk];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dispatch_main_sync_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (strongOperation &amp;&amp; !strongOperation<span class="variable">.isCancelled</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedBlock(transformedImage, <span class="literal">nil</span>, SDImageCacheTypeNone, finished, url);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// å°†è½¬æ¢å®Œçš„å›¾ç‰‡ç¼“å­˜</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (downloadedImage &amp;&amp; finished) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.imageCache</span> storeImage:downloadedImage recalculateFromImage:<span class="literal">NO</span> imageData:data forKey:key toDisk:cacheOnDisk];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dispatch_main_sync_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (strongOperation &amp;&amp; !strongOperation<span class="variable">.isCancelled</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedBlock(downloadedImage, <span class="literal">nil</span>, SDImageCacheTypeNone, finished, url);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (finished) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span><span class="variable">.runningOperations</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (strongOperation) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.runningOperations</span> removeObject:strongOperation];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;];</span><br><span class="line">Â  Â  Â  Â  Â  Â  operation<span class="variable">.cancelBlock</span> = ^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  [subOperation cancel];</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span><span class="variable">.runningOperations</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (strongOperation) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.runningOperations</span> removeObject:strongOperation];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">else</span> <span class="keyword">if</span> (image) &#123; <span class="comment">// å›¾ç‰‡å­˜åœ¨ï¼Œå³å†…å­˜æˆ–ç¡¬ç›˜ä¸­æœ‰å›¾ç‰‡</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  dispatch_main_sync_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (strongOperation &amp;&amp; !strongOperation<span class="variable">.isCancelled</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">//Â  è¿”å›imageå’ŒcacheType</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedBlock(image, <span class="literal">nil</span>, cacheType, <span class="literal">YES</span>, url);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// åˆ é™¤å½“å‰operation</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span><span class="variable">.runningOperations</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.runningOperations</span> removeObject:operation];</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// Image not in cache and download disallowed by delegate</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  dispatch_main_sync_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  __<span class="keyword">strong</span> __<span class="keyword">typeof</span>(weakOperation) strongOperation = weakOperation;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (strongOperation &amp;&amp; !weakOperation<span class="variable">.isCancelled</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedBlock(<span class="literal">nil</span>, <span class="literal">nil</span>, SDImageCacheTypeNone, <span class="literal">YES</span>, url);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">@synchronized</span> (<span class="keyword">self</span><span class="variable">.runningOperations</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.runningOperations</span> removeObject:operation];</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;];</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">return</span> operation;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ­¤ä¸ºæ ¸å¿ƒæ–¹æ³•ï¼Œå®Œæˆäº†æŸ¥æ‰¾ç¼“å­˜ã€ä¸‹è½½å›¾ç‰‡ã€ç¼“å­˜å›¾ç‰‡ç­‰æ“ä½œã€‚å€¼å¾—æ³¨æ„çš„æ˜¯SDWebImageManagerè¿˜æœ‰ä¸€ä¸ªdelegateå±æ€§ï¼Œå¹¶æä¾›äº†ä¸¤ä¸ªå¯é€‰æ–¹æ³•:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@protocol</span> <span class="title">SDWebImageManagerDelegate</span> &lt;<span class="title">NSObject</span>&gt;</span></span><br><span class="line"><span class="keyword">@optional</span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)imageManager:(SDWebImageManager *)imageManager shouldDownloadImageForURL:(<span class="built_in">NSURL</span> *)imageURL;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ä¸‹è½½å®Œåï¼Œç¼“å­˜åˆ°å†…å­˜æˆ–ç¡¬ç›˜ä¹‹å‰ï¼Œåšè½¬æ¢å›¾ç‰‡æ“ä½œ</span></span><br><span class="line">- (<span class="built_in">UIImage</span> *)imageManager:(SDWebImageManager *)imageManager transformDownloadedImage:(<span class="built_in">UIImage</span> *)image withURL:(<span class="built_in">NSURL</span> *)imageURL;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<h5 id="SDWebImageDecoder">SDWebImageDecoder</h5><p>ç”¨æ¥è§£å‹ç¼©å›¾ç‰‡ï¼Œä¼šåœ¨å–å›¾ç‰‡æ—¶åšä¸€æ¬¡decodeæ“ä½œã€‚<br>å› ä¸ºé€šè¿‡ imageNamed åˆ›å»º UIImage æ—¶ï¼Œç³»ç»Ÿå®é™…ä¸Šåªæ˜¯åœ¨ Bundle å†…æŸ¥æ‰¾åˆ°æ–‡ä»¶åï¼Œç„¶åæŠŠè¿™ä¸ªæ–‡ä»¶åæ”¾åˆ° UIImage é‡Œè¿”å›ï¼Œå¹¶æ²¡æœ‰è¿›è¡Œå®é™…çš„æ–‡ä»¶è¯»å–å’Œè§£ç ã€‚å½“ UIImage ç¬¬ä¸€æ¬¡æ˜¾ç¤ºåˆ°å±å¹•ä¸Šæ—¶ï¼Œå…¶å†…éƒ¨çš„è§£ç æ–¹æ³•æ‰ä¼šè¢«è°ƒç”¨ï¼ŒåŒæ—¶è§£ç ç»“æœä¼šä¿å­˜åˆ°ä¸€ä¸ªå…¨å±€ç¼“å­˜å»ã€‚åœ¨å›¾ç‰‡è§£ç åï¼ŒApp ç¬¬ä¸€æ¬¡é€€åˆ°åå°å’Œæ”¶åˆ°å†…å­˜è­¦å‘Šæ—¶ï¼Œè¯¥å›¾ç‰‡çš„ç¼“å­˜æ‰ä¼šè¢«æ¸…ç©ºï¼Œå…¶ä»–æƒ…å†µä¸‹ç¼“å­˜ä¼šä¸€ç›´å­˜åœ¨ã€‚å…·ä½“çš„è¯´å°±æ˜¯ä¸€ä¸ªUIImageåŠ è½½äº†jpegæˆ–è€…pngï¼Œå½“UIImageViewå°†è¦æ˜¾ç¤ºè¿™ä¸ªUIImageçš„æ—¶å€™ä¼šå…ˆæŠŠpngå’Œjpegè§£ç æˆæœªå‹ç¼©æ ¼å¼ï¼Œæ‰€ä»¥SDWebImageæœ‰ä¸€ä¸ªdecodeImageæ–¹æ³•ï¼Œå°±æ˜¯æŠŠè¿™ä¸€æ­¥æ”¾åœ¨äº†å¼‚æ­¥çº¿ç¨‹åšï¼Œé˜²æ­¢tableViewCellä¸­çš„imageViewåŠ è½½å›¾ç‰‡çš„æ—¶å€™åœ¨ä¸»çº¿ç¨‹è§£ç å›¾ç‰‡ï¼Œå¯¼è‡´æ»‘åŠ¨å¡é¡¿ã€‚è¿™æ ·æ•ˆç‡å¾ˆä½ï¼Œä½†æ˜¯åªæœ‰ç¬æ—¶çš„å†…å­˜éœ€æ±‚ã€‚ä¸ºäº†æé«˜æ•ˆç‡é€šè¿‡SDWebImageDecoderå°†åŒ…è£…åœ¨Dataä¸‹çš„èµ„æºè§£å‹ï¼Œç„¶åç”»åœ¨å¦å¤–ä¸€å¼ å›¾ç‰‡ä¸Šï¼Œè¿™æ ·è¿™å¼ æ–°å›¾ç‰‡å°±ä¸å†éœ€è¦é‡å¤è§£å‹äº†,è¿™ç§åšæ³•æ˜¯å…¸å‹çš„ç©ºé—´æ¢æ—¶é—´çš„åšæ³•ï¼Œå¦‚ä¸‹ä»ç¡¬ç›˜ä¸­å»å›¾ç‰‡æ—¶ï¼Œåˆ†åˆ«å¯¹å›¾ç‰‡è¿›è¡Œäº†ç¼©æ”¾å’Œè§£å‹ç¼©æ“ä½œã€‚<br>å…³äºå¤„ç†å›¾ç‰‡å¯ä»¥çœ‹çœ‹YYè¿™ç¯‡<a href="http://blog.ibireme.com/2015/11/02/ios_image_tips/" target="_blank" rel="external">åšæ–‡</a></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="built_in">UIImage</span> *)diskImageForKey:(<span class="built_in">NSString</span> *)key &#123;</span><br><span class="line">Â  Â  <span class="built_in">NSData</span> *data = [<span class="keyword">self</span> diskImageDataBySearchingAllPathsForKey:key];</span><br><span class="line">Â  Â  <span class="keyword">if</span> (data) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> sd_imageWithData:data];</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// ç¼©æ”¾å›¾ç‰‡</span></span><br><span class="line">Â  Â  Â  Â  image = [<span class="keyword">self</span> scaledImageForKey:key image:image];</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.shouldDecompressImages</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// è§£å‹ç¼©</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  image = [<span class="built_in">UIImage</span> decodedImageWithImage:image];</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> image;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">nil</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="DownLoader">DownLoader</h3><p>DownLoaderæœ‰ä¸¤ä¸ªç±»ï¼š</p>
<ul>
<li><code>SDWebImageDownloader</code><br>ä¸‹è½½æ ¸å¿ƒç±»ï¼Œç”¨æ¥ç®¡ç†å›¾ç‰‡çš„ä¸‹è½½</li>
<li><code>SDWebImageDownloaderOperation</code><br>æ¯ä¸€ä¸ªå›¾ç‰‡ä¸‹è½½çš„å…·ä½“æ“ä½œ</li>
</ul>
<h5 id="SDWebImageDownloader">SDWebImageDownloader</h5><p><code>SDWebImageDownloader</code>ä¸€ä¸ªå•ä¾‹ç±»,è´Ÿè´£å›¾ç‰‡çš„ä¸‹è½½æ“ä½œå’Œç®¡ç†,å…¶åœ¨æµç¨‹4å’Œæµç¨‹5ä¸­çš„ä¸»è¦æ–¹æ³•ä¸ºï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">id</span> &lt;SDWebImageOperation&gt;)downloadImageWithURL:(<span class="built_in">NSURL</span> *)url options:(SDWebImageDownloaderOptions)options progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageDownloaderCompletedBlock)completedBlock &#123;</span><br><span class="line">Â  Â  __block SDWebImageDownloaderOperation *operation;</span><br><span class="line">Â  Â  __<span class="keyword">weak</span> __<span class="keyword">typeof</span>(<span class="keyword">self</span>)wself = <span class="keyword">self</span>;</span><br><span class="line"></span><br><span class="line">Â  Â  [<span class="keyword">self</span> addProgressCallback:progressBlock completedBlock:completedBlock forURL:url createCallback:^&#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// è¿‡æœŸæ—¶é—´</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSTimeInterval</span> timeoutInterval = wself<span class="variable">.downloadTimeout</span>;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (timeoutInterval == <span class="number">0.0</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  timeoutInterval = <span class="number">15.0</span>;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// åˆ›å»ºè¯·æ±‚å¯¹è±¡ï¼Œå¹¶æ ¹æ®optionså‚æ•°è®¾ç½®å…¶å±æ€§</span></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// ä¸ºäº†é¿å…æ½œåœ¨çš„é‡å¤ç¼“å­˜(NSURLCache + SDImageCache)ï¼Œå¦‚æœæ²¡æœ‰æ˜ç¡®å‘ŠçŸ¥éœ€è¦ç¼“å­˜ï¼Œåˆ™ç¦ç”¨å›¾ç‰‡è¯·æ±‚çš„ç¼“å­˜æ“ä½œ</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSMutableURLRequest</span> *request = [[<span class="built_in">NSMutableURLRequest</span> alloc] initWithURL:url cachePolicy:(options &amp; SDWebImageDownloaderUse<span class="built_in">NSURLCache</span> ? <span class="built_in">NSURLRequestUseProtocolCachePolicy</span> : <span class="built_in">NSURLRequestReloadIgnoringLocalCacheData</span>) timeoutInterval:timeoutInterval];</span><br><span class="line">Â  Â  Â  Â  request<span class="variable">.HTTPShouldHandleCookies</span> = (options &amp; SDWebImageDownloaderHandleCookies);</span><br><span class="line">Â  Â  Â  Â  request<span class="variable">.HTTPShouldUsePipelining</span> = <span class="literal">YES</span>;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// headerè¿‡æ»¤</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (wself<span class="variable">.headersFilter</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  request<span class="variable">.allHTTPHeaderFields</span> = wself<span class="variable">.headersFilter</span>(url, [wself<span class="variable">.HTTPHeaders</span> <span class="keyword">copy</span>]);</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  request<span class="variable">.allHTTPHeaderFields</span> = wself<span class="variable">.HTTPHeaders</span>;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// åˆå§‹åŒ–SDWebImageDownloaderOperation</span></span><br><span class="line">Â  Â  Â  Â  operation = [[wself<span class="variable">.operationClass</span> alloc] initWithRequest:request</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  inSession:<span class="keyword">self</span><span class="variable">.session</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options:options</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  progress:^(<span class="built_in">NSInteger</span> receivedSize, <span class="built_in">NSInteger</span> expectedSize) &#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  SDWebImageDownloader *sself = wself;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (!sself) <span class="keyword">return</span>;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  __block <span class="built_in">NSArray</span> *callbacksForURL;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">dispatch_sync</span>(sself<span class="variable">.barrierQueue</span>, ^&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callbacksForURL = [sself<span class="variable">.URLCallbacks</span>[url] <span class="keyword">copy</span>];</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// ä»URLCallbackså–å‡ºprogresså›è°ƒ</span></span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *callbacks <span class="keyword">in</span> callbacksForURL) &#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  SDWebImageDownloaderProgressBlock callback = callbacks[kProgressCallbackKey];</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (callback) callback(receivedSize, expectedSize);</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSData</span> *data, <span class="built_in">NSError</span> *error, <span class="built_in">BOOL</span> finished) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  SDWebImageDownloader *sself = wself;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (!sself) <span class="keyword">return</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  __block <span class="built_in">NSArray</span> *callbacksForURL;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dispatch_barrier_sync(sself<span class="variable">.barrierQueue</span>, ^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  callbacksForURL = [sself<span class="variable">.URLCallbacks</span>[url] <span class="keyword">copy</span>];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (finished) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [sself<span class="variable">.URLCallbacks</span> removeObjectForKey:url];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// ä»URLCallbackså–å‡ºcompleteå›è°ƒ</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">for</span> (<span class="built_in">NSDictionary</span> *callbacks <span class="keyword">in</span> callbacksForURL) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  SDWebImageDownloaderCompletedBlock callback = callbacks[kCompletedCallbackKey];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (callback) callback(image, data, error, finished);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  cancelled:^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  SDWebImageDownloader *sself = wself;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (!sself) <span class="keyword">return</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  dispatch_barrier_async(sself<span class="variable">.barrierQueue</span>, ^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [sself<span class="variable">.URLCallbacks</span> removeObjectForKey:url];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;];</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// å¯¹å›¾ç‰‡è¿›è¡Œè§£å‹ç¼©ï¼Œé»˜è®¤ä¸ºYES</span></span><br><span class="line">Â  Â  Â  Â  operation<span class="variable">.shouldDecompressImages</span> = wself<span class="variable">.shouldDecompressImages</span>;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (wself<span class="variable">.urlCredential</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  operation<span class="variable">.credential</span> = wself<span class="variable">.urlCredential</span>;</span><br><span class="line">Â  Â  Â  Â  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (wself<span class="variable">.username</span> &amp;&amp; wself<span class="variable">.password</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  operation<span class="variable">.credential</span> = [<span class="built_in">NSURLCredential</span> credentialWithUser:wself<span class="variable">.username</span> password:wself<span class="variable">.password</span> persistence:<span class="built_in">NSURLCredentialPersistenceForSession</span>];</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// è®¾ç½®ä¼˜å…ˆçº§</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (options &amp; SDWebImageDownloaderHighPriority) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  operation<span class="variable">.queuePriority</span> = <span class="built_in">NSOperationQueuePriorityHigh</span>;</span><br><span class="line">Â  Â  Â  Â  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (options &amp; SDWebImageDownloaderLowPriority) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  operation<span class="variable">.queuePriority</span> = <span class="built_in">NSOperationQueuePriorityLow</span>;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// å°†æ“ä½œåŠ å…¥åˆ°æ“ä½œé˜Ÿåˆ—downloadQueueä¸­</span></span><br><span class="line">Â  Â  Â  Â  [wself<span class="variable">.downloadQueue</span> addOperation:operation];</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// å¦‚æœæ˜¯LIFOé¡ºåºï¼Œåˆ™å°†æ–°çš„æ“ä½œä½œä¸ºåŸé˜Ÿåˆ—ä¸­æœ€åä¸€ä¸ªæ“ä½œçš„ä¾èµ–ï¼Œç„¶åå°†æ–°æ“ä½œè®¾ç½®ä¸ºæœ€åä¸€ä¸ªæ“ä½œ</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (wself<span class="variable">.executionOrder</span> == SDWebImageDownloaderLIFOExecutionOrder) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// Emulate LIFO execution order by systematically adding new operations as last operation's dependency</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  [wself<span class="variable">.lastAddedOperation</span> addDependency:operation];</span><br><span class="line">Â  Â  Â  Â  Â  Â  wself<span class="variable">.lastAddedOperation</span> = operation;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;];</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">return</span> operation;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- (<span class="keyword">void</span>)addProgressCallback:(SDWebImageDownloaderProgressBlock)progressBlock completedBlock:(SDWebImageDownloaderCompletedBlock)completedBlock forURL:(<span class="built_in">NSURL</span> *)url createCallback:(SDWebImageNoParamsBlock)createCallback &#123;</span><br><span class="line">Â  Â  <span class="comment">// The URL will be used as the key to the callbacks dictionary so it cannot be nil. If it is nil immediately call the completed block with no image or data.</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (url == <span class="literal">nil</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (completedBlock != <span class="literal">nil</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  completedBlock(<span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">NO</span>);</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// ä»¥dispatch_barrier_syncæ“ä½œæ¥ä¿è¯åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¯¹URLCallbacksè¿›è¡Œæ“ä½œ</span></span><br><span class="line">Â  Â  <span class="comment">// ä¸ºäº†ä¿è¯URLCallbacksæ“ä½œ(æ·»åŠ ã€åˆ é™¤)çš„çº¿ç¨‹å®‰å…¨æ€§ï¼ŒSDWebImageDownloaderå°†è¿™äº›æ“ä½œä½œä¸ºä¸€ä¸ªä¸ªä»»åŠ¡æ”¾åˆ°barrierQueueé˜Ÿåˆ—ä¸­ï¼Œå¹¶è®¾ç½®å±éšœæ¥ç¡®ä¿åŒä¸€æ—¶é—´åªæœ‰ä¸€ä¸ªçº¿ç¨‹æ“ä½œURLCallbackså±æ€§</span></span><br><span class="line">Â  Â  dispatch_barrier_sync(<span class="keyword">self</span><span class="variable">.barrierQueue</span>, ^&#123;</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">BOOL</span> first = <span class="literal">NO</span>;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (!<span class="keyword">self</span><span class="variable">.URLCallbacks</span>[url]) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">self</span><span class="variable">.URLCallbacks</span>[url] = [<span class="built_in">NSMutableArray</span> new];</span><br><span class="line">Â  Â  Â  Â  Â  Â  first = <span class="literal">YES</span>;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// Handle single download of simultaneous download request for the same URL</span></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// å¤„ç†åŒä¸€URLçš„åŒæ­¥ä¸‹è½½è¯·æ±‚çš„å•ä¸ªä¸‹è½½</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSMutableArray</span> *callbacksForURL = <span class="keyword">self</span><span class="variable">.URLCallbacks</span>[url];</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSMutableDictionary</span> *callbacks = [<span class="built_in">NSMutableDictionary</span> new];</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (progressBlock) callbacks[kProgressCallbackKey] = [progressBlock <span class="keyword">copy</span>];</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (completedBlock) callbacks[kCompletedCallbackKey] = [completedBlock <span class="keyword">copy</span>];</span><br><span class="line">Â  Â  Â  Â  [callbacksForURL addObject:callbacks];</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">self</span><span class="variable">.URLCallbacks</span>[url] = callbacksForURL;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (first) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  createCallback();</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯<code>SDWebImageDownloader</code>ç®¡ç†çš„ä¸‹è½½æ˜¯æ”¾åœ¨ä¸€ä¸ª<code>NSOperationQueue</code>é˜Ÿåˆ—ä¸­æ¥å®Œæˆçš„ï¼Œå…¶ä¸­æ¯ä¸ªä¸‹è½½æ“ä½œéƒ½æ˜¯ä¸€ä¸ªå•ç‹¬çš„<code>SDWebImageDownloaderOperation</code>ï¼Œå°†è¿™äº›æ“ä½œæ”¾åˆ°ä¸€ä¸ªæ“ä½œé˜Ÿåˆ—ä¸­ï¼Œè¿™æ ·å¯ä»¥å®ç°å›¾ç‰‡çš„å¹¶å‘ä¸‹è½½ã€‚</p>
<h5 id="SDWebImageDownloaderOperation">SDWebImageDownloaderOperation</h5><p><code>SDWebImageDownloaderOperation</code>ç»§æ‰¿è‡ªNSOperationï¼Œå®é™…ä¸­æ¯ä¸ªå›¾ç‰‡çš„ä¸‹è½½éƒ½äº¤ç»™ä¸€ä¸ª<code>SDWebImageDownloaderOperation</code>ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯åœ¨SDWebImage Version3.8ä¸­ï¼Œä¸‹è½½å·²ç»æœ‰åŸå…ˆçš„NSURLConnectionåˆ‡æ¢åˆ°äº†NSURLSessionäº†ï¼Œæ‰€ä»¥æˆ‘ä»¬è¦å…³æ³¨çš„æ˜¯NSURLSessionDataDelegateä¸­çš„<code>URLSession:dataTask:didReceiveResponse:completionHandler:</code>æ–¹æ³•ï¼Œæ­¤æ–¹æ³•ä¸»è¦ç”¨æ¥æ¥æ”¶æ•°æ®:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)URLSession:(<span class="built_in">NSURLSession</span> *)session dataTask:(<span class="built_in">NSURLSessionDataTask</span> *)dataTask didReceiveData:(<span class="built_in">NSData</span> *)data &#123;</span><br><span class="line">Â  Â  <span class="comment">// æ¯æ¬¡é™„åŠ æ–°æ•°æ®</span></span><br><span class="line">Â  Â  [<span class="keyword">self</span><span class="variable">.imageData</span> appendData:data];</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">if</span> ((<span class="keyword">self</span><span class="variable">.options</span> &amp; SDWebImageDownloaderProgressiveDownload) &amp;&amp; <span class="keyword">self</span><span class="variable">.expectedSize</span> &gt; <span class="number">0</span> &amp;&amp; <span class="keyword">self</span><span class="variable">.completedBlock</span>) &#123;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// è®°å½•å½“å‰æ€»å¤§å°</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">const</span> <span class="built_in">NSInteger</span> totalSize = <span class="keyword">self</span><span class="variable">.imageData</span><span class="variable">.length</span>;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// æ¯æ¬¡æ¥æ”¶åˆ°æ•°æ®æ—¶ï¼Œç”¨ç°æœ‰çš„æ•°æ®åˆ›å»ºä¸€ä¸ªCGImageSourceRefå¯¹è±¡</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">CGImageSourceRef</span> imageSource = <span class="built_in">CGImageSourceCreateWithData</span>((__bridge <span class="built_in">CFDataRef</span>)<span class="keyword">self</span><span class="variable">.imageData</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (width + height == <span class="number">0</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// ä»è¿™äº›åŒ…å«å›¾åƒä¿¡æ¯çš„æ•°æ®ä¸­å–å‡ºå›¾åƒçš„é•¿ã€å®½ã€æ–¹å‘ç­‰ä¿¡æ¯ä»¥å¤‡ä½¿ç”¨</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">CFDictionaryRef</span> properties = <span class="built_in">CGImageSourceCopyPropertiesAtIndex</span>(imageSource, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (properties) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">NSInteger</span> orientationValue = -<span class="number">1</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CFTypeRef</span> val = <span class="built_in">CFDictionaryGetValue</span>(properties, k<span class="built_in">CGImagePropertyPixelHeight</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (val) <span class="built_in">CFNumberGetValue</span>(val, k<span class="built_in">CFNumberLongType</span>, &amp;height);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  val = <span class="built_in">CFDictionaryGetValue</span>(properties, k<span class="built_in">CGImagePropertyPixelWidth</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (val) <span class="built_in">CFNumberGetValue</span>(val, k<span class="built_in">CFNumberLongType</span>, &amp;width);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  val = <span class="built_in">CFDictionaryGetValue</span>(properties, k<span class="built_in">CGImagePropertyOrientation</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (val) <span class="built_in">CFNumberGetValue</span>(val, k<span class="built_in">CFNumberNSIntegerType</span>, &amp;orientationValue);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CFRelease</span>(properties);</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// ç»˜åˆ¶åˆ°Core Graphicsæ—¶ï¼Œä¼šä¸¢å¤±æ–¹å‘ä¿¡æ¯ï¼Œè¿™æ„å‘³ç€æœ‰æ—¶å€™ç”±initWithCGIImageåˆ›å»ºçš„å›¾ç‰‡</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">//Â  Â  çš„æ–¹å‘ä¼šä¸å¯¹ï¼Œæ‰€ä»¥åœ¨è¿™è¾¹å…ˆä¿å­˜è¿™ä¸ªä¿¡æ¯å¹¶åœ¨åé¢ä½¿ç”¨</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  orientation = [[<span class="keyword">self</span> class] orientationFromPropertyValue:(orientationValue == -<span class="number">1</span> ? <span class="number">1</span> : orientationValue)];</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// ä¸‹è½½æœªå®Œæˆ</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (width + height &gt; <span class="number">0</span> &amp;&amp; totalSize &lt; <span class="keyword">self</span><span class="variable">.expectedSize</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// Create the image</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// ä½¿ç”¨ç°æœ‰çš„æ•°æ®åˆ›å»ºå›¾ç‰‡å¯¹è±¡ï¼Œå¦‚æœæ•°æ®ä¸­å­˜æœ‰å¤šå¼ å›¾ç‰‡ï¼Œåˆ™å–ç¬¬ä¸€å¼ </span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">CGImageRef</span> partialImageRef = <span class="built_in">CGImageSourceCreateImageAtIndex</span>(imageSource, <span class="number">0</span>, <span class="literal">NULL</span>);</span><br><span class="line"></span><br><span class="line"><span class="preprocessor">#ifdef TARGET_OS_IPHONE</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// Workaround for iOS anamorphic image</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (partialImageRef) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">const</span> size_t partialHeight = <span class="built_in">CGImageGetHeight</span>(partialImageRef);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGColorSpaceRef</span> colorSpace = <span class="built_in">CGColorSpaceCreateDeviceRGB</span>();</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGContextRef</span> bmContext = <span class="built_in">CGBitmapContextCreate</span>(<span class="literal">NULL</span>, width, height, <span class="number">8</span>, width * <span class="number">4</span>, colorSpace, k<span class="built_in">CGBitmapByteOrderDefault</span> | k<span class="built_in">CGImageAlphaPremultipliedFirst</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGColorSpaceRelease</span>(colorSpace);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (bmContext) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGContextDrawImage</span>(bmContext, (<span class="built_in">CGRect</span>)&#123;<span class="variable">.origin</span><span class="variable">.x</span> = <span class="number">0.0</span>f, <span class="variable">.origin</span><span class="variable">.y</span> = <span class="number">0.0</span>f, <span class="variable">.size</span><span class="variable">.width</span> = width, <span class="variable">.size</span><span class="variable">.height</span> = partialHeight&#125;, partialImageRef);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGImageRelease</span>(partialImageRef);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partialImageRef = <span class="built_in">CGBitmapContextCreateImage</span>(bmContext);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGContextRelease</span>(bmContext);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGImageRelease</span>(partialImageRef);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  partialImageRef = <span class="literal">nil</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"><span class="preprocessor">#endif</span></span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (partialImageRef) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">UIImage</span> *image = [<span class="built_in">UIImage</span> imageWith<span class="built_in">CGImage</span>:partialImageRef scale:<span class="number">1</span> orientation:orientation];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">NSString</span> *key = [[SDWebImageManager sharedManager] cacheKeyForURL:<span class="keyword">self</span><span class="variable">.request</span><span class="variable">.URL</span>];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// å¯¹å›¾ç‰‡è¿›è¡Œç¼©æ”¾</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">UIImage</span> *scaledImage = [<span class="keyword">self</span> scaledImageForKey:key image:image];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.shouldDecompressImages</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// å¯¹å›¾ç‰‡è§£å‹ç¼©</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image = [<span class="built_in">UIImage</span> decodedImageWithImage:scaledImage];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  image = scaledImage;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGImageRelease</span>(partialImageRef);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  dispatch_main_sync_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.completedBlock</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">self</span><span class="variable">.completedBlock</span>(image, <span class="literal">nil</span>, <span class="literal">nil</span>, <span class="literal">NO</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">CFRelease</span>(imageSource);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.progressBlock</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">self</span><span class="variable">.progressBlock</span>(<span class="keyword">self</span><span class="variable">.imageData</span><span class="variable">.length</span>, <span class="keyword">self</span><span class="variable">.expectedSize</span>);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å½“ç„¶<code>SDWebImageDownloaderOperation</code>æœ¬è´¨æ˜¯ä¸ªNSOperationï¼Œæœ‰startæ–¹æ³•å¯åŠ¨ï¼Œå¹¶åœ¨startæ–¹æ³•é‡Œåˆ›å»ºNSURLSessionä¸‹è½½å›¾ç‰‡ï¼Œæ›´å…·ä½“çš„å¯ä»¥çœ‹æˆ‘æ³¨è§£çš„æºç ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<h3 id="Cache">Cache</h3><p>ä¸»è¦å°±ä¸€ä¸ªç±»<code>SDImageCache</code>,è¿™ä¸ªç±»ç®¡ç†äº†å¯¹å›¾ç‰‡çš„ç¼“å­˜æ“ä½œï¼ŒåŒ…æ‹¬å†…å­˜ç¼“å­˜å’Œç£ç›˜ç¼“å­˜ã€‚<br>å†…å­˜ç¼“å­˜æ˜¯ç”¨NSCacheå®ç°çš„ï¼Œä»¥Key-Valueçš„å½¢å¼å­˜å‚¨å›¾ç‰‡ï¼Œå½“å†…å­˜ä¸å¤Ÿçš„æ—¶å€™ä¼šæ¸…é™¤æ‰€æœ‰ç¼“å­˜å›¾ç‰‡ã€‚<br>ç£ç›˜ç¼“å­˜åˆ™æ˜¯ç¼“å­˜åˆ°æ²™ç›’ä¸­ï¼Œéœ€è¦æ³¨æ„çš„æ–‡ä»¶åæ˜¯keyåšMD5åçš„å­—ç¬¦ä¸²ï¼Œæ–‡ä»¶æ›¿æ¢æ–¹å¼æ˜¯ä»¥æ—¶é—´ä¸ºå•ä½ï¼Œå‰”é™¤æ—¶é—´å¤§äºä¸€å‘¨çš„å›¾ç‰‡æ–‡ä»¶ã€‚<br>æµç¨‹7ä¸­è°ƒç”¨çš„ä¸»è¦ä»£ç ä¸ºï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)storeImage:(<span class="built_in">UIImage</span> *)image recalculateFromImage:(<span class="built_in">BOOL</span>)recalculate imageData:(<span class="built_in">NSData</span> *)imageData forKey:(<span class="built_in">NSString</span> *)key toDisk:(<span class="built_in">BOOL</span>)toDisk &#123;</span><br><span class="line">Â  Â  <span class="keyword">if</span> (!image || !key) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// å†…å­˜ç¼“å­˜ å­˜å…¥NSCache</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.shouldCacheImagesInMemory</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// å›¾ç‰‡costå€¼</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSUInteger</span> cost = SDCacheCostForImage(image);</span><br><span class="line">Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.memCache</span> setObject:image forKey:key cost:cost];</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">// ç£ç›˜ç¼“å­˜</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (toDisk) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// ç£ç›˜ç¼“å­˜ï¼Œåˆ™å°†ç¼“å­˜æ“ä½œä½œä¸ºä¸€ä¸ªä»»åŠ¡æ”¾å…¥ioQueue(ä¸²è¡Œé˜Ÿåˆ—)ä¸­</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">dispatch_async</span>(<span class="keyword">self</span><span class="variable">.ioQueue</span>, ^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSData</span> *data = imageData;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (image &amp;&amp; (recalculate || !data)) &#123;</span><br><span class="line"><span class="preprocessor">#if TARGET_OS_IPHONE</span></span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// éœ€è¦ç¡®å®šå›¾ç‰‡æ˜¯PNGè¿˜æ˜¯JPEGã€‚PNGå›¾ç‰‡å®¹æ˜“æ£€æµ‹ï¼Œå› ä¸ºæœ‰ä¸€ä¸ªå”¯ä¸€ç­¾åã€‚PNGå›¾åƒçš„å‰8ä¸ªå­—èŠ‚æ€»æ˜¯åŒ…å«ä»¥ä¸‹å€¼ï¼š137 80 78 71 13 10 26 10</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// åœ¨imageDataä¸ºnilçš„æƒ…å†µä¸‹å‡å®šå›¾åƒä¸ºPNGã€‚æˆ‘ä»¬å°†å…¶å½“ä½œPNGä»¥é¿å…ä¸¢å¤±é€æ˜åº¦ã€‚è€Œå½“æœ‰å›¾ç‰‡æ•°æ®æ—¶ï¼Œæˆ‘ä»¬æ£€æµ‹å…¶å‰ç¼€ï¼Œç¡®å®šå›¾ç‰‡çš„ç±»å‹</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">int</span> alphaInfo = <span class="built_in">CGImageGetAlphaInfo</span>(image<span class="variable">.CGImage</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">BOOL</span> hasAlpha = !(alphaInfo == k<span class="built_in">CGImageAlphaNone</span> ||</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alphaInfo == k<span class="built_in">CGImageAlphaNoneSkipFirst</span> ||</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  alphaInfo == k<span class="built_in">CGImageAlphaNoneSkipLast</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">BOOL</span> imageIsPng = hasAlpha;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// å½“æœ‰å›¾ç‰‡æ•°æ®æ—¶ï¼Œæˆ‘ä»¬æ£€æµ‹å…¶å‰ç¼€ï¼Œç¡®å®šå›¾ç‰‡çš„ç±»å‹</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> ([imageData length] &gt;= [kPNGSignatureData length]) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  imageIsPng = ImageDataHasPNGPreffix(imageData);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (imageIsPng) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data = <span class="built_in">UIImagePNGRepresentation</span>(image);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  data = <span class="built_in">UIImageJPEGRepresentation</span>(image, (<span class="built_in">CGFloat</span>)<span class="number">1.0</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"><span class="preprocessor">#else</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  data = [<span class="built_in">NSBitmapImageRep</span> representationOfImageRepsInArray:image<span class="variable">.representations</span> usingType: <span class="built_in">NSJPEGFileType</span> properties:<span class="literal">nil</span>];</span><br><span class="line"><span class="preprocessor">#endif</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// åˆ›å»ºç¼“å­˜æ–‡ä»¶å¹¶å­˜å‚¨å›¾ç‰‡</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span> storeImageDataToDisk:data forKey:key];</span><br><span class="line">Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç£ç›˜ç¼“å­˜çš„è‡ªåŠ¨æ¸…ç†æœºåˆ¶ä¸ºï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)cleanDiskWithCompletionBlock:(SDWebImageNoParamsBlock)completionBlock &#123;</span><br><span class="line">Â  Â  <span class="built_in">dispatch_async</span>(<span class="keyword">self</span><span class="variable">.ioQueue</span>, ^&#123;</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSURL</span> *diskCacheURL = [<span class="built_in">NSURL</span> fileURLWithPath:<span class="keyword">self</span><span class="variable">.diskCachePath</span> isDirectory:<span class="literal">YES</span>];</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSArray</span> *resourceKeys = @[<span class="built_in">NSURLIsDirectoryKey</span>, <span class="built_in">NSURLContentModificationDateKey</span>, <span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// è¯¥æšä¸¾å™¨é¢„å…ˆè·å–ç¼“å­˜æ–‡ä»¶çš„æœ‰ç”¨çš„å±æ€§</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSDirectoryEnumerator</span> *fileEnumerator = [_fileManager enumeratorAtURL:diskCacheURL</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  includingPropertiesForKeys:resourceKeys</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  options:<span class="built_in">NSDirectoryEnumerationSkipsHiddenFiles</span></span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  errorHandler:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSDate</span> *expirationDate = [<span class="built_in">NSDate</span> dateWithTimeIntervalSinceNow:-<span class="keyword">self</span><span class="variable">.maxCacheAge</span>];</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSMutableDictionary</span> *cacheFiles = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSUInteger</span> currentCacheSize = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// æšä¸¾ç¼“å­˜æ–‡ä»¶å¤¹ä¸­æ‰€æœ‰æ–‡ä»¶ï¼Œè¯¥è¿­ä»£æœ‰ä¸¤ä¸ªç›®çš„ï¼šç§»é™¤æ¯”è¿‡æœŸæ—¥æœŸæ›´è€çš„æ–‡ä»¶ï¼›å­˜å‚¨æ–‡ä»¶å±æ€§ä»¥å¤‡åé¢æ‰§è¡ŒåŸºäºç¼“å­˜å¤§å°çš„æ¸…ç†æ“ä½œ</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSMutableArray</span> *urlsToDelete = [[<span class="built_in">NSMutableArray</span> alloc] init];</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> fileEnumerator) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSDictionary</span> *resourceValues = [fileURL resourceValuesForKeys:resourceKeys error:<span class="literal">NULL</span>];</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// Skip directories.</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> ([resourceValues[<span class="built_in">NSURLIsDirectoryKey</span>] boolValue]) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">continue</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// ç§»é™¤æ—§çš„è¿‡æœŸæ–‡ä»¶</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSDate</span> *modificationDate = resourceValues[<span class="built_in">NSURLContentModificationDateKey</span>];</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> ([[modificationDate laterDate:expirationDate] isEqualToDate:expirationDate]) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  [urlsToDelete addObject:fileURL];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">continue</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// å­˜å‚¨æ–‡ä»¶çš„å¼•ç”¨ï¼Œè®¡ç®—æ–‡ä»¶çš„æ€»å¤§å°</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSNumber</span> *totalAllocatedSize = resourceValues[<span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line">Â  Â  Â  Â  Â  Â  currentCacheSize += [totalAllocatedSize unsignedIntegerValue];</span><br><span class="line">Â  Â  Â  Â  Â  Â  [cacheFiles setObject:resourceValues forKey:fileURL];</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> urlsToDelete) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  [_fileManager removeItemAtURL:fileURL error:<span class="literal">nil</span>];</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  <span class="comment">// å¦‚æœç£ç›˜ç¼“å­˜çš„å¤§å°å¤§äºæˆ‘ä»¬é…ç½®çš„æœ€å¤§å¤§å°ï¼Œåˆ™æ‰§è¡ŒåŸºäºæ–‡ä»¶å¤§å°çš„æ¸…ç†ï¼Œæˆ‘ä»¬é¦–å…ˆåˆ é™¤æœ€è€çš„æ–‡ä»¶</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.maxCacheSize</span> &gt; <span class="number">0</span> &amp;&amp; currentCacheSize &gt; <span class="keyword">self</span><span class="variable">.maxCacheSize</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// ä»¥è®¾ç½®çš„æœ€å¤§ç¼“å­˜å¤§å°çš„ä¸€åŠä½œä¸ºæ¸…ç†ç›®æ ‡</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">const</span> <span class="built_in">NSUInteger</span> desiredCacheSize = <span class="keyword">self</span><span class="variable">.maxCacheSize</span> / <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// æŒ‰ç…§æœ€åä¿®æ”¹æ—¶é—´æ¥æ’åºå‰©ä¸‹çš„ç¼“å­˜æ–‡ä»¶</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">NSArray</span> *sortedFiles = [cacheFiles keysSortedByValueWithOptions:<span class="built_in">NSSortConcurrent</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  usingComparator:^<span class="built_in">NSComparisonResult</span>(<span class="keyword">id</span> obj1, <span class="keyword">id</span> obj2) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">return</span> [obj1[<span class="built_in">NSURLContentModificationDateKey</span>] compare:obj2[<span class="built_in">NSURLContentModificationDateKey</span>]];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;];</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// åˆ é™¤æ–‡ä»¶ï¼Œç›´åˆ°ç¼“å­˜æ€»å¤§å°é™åˆ°æˆ‘ä»¬æœŸæœ›çš„å¤§å°</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">for</span> (<span class="built_in">NSURL</span> *fileURL <span class="keyword">in</span> sortedFiles) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> ([_fileManager removeItemAtURL:fileURL error:<span class="literal">nil</span>]) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">NSDictionary</span> *resourceValues = cacheFiles[fileURL];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">NSNumber</span> *totalAllocatedSize = resourceValues[<span class="built_in">NSURLTotalFileAllocatedSizeKey</span>];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  currentCacheSize -= [totalAllocatedSize unsignedIntegerValue];</span><br><span class="line"></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (currentCacheSize &lt; desiredCacheSize) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">break</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (completionBlock) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">dispatch_async</span>(dispatch_get_main_queue(), ^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  completionBlock();</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>SDWebImageManagerä¸‹è½½å›¾ç‰‡å‰ä¼šå…ˆæœç´¢å†…å­˜å±‚é¢çš„æ•°æ®ï¼Œå¦‚æœæœ‰ç›´æ¥è¿”å›ï¼Œæ²¡æœ‰çš„è¯å»è®¿é—®ç£ç›˜ï¼Œå°†å›¾ç‰‡ä»ç£ç›˜è¯»å–å‡ºæ¥ï¼Œç„¶ååšDecoderï¼Œå†å°†å›¾ç‰‡å¯¹è±¡æ”¾åˆ°å†…å­˜åšå¤‡ä»½ã€‚<br>æ›´ä¸ºå…·ä½“å…³äºå›¾ç‰‡çš„æŸ¥è¯¢ã€åˆ é™¤å¯ä»¥çœ‹æˆ‘æ³¨è§£çš„æºç ï¼Œè¿™é‡Œä¸å†èµ˜è¿°ã€‚</p>
<h3 id="Categories">Categories</h3><p>è¿™é‡Œä¸»è¦çœ‹<code>UIImageView+WebCache</code>è¿™ä¸ªç±»ï¼Œåœ¨æµç¨‹2ä¸­æ ¸å¿ƒæ–¹æ³•ä¸ºï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)sd_setImageWithURL:(<span class="built_in">NSURL</span> *)url placeholderImage:(<span class="built_in">UIImage</span> *)placeholder options:(SDWebImageOptions)options progress:(SDWebImageDownloaderProgressBlock)progressBlock completed:(SDWebImageCompletionBlock)completedBlock &#123;</span><br><span class="line">Â  Â  <span class="comment">// å–æ¶ˆä¸Šä¸€æ¬¡æ“ä½œ</span></span><br><span class="line">Â  Â  [<span class="keyword">self</span> sd_cancelCurrentImageLoad];</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="comment">// æ‹¿åˆ°urlï¼Œåœ¨è¿™é‡ŒsetAssociatedObject</span></span><br><span class="line">Â  Â  objc_setAssociatedObject(<span class="keyword">self</span>, &amp;imageURLKey, url, OBJC_ASSO<span class="built_in">CIATION_RETAIN_NONATOMIC</span>);</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="keyword">if</span> (!(options &amp; SDWebImageDelayPlaceholder)) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// ç¡®ä¿åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œ</span></span><br><span class="line">Â  Â  Â  Â  dispatch_main_async_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">self</span><span class="variable">.image</span> = placeholder;</span><br><span class="line">Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="keyword">if</span> (url) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// check if activityView is enabled or not</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> ([<span class="keyword">self</span> showActivityIndicatorView]) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span> addActivityIndicator];</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  __<span class="keyword">weak</span> __<span class="keyword">typeof</span>(<span class="keyword">self</span>)wself = <span class="keyword">self</span>;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">id</span> &lt;SDWebImageOperation&gt; operation = [SDWebImageManager<span class="variable">.sharedManager</span> downloadImageWithURL:url options:options progress:progressBlock completed:^(<span class="built_in">UIImage</span> *image, <span class="built_in">NSError</span> *error, SDImageCacheType cacheType, <span class="built_in">BOOL</span> finished, <span class="built_in">NSURL</span> *imageURL) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  [wself removeActivityIndicator];</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (!wself) <span class="keyword">return</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  dispatch_main_sync_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (!wself) <span class="keyword">return</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// é€‰æ‹©äº†SDWebImageAvoidAutoSetImageæ ‡è®°ï¼Œä¼šå…ˆè¿”å›imageä¸åŠ è½½å›¾ç‰‡ï¼Œä»¥ä¾¿æ·»åŠ åŠ¨ç”»æ•ˆæœæˆ–è¿‡æ»¤å™¨</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (image &amp;&amp; (options &amp; SDWebImageAvoidAutoSetImage) &amp;&amp; completedBlock)</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedBlock(image, error, cacheType, url);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">return</span>;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// åªæœ‰imageï¼Œä¸‹è½½æˆåŠŸååŠ è½½</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">else</span> <span class="keyword">if</span> (image) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wself<span class="variable">.image</span> = image;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [wself setNeedsLayout];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// å›¾ç‰‡ä¸å­˜åœ¨æˆ–ä¸‹è½½å¤±è´¥æˆ–SDWebImageDelayPlaceholderï¼ŒåŠ è½½placeholder</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> ((options &amp; SDWebImageDelayPlaceholder)) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  wself<span class="variable">.image</span> = placeholder;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  [wself setNeedsLayout];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (completedBlock &amp;&amp; finished) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  completedBlock(image, error, cacheType, url);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  Â  Â  &#125;];</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// ä¿å­˜æœ¬æ¬¡æ“ä½œ,ä¿å­˜å‰ä¼šå…ˆcancelä¸Šæ¬¡æ“ä½œ</span></span><br><span class="line">Â  Â  Â  Â  [<span class="keyword">self</span> sd_setImageLoadOperation:operation forKey:<span class="string">@"UIImageViewImageLoad"</span>];</span><br><span class="line">Â  Â  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  dispatch_main_async_safe(^&#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  [<span class="keyword">self</span> removeActivityIndicator];</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="keyword">if</span> (completedBlock) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">NSError</span> *error = [<span class="built_in">NSError</span> errorWithDomain:SDWebImageErrorDomain code:-<span class="number">1</span> userInfo:@&#123;<span class="built_in">NSLocalizedDescriptionKey</span> : <span class="string">@"Trying to load a nil url"</span>&#125;];</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="comment">// urlä¸å­˜åœ¨ï¼ŒSDImageCacheTypeNone</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  completedBlock(<span class="literal">nil</span>, error, SDImageCacheTypeNone, url);</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;);</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="æ€»ç»“">æ€»ç»“</h3><ul>
<li>1.ä¸»åŠ¨ä¸ºå¼€å‘è€…è€ƒè™‘<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// Very common mistake is to send the URL using NSString object instead of NSURL. For some strange reason, XCode won't</span></span><br><span class="line"><span class="comment">// throw any warning for this type mismatch. Here we failsafe this error by allowing URLs to be passed as NSString.</span></span><br><span class="line"><span class="keyword">if</span> ([url <span class="string">isKindOfClass:</span>NSString.<span class="keyword">class</span>]) &#123;</span><br><span class="line">Â  Â  url = [NSURL <span class="string">URLWithString:</span>(NSString *)url];</span><br><span class="line">Â &#125;</span><br></pre></td></tr></table></figure>
</li>
</ul>
<p>ä»£ç é‡Œåœ¨åˆ¤æ–­urlçš„åˆæ³•æ€§ä¸Šï¼Œä¸»åŠ¨å¸®å°†NSStringå½“NSURLçš„æ–°æ‰‹æ“¦å±è‚¡ï¼Œè¿è¿™ä¸ªé—®é¢˜éƒ½è€ƒè™‘åˆ°äº†ï¼Œæ˜¯ä¸æ˜¯æœ‰å¾ˆå¤šåœ¨è¿™é‡ŒæŠ¥é”™çš„äººç»™ä»–æissueå‘¢ï¼Ÿï¼ˆç¬‘~</p>
<ul>
<li><p>2.ä½ç§»æšä¸¾<br>åˆå›é¡¾äº†ä¸€éä½ç§»æšä¸¾ã€‚</p>
</li>
<li><p>3.dispatch_main_async_safe</p>
</li>
</ul>
<figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#define dispatch_main_async_safe(block)\</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> ([NSThread isMainThread]) &#123;<span class="string">\</span></span><br><span class="line">Â  Â  Â  Â  block();<span class="string">\</span></span><br><span class="line">Â  Â  &#125; <span class="keyword">else</span> &#123;<span class="string">\</span></span><br><span class="line">Â  Â  Â  Â  dispatch_async(dispatch_get_main_queue(), block);<span class="string">\</span></span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<p>ç›®çš„æ˜¯æƒ³åœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œæ“ä½œï¼Œä¸ºä»€ä¹ˆè¦åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦å°±æ˜¯ä¸»çº¿ç¨‹ä¸­å‘¢ï¼Ÿ<br>å¦‚æœåœ¨ä¸»çº¿ç¨‹ä¸­æ‰§è¡Œdispatch_sync(dispatch_get_main_queue(), block) åŒæ­¥æ“ä½œæ—¶ï¼Œä¼šå‡ºç°æ­»é”é—®é¢˜ï¼Œå› ä¸ºä¸»çº¿ç¨‹æ­£åœ¨æ‰§è¡Œå½“å‰ä»£ç ï¼Œæ ¹æœ¬æ— æ³•å°†blockæ·»åŠ åˆ°ä¸»é˜Ÿåˆ—ä¸­ã€‚</p>
<ul>
<li><p>4.@synchronized<br>ç›¸å½“äºåŠ é”ï¼Œåœ¨SDWebImageé‡Œè¡¨ç°ä¸º<code>@synchronized(syncObject) { }</code>,å…·ä½“çš„è¯´ï¼Œæ˜¯åœ¨æŸä¸ªå¯¹è±¡å®ä¾‹å†…ï¼Œå¯ä»¥é˜²æ­¢å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®è¿™ä¸ªå¯¹è±¡çš„synchronizedæ–¹æ³•ï¼ˆå¦‚æœä¸€ä¸ªå¯¹è±¡æœ‰å¤šä¸ªsynchronizedæ–¹æ³•ï¼Œåªè¦ä¸€ä¸ªçº¿ç¨‹è®¿é—®äº†å…¶ä¸­çš„ä¸€ä¸ªsynchronizedæ–¹æ³•ï¼Œå…¶å®ƒçº¿ç¨‹ä¸èƒ½åŒæ—¶è®¿é—®è¿™ä¸ªå¯¹è±¡ä¸­ä»»ä½•ä¸€ä¸ªsynchronizedæ–¹æ³•ï¼‰ã€‚è¿™æ—¶ï¼Œä¸åŒçš„å¯¹è±¡å®ä¾‹çš„ synchronizedæ–¹æ³•æ˜¯ä¸ç›¸å¹²æ‰°çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå…¶å®ƒçº¿ç¨‹ç…§æ ·å¯ä»¥åŒæ—¶è®¿é—®ç›¸åŒç±»çš„å¦ä¸€ä¸ªå¯¹è±¡å®ä¾‹ä¸­çš„synchronizedæ–¹æ³•ï¼›<br>è¿™é‡Œå¼•ç”³ä¸€ä¸ªï¼Œè‹¥åŒæ—¶é‡å†™æŸå±æ€§çš„setterå’Œgetteræ–¹æ³•åï¼Œéœ€åŠ ä¸Š<code>@synthesize propertyName = _propertyName;</code>ï¼Œè¿™æ˜¯å› ä¸ºåŒæ—¶é‡å†™åï¼Œç³»ç»Ÿå°±ä¸ä¼šå¸®ä½ è‡ªåŠ¨ç”Ÿæˆè¿™ä¸ªæˆå‘˜å˜é‡ã€‚</p>
</li>
<li><p>5.å¼€å¯åå°ä»»åŠ¡</p>
</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">-(<span class="keyword">void</span>)backgroundCleanDisk &#123;</span><br><span class="line">Â  Â  Class <span class="built_in">UIApplicationClass</span> = <span class="built_in">NSClassFromString</span>(<span class="string">@"UIApplication"</span>);</span><br><span class="line">Â  Â  <span class="keyword">if</span>(!<span class="built_in">UIApplicationClass</span> || ![<span class="built_in">UIApplicationClass</span> respondsToSelector:<span class="keyword">@selector</span>(sharedApplication)]) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="built_in">UIApplication</span> *application = [<span class="built_in">UIApplication</span> performSelector:<span class="keyword">@selector</span>(sharedApplication)];</span><br><span class="line">Â  Â  __block <span class="built_in">UIBackgroundTaskIdentifier</span> bgTask = [application beginBackgroundTaskWithExpirationHandler:^&#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// æ¸…ç†ä»»ä½•æœªå®Œæˆçš„ä»»åŠ¡ä½œä¸šï¼Œæ ‡è®°å®Œå…¨åœæ­¢æˆ–ç»“æŸä»»åŠ¡ã€‚</span></span><br><span class="line">Â  Â  Â  Â  [application endBackgroundTask:bgTask];</span><br><span class="line">Â  Â  Â  Â  bgTask = <span class="built_in">UIBackgroundTaskInvalid</span>;</span><br><span class="line">Â  Â  &#125;];</span><br><span class="line"></span><br><span class="line">Â  Â  <span class="comment">// å¼€å§‹é•¿æ—¶é—´åå°è¿è¡Œçš„ä»»åŠ¡å¹¶ä¸”ç«‹å³returnã€‚</span></span><br><span class="line">Â  Â  [<span class="keyword">self</span> cleanDiskWithCompletionBlock:^&#123;</span><br><span class="line">Â  Â  Â  Â  [application endBackgroundTask:bgTask];</span><br><span class="line">Â  Â  Â  Â  bgTask = <span class="built_in">UIBackgroundTaskInvalid</span>;</span><br><span class="line">Â  Â  &#125;];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æƒ³è¦æé«˜è¿˜å¾—çœ‹æºç ï¼Œæ€»çš„æ¥è¯´é˜…è¯»æºç è·ç›ŠåŒªæµ…ã€‚<br>ç›¸å…³çš„æ³¨è§£åœ¨<a href="https://github.com/v2panda/PDSourceNotes" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
<h3 id="Reference">Reference</h3><p><a href="https://github.com/rs/SDWebImage" target="_blank" rel="external">https://github.com/rs/SDWebImage</a><br><a href="http://blog.csdn.net/uxyheaven/article/details/7909373" target="_blank" rel="external">http://blog.csdn.net/uxyheaven/article/details/7909373</a><br><a href="http://southpeak.github.io/blog/2015/02/07/sourcecode-sdwebimage/" target="_blank" rel="external">http://southpeak.github.io/blog/2015/02/07/sourcecode-sdwebimage/</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="å‰è¨€">å‰è¨€</h3><p><a href="https://github.com/rs/SDWebImage">SDWebImage</a>æ˜¯ä¸€ä¸ªå›¾ç‰‡åŠ è½½åº“ï¼Œç›®å‰åœ¨Githubä¸Šå·²æœ‰å°†è¿‘14kçš„staräº†ï¼Œè¿™ç¯‡æ–‡ç« è®°å½•äº†é˜…è¯»SDWebImageæºç çš„ç¬”è®°(Version 3.8)ï¼Œç®€å•çš„ç ”ç©¶äº†å®ƒçš„å®ç°ç»†èŠ‚ã€‚</p>
<h3 id="æµç¨‹">æµç¨‹</h3><p>SDWebImageåŠ è½½å›¾ç‰‡çš„å¤§è‡´æµç¨‹ï¼Œä»¥UIImageView+WebCacheä¸ºä¾‹ã€‚</p>
<p>1.è°ƒç”¨åŸºç¡€å…¥å£æ–¹æ³•<br><code>sd_setImageWithURL:</code>,<code>sd_setImageWithURL:placeholderImage:</code>,<code>sd_setImageWithURL:placeholderImage:options:</code>ç­‰ç­‰</p>
<p>2.è¿›å…¥<code>sd_setImageWithURL:placeholderImage:options:progress:completed:</code></p>
<p>3.è¿›å…¥<code>downloadImageWithURL:options:progress:completed:</code></p>
<p>4.è°ƒç”¨SDWebImageDownloaderä¸‹è½½å›¾ç‰‡<code>downloadImageWithURL:options:progress:completed:</code></p>
<p>5.è°ƒç”¨<code>addProgressCallback:completedBlock:forURL:createCallback:</code></p>
<p>6.åˆå§‹åŒ–SDWebImageDownloaderOperation<br><code>initWithRequest:inSession:options:progress:completed:cancelled:</code></p>
<p>7.ç¼“å­˜å›¾ç‰‡è°ƒç”¨<code>storeImage:recalculateFromImage:imageData:forKey:toDisk:</code></p>
<p>ä»¥ä¸Šæ–¹æ³•æ˜¯è°ƒç”¨é“¾ä¸Šçš„ä¸»è¦æ–¹æ³•ï¼Œå°†åœ¨ä¸‹æ–‡é€ä¸€è§£é‡Šã€‚</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[SimpleNote 2.0 - ç”¨å¿ƒè®°å½•æ–‡å­—]]></title>
    <link href="http://v2panda.com/2016/05/28/simplenote/"/>
    <id>http://v2panda.com/2016/05/28/simplenote/</id>
    <published>2016-05-28T10:30:57.000Z</published>
    <updated>2016-05-28T10:32:19.000Z</updated>
    <content type="html"><![CDATA[<p>SimpleNoteæ˜¯ä¸€ä¸ªè®°å½•ä½ è‡ªå·±çš„ç¬”è®°åº”ç”¨ï¼Œæ¸©æš–ã€ç®€çº¦ï¼Œç”¨å¿ƒè®°å½•æ–‡å­—ï¼Œæ„Ÿå—ä¹¦å†™çš„æœ¬è´¨ã€‚</p>
<p>åœ°å€ï¼š<a href="https://github.com/v2panda/SimpleNote" target="_blank" rel="external">https://github.com/v2panda/SimpleNote</a></p>
<p>SimpleNoteæ˜¯å¤§å››å®ä¹ æ—¶å†™çš„ä¸€ä¸ªAppï¼Œä½†ç°åœ¨çœ‹çœ‹ä»¥å‰çš„ä»£ç ï¼Œå„ç§é—®é¢˜ã€æ¼æ´ç™¾å‡ºï¼Œæ— æ³•å¿å—ã€‚å°±å†³å®šé‡æ„å‡º2.0ç‰ˆæœ¬ï¼Œäºæ˜¯åœ¨ä¸šä½™æ—¶é—´é‡Œæ–­æ–­ç»­ç»­åšè¿™ä¸ªAppï¼Œç®—æ˜¯é‡æ„äº†ä¸€éå§ï¼Œè¿™æ¬¡ä¹Ÿæ”¾å¼ƒå†™UIçš„æ–¹å¼ï¼Œä½¿ç”¨StoryBoard+xibçš„æ–¹å¼å¸ƒå±€ã€‚</p>
<a id="more"></a>
<h3 id="ä¸ºä»€ä¹ˆè¦é‡æ„ï¼Ÿ">ä¸ºä»€ä¹ˆè¦é‡æ„ï¼Ÿ</h3><ul>
<li>è§‰å¾—ä»¥å‰å†™çš„ä»£ç å¤ªçƒ‚</li>
<li>å……å®ä¸šä½™æ—¶é—´ï¼Œè¦æ˜¯ä¸€æ®µæ—¶é—´æˆ‘ä»€ä¹ˆä¸œè¥¿éƒ½æ²¡æŠ˜è…¾å‡ºæ¥ï¼Œæˆ‘ä¼šæ„Ÿåˆ°å¾ˆä¸å®‰</li>
<li>é‡æ„å¯ä»¥å¸®æˆ‘æ•´ç†è‡ªå·±çš„æ€è·¯ï¼Œä¼˜åŒ–ä»¥å‰çš„çƒ‚ä»£ç </li>
<li>æ‰¾å›æŒ‰è‡ªå·±æ„æ„¿ç¼–ç¨‹çš„æ„Ÿè§‰(è¿™è·Ÿå·¥ä½œä¸Šçš„ç¼–ç¨‹æ˜¯å®Œå…¨ä¸åŒçš„)</li>
</ul>
<h3 id="ç»“æœåæ€">ç»“æœåæ€</h3><p>ç›®å‰åšAppå¯¹æˆ‘æ¥è¯´æœ€å¤§çš„å›°éš¾å°±æ˜¯è®¾è®¡äº†ï¼Œè¿™é‡Œä¸å…‰æ˜¯UIä¸Šçš„è®¾è®¡ï¼Œè¿˜æœ‰äº§å“ä¸Šçš„ï¼Œè¿™éƒ½æ˜¯æˆ‘çš„çŸ­æ¿ã€‚å‰æœŸåœ¨è®¾è®¡ä¸ŠèŠ±äº†æŒºå¤šæ—¶é—´ï¼Œä¸­é—´ä¹Ÿæœ‰å„ç§æ–°çš„æƒ³æ³•ï¼Œæ–°çš„åŠŸèƒ½æ·»åŠ ï¼Œè¿™å¯¼è‡´æˆ‘åœ¨å†™ä»£ç æ—¶èµ°äº†ä¸å°‘å¼¯è·¯ï¼Œå¾ˆå¤šé¡µé¢å’ŒåŠŸèƒ½å®ç°å‡ºæ¥åè§‰å¾—ä¸å¥½çœ‹æˆ–è€…ä¸æ»¡æ„ï¼Œåˆéƒ½åˆ æ‰äº†ã€‚åœ¨è¿™åˆ åˆ æ”¹æ”¹çš„è¿‡ç¨‹ä¸­ï¼Œæ„Ÿå—åˆ°äº†ä¸€ä¸ªå¥½äº§å“ç»ç†çš„é‡è¦æ€§ã€‚æ›´ä½“ä¼šåˆ°ä»æœ‰ä¸ªå¥½Ideaï¼Œåˆ°çœŸæ­£å»å®ç°è¿™ä¸ªIdeaä¸­é—´è¿˜æœ‰å¥½å¤šè·¯è¦èµ°ã€‚</p>
<h3 id="æ„Ÿè°¢å¼€æº">æ„Ÿè°¢å¼€æº</h3><ul>
<li>æœ¬åœ°å­˜å‚¨ï¼š<a href="https://realm.io/" target="_blank" rel="external">Realm</a></li>
<li>åå°ï¼š<a href="https://leancloud.cn/" target="_blank" rel="external">LeanCloud</a></li>
<li>å›¾æ–‡æ··æ’ï¼š<a href="https://github.com/ibireme/YYText" target="_blank" rel="external">YYText</a></li>
</ul>
]]></content>
    <summary type="html">
    <![CDATA[<p>SimpleNoteæ˜¯ä¸€ä¸ªè®°å½•ä½ è‡ªå·±çš„ç¬”è®°åº”ç”¨ï¼Œæ¸©æš–ã€ç®€çº¦ï¼Œç”¨å¿ƒè®°å½•æ–‡å­—ï¼Œæ„Ÿå—ä¹¦å†™çš„æœ¬è´¨ã€‚</p>
<p>åœ°å€ï¼š<a href="https://github.com/v2panda/SimpleNote">https://github.com/v2panda/SimpleNote</a></p>
<p>SimpleNoteæ˜¯å¤§å››å®ä¹ æ—¶å†™çš„ä¸€ä¸ªAppï¼Œä½†ç°åœ¨çœ‹çœ‹ä»¥å‰çš„ä»£ç ï¼Œå„ç§é—®é¢˜ã€æ¼æ´ç™¾å‡ºï¼Œæ— æ³•å¿å—ã€‚å°±å†³å®šé‡æ„å‡º2.0ç‰ˆæœ¬ï¼Œäºæ˜¯åœ¨ä¸šä½™æ—¶é—´é‡Œæ–­æ–­ç»­ç»­åšè¿™ä¸ªAppï¼Œç®—æ˜¯é‡æ„äº†ä¸€éå§ï¼Œè¿™æ¬¡ä¹Ÿæ”¾å¼ƒå†™UIçš„æ–¹å¼ï¼Œä½¿ç”¨StoryBoard+xibçš„æ–¹å¼å¸ƒå±€ã€‚</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[APPç ¸å£³]]></title>
    <link href="http://v2panda.com/2016/04/24/app-reverse/"/>
    <id>http://v2panda.com/2016/04/24/app-reverse/</id>
    <published>2016-04-24T06:06:55.000Z</published>
    <updated>2016-04-24T06:11:24.000Z</updated>
    <content type="html"><![CDATA[<h3 id="å·¥å…·">å·¥å…·</h3><ul>
<li><a href="http://stevenygard.com/projects/*class-dump*/" target="_blank" rel="external">class-dump</a></li>
<li><a href="https://github.com/stefanesser/dumpdecrypted" target="_blank" rel="external">dumpdecrypted</a></li>
<li>ä¸€éƒ¨è¶Šç‹±æ‰‹æœº</li>
<li>OpenSSH(Cydia)</li>
<li>Cycript(Cydia)</li>
<li>adv-cmds(Cydia)</li>
</ul>
<a id="more"></a>
<h3 id="æ­¥éª¤">æ­¥éª¤</h3><p>1.ç”¨sshè¿›å…¥è¿ä¸Šçš„iPhone<strong>(ç¡®ä¿iPhoneå’ŒMacåœ¨åŒä¸€ä¸ªç½‘æ®µ)</strong>ã€‚OpenSSHçš„rootå¯†ç é»˜è®¤ä¸º<em>alpine</em>ã€‚</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ssh root@<span class="number">192.168</span><span class="number">.2</span><span class="number">.10</span></span><br></pre></td></tr></table></figure>
<p>2.å…³é—­æ‰€æœ‰åå°appï¼Œä»…ä¿æŒéœ€è¦ç ´è§£çš„appåœ¨åå°ï¼Œè¾“å…¥å‘½ä»¤<code>ps -e</code>ï¼Œæ‰¾åˆ°appçš„bundleåœ°å€,å¦‚6429è¡Œæ‰€ç¤º</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">6408</span> ??         <span class="number">0</span>:<span class="number">00.40</span> /usr/libexec/ptpd -t usb</span><br><span class="line"><span class="number">6429</span> ??         <span class="number">0</span>:<span class="number">01.44</span> /var/mobile/Containers/Bundle/Application/<span class="number">79909146</span>-D31F-<span class="number">4225</span>-B18E-<span class="number">8</span>D08D5599FFA/XXX.app/XXX</span><br><span class="line"><span class="number">6448</span> ??         <span class="number">0</span>:<span class="number">00.28</span> sshd: root@ttys000</span><br><span class="line"><span class="number">6450</span> ttys000    <span class="number">0</span>:<span class="number">00.05</span> -sh</span><br><span class="line"><span class="number">6487</span> ttys000    <span class="number">0</span>:<span class="number">00.01</span> ps -e</span><br></pre></td></tr></table></figure>
<p>3.ä½¿ç”¨cycriptå‘½ä»¤ï¼Œæ‰¾åˆ°ç›®æ ‡appçš„Documentsè·¯å¾„ï¼Œè¾“å…¥<code>cycript -p XXX</code></p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">v2panda-iPhone-<span class="number">5</span>s:~ root<span class="preprocessor"># cycript -p XXX</span></span><br><span class="line">cy<span class="preprocessor">#</span></span><br></pre></td></tr></table></figure>
<p>åœ¨cy#åé”®å…¥</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[<span class="link_label">[NSFileManager defaultManager</span>] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask][0]</span><br></pre></td></tr></table></figure>
<p>å¦‚å›¾ï¼Œè®°å½•ä¸‹Documentsåœ°å€ï¼Œctrl+zé€€å‡º</p>
<figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">v2panda-iPhone-5s:~ root# cycript -p XXX</span><br><span class="line">cy# [<span class="link_label">[NSFileManager defaultManager</span>] URLsForDirectory:NSDocumentDirectory inDomains:NSUserDomainMask][0]</span><br><span class="line"><span class="header">#"file:///var/mobile/Containers/Data/Application/9491960B-BAE6-439A-B210-3B183AB657EF/Documents/"</span></span><br><span class="line">cy#</span><br></pre></td></tr></table></figure>
<p>4.å°†ç”Ÿæˆçš„å°†dumpdecrypted.dylibæ‹·è´åˆ°Documentsç›®å½•ä¸‹</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp dumpdecrypted.dylib root<span class="variable">@192</span>.<span class="number">168.2</span>.<span class="number">10</span><span class="symbol">:/var/mobile/Containers/Data/Application/</span><span class="number">9491960</span>B-<span class="constant">BAE6</span>-<span class="number">439</span>A-<span class="constant">B210</span>-<span class="number">3</span>B183AB657EF/<span class="constant">Documents</span>/</span><br><span class="line">root<span class="variable">@192</span>.<span class="number">168.2</span>.<span class="number">10</span><span class="string">'s password:</span><br><span class="line">dumpdecrypted.dylib                                                                                          100%  193KB 192.9KB/s   00:00</span></span><br></pre></td></tr></table></figure>
<p>5.å¼€å§‹ç ¸å£³ï¼Œä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ï¼Œä¼šåœ¨å½“å‰ç›®å½•ä¸‹ç”ŸæˆXXX.decryptedç ¸å£³åçš„æ–‡ä»¶ã€‚</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="constant">DYLD_INSERT_LIBRARIES</span>=<span class="regexp">/path/to</span><span class="regexp">/dumpdecrypted.dylib /path</span><span class="regexp">/to/executable</span></span><br></pre></td></tr></table></figure>
<p>å…·ä½“çš„ä¸º</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">v2panda-iPhone-<span class="number">5</span>s:~ root<span class="preprocessor"># DYLD_INSERT_LIBRARIES=/var/mobile/Containers/Data/Application/<span class="number">9491960</span>B-BAE6-<span class="number">439</span>A-B210-<span class="number">3</span>B183AB657EF/Documents/dumpdecrypted.dylib /var/mobile/Containers/Bundle/Application/<span class="number">79909146</span>-D31F-<span class="number">4225</span>-B18E-<span class="number">8</span>D08D5599FFA/XXX.app/XXX</span></span><br><span class="line">mach-o decryption dumper</span><br><span class="line"></span><br><span class="line">DISCLAIMER: This tool is only meant <span class="keyword">for</span> security research purposes, not <span class="keyword">for</span> application crackers.</span><br><span class="line"></span><br><span class="line">[+] detected <span class="number">64</span>bit ARM binary in memory.</span><br><span class="line">[+] offset to cryptid found: @<span class="number">0x10003cb68</span>(from <span class="number">0x10003c000</span>) = b68</span><br><span class="line">[+] Found encrypted data at address <span class="number">00004000</span> of length <span class="number">180224</span> bytes - type <span class="number">1.</span></span><br><span class="line">[+] Opening /<span class="keyword">private</span>/var/mobile/Containers/Bundle/Application/<span class="number">79909146</span>-D31F-<span class="number">4225</span>-B18E-<span class="number">8</span>D08D5599FFA/XXX.app/XXX <span class="keyword">for</span> reading.</span><br><span class="line">[+] Reading header</span><br><span class="line">[+] Detecting header type</span><br><span class="line">[+] Executable is a FAT image - searching <span class="keyword">for</span> right architecture</span><br><span class="line">[+] Correct arch is at offset <span class="number">245760</span> in the file</span><br><span class="line">[+] Opening SimpleNote.decrypted <span class="keyword">for</span> writing.</span><br><span class="line">[+] Copying the not encrypted start of the file</span><br><span class="line">[+] Dumping the decrypted data into the file</span><br><span class="line">[+] Copying the not encrypted remainder of the file</span><br><span class="line">[+] Setting the LC_ENCRYPTION_INFO-&gt;cryptid to <span class="number">0</span> at offset <span class="number">3</span>cb68</span><br><span class="line">[+] Closing original file</span><br><span class="line">[+] Closing dump file</span><br><span class="line">v2panda-iPhone-<span class="number">5</span>s:~ root<span class="preprocessor">#</span></span><br></pre></td></tr></table></figure>
<p>6.å°†ç ¸å£³åçš„XXX.decryptedæ–‡ä»¶æ‹·è´åˆ°ç”µè„‘ä¸Šã€‚</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">scp root<span class="variable">@192</span>.<span class="number">168.2</span>.<span class="number">10</span><span class="symbol">:/var/root/XXX</span>.decrypted /<span class="constant">Users</span>/v2panda/<span class="constant">Apps</span></span><br><span class="line">root<span class="variable">@192</span>.<span class="number">168.2</span>.<span class="number">10</span><span class="string">'s password:</span><br><span class="line">XXX.decrypted                                                                                         100%  507KB 253.7KB/s   00:02</span></span><br></pre></td></tr></table></figure>
<p>7.classdumpä¹‹</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./<span class="class"><span class="keyword">class</span>-<span class="title">dump</span> -<span class="title">s</span> -<span class="title">S</span> -<span class="title">H</span> ./<span class="title">XXX</span>.<span class="title">decrypted</span> -<span class="title">o</span> ./<span class="title">sn</span></span></span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œä»¥å¾®ä¿¡ä¸ºä¾‹ï¼Œ7000+çš„æ–‡ä»¶ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/app-reverse.jpeg" alt="WeChat.png"></p>
<h3 id="åè®°">åè®°</h3><p>è¿™é‡Œç®€å•è®°å½•ä¸‹Appç ¸å£³çš„æœ‰å…³æ­¥éª¤,æ›´å¤šè¯¦ç»†å†…å®¹ä»¥åŠåç»­å¼€å‘å¯åˆ°<a href="http://bbs.iosre.com/" target="_blank" rel="external">iOSRE</a>æŸ¥çœ‹ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="å·¥å…·">å·¥å…·</h3><ul>
<li><a href="http://stevenygard.com/projects/*class-dump*/">class-dump</a></li>
<li><a href="https://github.com/stefanesser/dumpdecrypted">dumpdecrypted</a></li>
<li>ä¸€éƒ¨è¶Šç‹±æ‰‹æœº</li>
<li>OpenSSH(Cydia)</li>
<li>Cycript(Cydia)</li>
<li>adv-cmds(Cydia)</li>
</ul>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[åŸºäºJSPatchçš„åœ¨çº¿æ›´æ–°]]></title>
    <link href="http://v2panda.com/2016/03/29/hotfix-jspatch/"/>
    <id>http://v2panda.com/2016/03/29/hotfix-jspatch/</id>
    <published>2016-03-29T12:21:33.000Z</published>
    <updated>2016-03-29T12:32:59.000Z</updated>
    <content type="html"><![CDATA[<h3 id="å‰è¨€">å‰è¨€</h3><p>é™äºAppStoreçš„å®¡æ ¸æœºåˆ¶ï¼Œè‹¹æœåº”ç”¨å®¡æ ¸é€šå¸¸éœ€è¦ä¸€æ®µæ—¶é—´ã€‚è¿™å¯¹æŸäº›åº”ç”¨å¼€å‘è¿­ä»£æ¯”è¾ƒå¿«çš„å…¬å¸æ¥è¯´ï¼Œå¾€å¾€ä¸Šä¸€ç‰ˆæœ¬è¿˜åœ¨AppStoreå®¡æ ¸ï¼Œæ–°ä¸€ç‰ˆæœ¬å·²ç»å¼€å‘å®Œæ¯•äº†ï¼Œç›¸å¯¹äºAndroidçš„å½“å¤©å‘å¸ƒæ¥è¯´ï¼Œå·²ç»ç®—æ˜¯ä¸èƒ½å†æ…¢äº†ã€‚è¦æ˜¯æ­£å¥½é‡ä¸Šçº¿ä¸Šæœ‰bugï¼Œé‚£ä¹ˆåˆå¾—é‡æ–°å›åˆ°AppStoreæäº¤-å®¡æ ¸-å‘å¸ƒçš„æµç¨‹ä¸­å»ï¼Œä½†è‹¥æ˜¯ååˆ†ç´§è¦çš„bugï¼Œä¸ä¿®å¤ä¼šå½±å“åº”ç”¨çš„æ­£å¸¸ä½¿ç”¨ï¼Œé‚£ä¹ˆå†èµ°è¿™ä¸ªæµç¨‹å°±æ˜¾å¾—éå¸¸æ…¢äº†ã€‚ä»¥å‰é¢å¯¹è¿™ç§é—®é¢˜å¾€å¾€æ˜¯èµ°åŠ æ€¥å®¡æ ¸ï¼Œä½†åŠ æ€¥å®¡æ ¸ä¹Ÿä¼šæœ‰3å¤©æ—¶é—´ï¼Œé‚£èƒ½ä¸èƒ½ä¸å‘å¸ƒç‰ˆæœ¬åœ¨çº¿ä¸Šä¿®å¤bugå‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œè¿™é‡Œé€‰æ‹©çš„æ–¹æ¡ˆæ˜¯JSPatchã€‚</p>
<a id="more"></a>
<h3 id="JSPatchç®€ä»‹">JSPatchç®€ä»‹</h3><p>JSPatchæ˜¯ç”±å›½äººå¼€å‘çš„å¼€æºé¡¹ç›®(<a href="https://github.com/bang590/JSPatch" target="_blank" rel="external">Githubé“¾æ¥</a>)åªéœ€è¦åœ¨é¡¹ç›®é‡Œå¼•å…¥æå°çš„å¼•æ“æ–‡ä»¶ï¼Œå°±å¯ä»¥ä½¿ç”¨ JavaScript è°ƒç”¨ä»»ä½• Objective-C çš„åŸç”Ÿæ¥å£ï¼Œæ›¿æ¢ä»»æ„ Objective-C åŸç”Ÿæ–¹æ³•ã€‚ç›®å‰ä¸»è¦ç”¨äºä¸‹å‘ JS è„šæœ¬æ›¿æ¢åŸç”Ÿ Objective-C ä»£ç ï¼Œå®æ—¶ä¿®å¤çº¿ä¸Š bugã€‚<br>å…³äºJSPatchçš„å®ç°åŸç†å¯ä»¥å‚è€ƒ<a href="http://blog.cnbang.net/archives/" target="_blank" rel="external">ä½œè€…çš„åšå®¢</a>ã€‚</p>
<h3 id="è¯­æ³•">è¯­æ³•</h3><p>JSPatchä½¿ç”¨ç®€å•æ˜äº†ï¼Œä½†éœ€è¦æ³¨æ„çš„æ˜¯JSPatchçš„è¯­æ³•ï¼Œå°†OCè¯­è¨€è½¬ä¸ºJSPatchï¼Œä¾‹å¦‚ï¼š</p>
<ul>
<li>OC</li>
</ul>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="annotation">@implementation</span> SampleClass</span><br><span class="line">- (<span class="typename">void</span>)<span class="string">requestUrl:</span>(NSString *)url <span class="string">param:</span>(NSDictionary *)dict <span class="string">callback:</span>(JPCallback)callback &#123;</span><br><span class="line">    [<span class="keyword">super</span> <span class="string">requestUrl:</span>url <span class="string">param:</span>dict <span class="string">callback:</span>callback];</span><br><span class="line">    JPRequest *obj = [[JPRequest alloc] <span class="string">initWithUrl:</span>url <span class="string">param:</span>dict];</span><br><span class="line">    obj.successBlock = ^(id data, NSError *err) &#123;</span><br><span class="line">        NSString *content = [JPParser <span class="string">parseData:</span>data];</span><br><span class="line">        <span class="keyword">if</span> (callback) callback(@&#123;</span><br><span class="line">            @<span class="string">"content"</span>: content</span><br><span class="line">        &#125;, err);</span><br><span class="line">        [self.dataSource refresh];</span><br><span class="line">        self.handleRequestSuccess(data);</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br><span class="line"><span class="annotation">@end</span></span><br></pre></td></tr></table></figure>
<ul>
<li>JSPatch</li>
</ul>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">require<span class="list">(<span class="quoted">'JPRequest</span>,JPParser')</span><span class="comment">;</span></span><br><span class="line">defineClass<span class="list">(<span class="quoted">'SampleClass</span>', &#123;</span><br><span class="line">    requestUrl_param_callback: function<span class="list">(<span class="keyword">url</span>, dict, callback)</span> &#123;</span><br><span class="line">        self.super<span class="list">()</span>.requestUrl_param_callback<span class="list">(<span class="keyword">url</span>, dict, callback)</span><span class="comment">;</span></span><br><span class="line">        var obj = JPRequest.alloc<span class="list">()</span>.initWithUrl_param<span class="list">(<span class="keyword">url</span>, dict)</span><span class="comment">;</span></span><br><span class="line">        obj.setSuccessBlock<span class="list">(<span class="keyword">block</span><span class="list">(<span class="quoted">'id</span>,NSError*', function<span class="list">(<span class="keyword">data</span>, err)</span> &#123;</span><br><span class="line">            var content = JPParser.parseData<span class="list">(<span class="keyword">data</span>)</span><span class="comment">;</span></span><br><span class="line">            if <span class="list">(<span class="keyword">callback</span>)</span> callback<span class="list">(&#123;</span><br><span class="line">                <span class="string">"content"</span>: content</span><br><span class="line">            &#125;, err)</span><span class="comment">;</span></span><br><span class="line">            self.dataSource<span class="list">()</span>.refresh<span class="list">()</span><span class="comment">;</span></span><br><span class="line">            self.handleRequestSuccess<span class="list">()</span><span class="list">(<span class="keyword">data</span>)</span><span class="comment">;</span></span><br><span class="line">        &#125;)</span>)</span><span class="comment">;</span></span><br><span class="line">    &#125;,</span><br><span class="line">&#125;)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>ä½œè€…æä¾›äº†ä¸€ä¸ª<a href="http://bang590.github.io/JSPatchConvertor/" target="_blank" rel="external">JSPatchConvertor</a>ç®€å•ç²—æš´ï¼Œèƒ½æ»¡è¶³ä¸€äº›ç®€å•çš„è½¬æ¢ï¼Œæ¯”è¾ƒå¤æ‚çš„å°±å¾—äººå·¥ä¿®æ”¹äº†ï¼Œæ›´å¤šè¯­æ³•ä¸Šçš„å¯ä»¥å‚è€ƒ<a href="https://github.com/bang590/JSPatch/wiki/JSPatch-%E5%9F%BA%E7%A1%80%E7%94%A8%E6%B3%95" target="_blank" rel="external">JSPatchWiki</a>ã€‚</p>
<h3 id="å®‰å…¨">å®‰å…¨</h3><p>ä½¿ç”¨ JSPatch æœ‰ä¸¤ä¸ªå®‰å…¨é—®é¢˜ï¼š</p>
<ul>
<li>ä¼ è¾“å®‰å…¨ï¼šJS è„šæœ¬å¯ä»¥è°ƒç”¨ä»»æ„ OC æ–¹æ³•ï¼Œæƒé™éå¸¸å¤§ï¼Œè‹¥è¢«ä¸­é—´äººæ”»å‡»æ›¿æ¢ä»£ç ï¼Œä¼šé€ æˆè¾ƒå¤§çš„å±å®³ã€‚</li>
<li>æ‰§è¡Œå®‰å…¨ï¼šä¸‹å‘çš„ JS è„šæœ¬çµæ´»åº¦å¤§ï¼Œç›¸å½“äºä¸€æ¬¡å°å‹æ›´æ–°ï¼Œè‹¥æœªè¿›è¡Œå……åˆ†æµ‹è¯•ï¼Œå¯èƒ½ä¼šå‡ºç° crash ç­‰æƒ…å†µå¯¹ APP ç¨³å®šæ€§é€ æˆå½±å“ã€‚</li>
</ul>
<p>ä½œè€…æ¨èçš„ä¸€ç§æ–¹æ¡ˆå¦‚å›¾æ‰€ç¤º:<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/JSPatchSecurity.png" alt="JSPatchSecurity"><br>1.æœåŠ¡ç«¯è®¡ç®—å‡ºè„šæœ¬æ–‡ä»¶çš„ MD5 å€¼ï¼Œä½œä¸ºè¿™ä¸ªæ–‡ä»¶çš„æ•°å­—ç­¾åã€‚<br>2.æœåŠ¡ç«¯é€šè¿‡ç§é’¥åŠ å¯†ç¬¬ 1 æ­¥ç®—å‡ºçš„ MD5 å€¼ï¼Œå¾—åˆ°ä¸€ä¸ªåŠ å¯†åçš„ MD5 å€¼ã€‚<br>3.æŠŠè„šæœ¬æ–‡ä»¶å’ŒåŠ å¯†åçš„ MD5 å€¼ä¸€èµ·ä¸‹å‘ç»™å®¢æˆ·ç«¯ã€‚<br>4.å®¢æˆ·ç«¯æ‹¿åˆ°åŠ å¯†åçš„ MD5 å€¼ï¼Œé€šè¿‡ä¿å­˜åœ¨å®¢æˆ·ç«¯çš„å…¬é’¥è§£å¯†ã€‚<br>5.å®¢æˆ·ç«¯è®¡ç®—è„šæœ¬æ–‡ä»¶çš„ MD5 å€¼ã€‚<br>6.å¯¹æ¯”ç¬¬ 4/5 æ­¥çš„ä¸¤ä¸ª MD5 å€¼ï¼ˆåˆ†åˆ«æ˜¯å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯è®¡ç®—å‡ºæ¥çš„ MD5 å€¼ï¼‰ï¼Œè‹¥ç›¸ç­‰åˆ™é€šè¿‡æ ¡éªŒã€‚<br>å¯¹äºJSPatchè‹¥æœ‰æ›´å¤šå®‰å…¨ä¸Šçš„é¡¾è™‘å¯ä»¥å‚è€ƒä½œè€…çš„<a href="http://blog.cnbang.net/internet/2990/" target="_blank" rel="external">å›åº”ä¸€ä¸‹ JSPatch å®‰å…¨é—®é¢˜</a>ã€‚</p>
<h3 id="ä½¿ç”¨">ä½¿ç”¨</h3><p>ç›®å‰æœ‰ä¸¤ç§ä½¿ç”¨æ–¹æ³•ï¼Œä¸€ç§æ˜¯ä½¿ç”¨ä½œè€…æä¾›çš„<a href="http://jspatch.com/" target="_blank" rel="external">JSPatch Platform</a>å¹³å°ï¼Œé›†æˆJSPatchçš„SDKï¼ŒæŒ‰è¯·æ±‚æ¬¡æ•°æ”¶è´¹ï¼Œç›®å‰å…è´¹é¢åº¦ä¸º 100wæ¬¡è¯·æ±‚/æœˆï¼Œè¶…å‡ºçš„éƒ¨åˆ†ä¼šå¦è¡Œæ”¶è´¹ã€‚<br>è¿˜æœ‰ä¸€ç§æ˜¯è‡ªå·±é€ è½®å­ï¼Œæ¯•ç«ŸJSPatchæ˜¯å¼€æºçš„ï¼Œä»å‰ç«¯é€»è¾‘åˆ°åå°å®‰å…¨ç­–ç•¥ï¼Œéƒ½å¯ä»¥æ ¹æ®å…¬å¸çš„ä¸šåŠ¡éœ€æ±‚è‡ªç”±å®šåˆ¶ã€‚</p>
<h3 id="åè®°">åè®°</h3><p>æ€»ä½“æ¥è¯´è¿˜æ˜¯ååˆ†å¥½ç”¨çš„ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯æ¯æ¬¡ç‰ˆæœ¬ç”¨JSPatchè§£å†³çš„çº¿ä¸ŠBugåï¼Œä¸‹ä¸ªç‰ˆæœ¬å¿…é¡»å¾—å°†ä»£ç å†™å…¥é¡¹ç›®ä¸­ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="å‰è¨€">å‰è¨€</h3><p>é™äºAppStoreçš„å®¡æ ¸æœºåˆ¶ï¼Œè‹¹æœåº”ç”¨å®¡æ ¸é€šå¸¸éœ€è¦ä¸€æ®µæ—¶é—´ã€‚è¿™å¯¹æŸäº›åº”ç”¨å¼€å‘è¿­ä»£æ¯”è¾ƒå¿«çš„å…¬å¸æ¥è¯´ï¼Œå¾€å¾€ä¸Šä¸€ç‰ˆæœ¬è¿˜åœ¨AppStoreå®¡æ ¸ï¼Œæ–°ä¸€ç‰ˆæœ¬å·²ç»å¼€å‘å®Œæ¯•äº†ï¼Œç›¸å¯¹äºAndroidçš„å½“å¤©å‘å¸ƒæ¥è¯´ï¼Œå·²ç»ç®—æ˜¯ä¸èƒ½å†æ…¢äº†ã€‚è¦æ˜¯æ­£å¥½é‡ä¸Šçº¿ä¸Šæœ‰bugï¼Œé‚£ä¹ˆåˆå¾—é‡æ–°å›åˆ°AppStoreæäº¤-å®¡æ ¸-å‘å¸ƒçš„æµç¨‹ä¸­å»ï¼Œä½†è‹¥æ˜¯ååˆ†ç´§è¦çš„bugï¼Œä¸ä¿®å¤ä¼šå½±å“åº”ç”¨çš„æ­£å¸¸ä½¿ç”¨ï¼Œé‚£ä¹ˆå†èµ°è¿™ä¸ªæµç¨‹å°±æ˜¾å¾—éå¸¸æ…¢äº†ã€‚ä»¥å‰é¢å¯¹è¿™ç§é—®é¢˜å¾€å¾€æ˜¯èµ°åŠ æ€¥å®¡æ ¸ï¼Œä½†åŠ æ€¥å®¡æ ¸ä¹Ÿä¼šæœ‰3å¤©æ—¶é—´ï¼Œé‚£èƒ½ä¸èƒ½ä¸å‘å¸ƒç‰ˆæœ¬åœ¨çº¿ä¸Šä¿®å¤bugå‘¢ï¼Ÿç­”æ¡ˆæ˜¯æœ‰çš„ï¼Œè¿™é‡Œé€‰æ‹©çš„æ–¹æ¡ˆæ˜¯JSPatchã€‚</p>]]>
    
    </summary>
    
      <category term="hotfix" scheme="http://v2panda.com/tags/hotfix/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[iOSæ­å»ºCIæŒç»­é›†æˆç¯å¢ƒ]]></title>
    <link href="http://v2panda.com/2016/02/29/buildci/"/>
    <id>http://v2panda.com/2016/02/29/buildci/</id>
    <published>2016-02-29T15:49:05.000Z</published>
    <updated>2016-02-29T16:51:22.000Z</updated>
    <content type="html"><![CDATA[<h3 id="å‰è¨€_Continuous_integration">å‰è¨€ Continuous integration</h3><p>CI æ˜¯æ•æ·å¼€å‘çš„å¿…å¤‡ï¼Œç®€å•è¯´å°±æ˜¯æœ‰è¿™æ ·ä¸€å¥—å·¥å…·ï¼Œä½¿å¾—å¼€å‘äººå‘˜åšå¥½å¼€å‘å’Œå•å…ƒæµ‹è¯•å† push ä»£ç åå°±ä¸ç”¨ç®¡äº†ï¼Œè¿™å¥—å·¥å…·èƒ½è‡ªåŠ¨åœ° check ä»£ç çš„å˜åŒ–ï¼Œè‡ªåŠ¨ buildï¼Œ è‡ªåŠ¨åšé›†æˆæµ‹è¯•å’Œåœºæ™¯æµ‹è¯•ç­‰ï¼Œè‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p>
<p>æœ¬æ–‡ä¸ºiOSä¸‹çš„è‡ªåŠ¨åŒ–æ‰“åŒ…ï¼Œæ­å»ºå¯æŒç»­é›†æˆç¯å¢ƒï¼Œçœå»ç»™æµ‹è¯•å®‰è£…æ–°ç‰ˆæœ¬çš„æ—¶é—´ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚è¿™é‡Œé€‰æ‹©çš„æ–¹æ¡ˆæ˜¯Jenkins+ Gitlab/Github+Xcode+Firã€‚</p>
<a id="more"></a>
<h3 id="å®‰è£…Jenkins">å®‰è£…Jenkins</h3><p>å…ˆå®‰è£…homebrewï¼Œå®‰è£…è¿‡çš„è·³è¿‡è¿™æ­¥</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ ruby <span class="operator">-e</span> <span class="string">"<span class="variable">$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)</span>"</span></span><br></pre></td></tr></table></figure>
<p>ç„¶å</p>
<figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ <span class="keyword">brew </span>install jenkins</span><br></pre></td></tr></table></figure>
<p>è‹¥é‡åˆ°</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">jenkins: Java 1.6+ is required to <span class="operator"><span class="keyword">install</span> this formula.</span><br><span class="line">You can <span class="keyword">install</span> <span class="keyword">with</span> Homebrew Cask:</span><br><span class="line">  brew <span class="keyword">install</span> Caskroom/cask/<span class="keyword">java</span></span><br><span class="line"></span><br><span class="line">You can download <span class="keyword">from</span>:</span><br><span class="line">  <span class="keyword">http</span>://www.<span class="keyword">oracle</span>.com/technetwork/<span class="keyword">java</span>/javase/downloads/<span class="keyword">index</span>.html</span><br><span class="line"><span class="keyword">Error</span>: An unsatisfied requirement <span class="keyword">failed</span> this <span class="keyword">build</span>.</span></span><br></pre></td></tr></table></figure>
<p>æŒ‰ç…§æç¤ºå®‰è£…javaç¯å¢ƒï¼Œæ¨èå»<a href="http://www.oracle.com/technetwork/java/javase/downloads/index.html" target="_blank" rel="external">javaå®˜ç½‘</a>ä¸‹è½½ã€‚</p>
<p>å®‰è£…å®Œæˆåæµè§ˆå™¨ä¼šè‡ªåŠ¨æ‰“å¼€Jenkinsé¡µé¢(<a href="http://localhost:8080" target="_blank" rel="external">http://localhost:8080</a>)<br>æˆ–è¾“å…¥</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$ </span>open /<span class="constant">Applications</span>/<span class="constant">Jenkins</span>/jenkins.war</span><br></pre></td></tr></table></figure>
<p>è‹¥ç«¯å£æœ‰å†²çªï¼Œåˆ™ä¿®æ”¹ç«¯å£</p>
<figure class="highlight delphi"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ defaults <span class="keyword">write</span> /<span class="keyword">Library</span>/Preferences/org.jenkins-ci httpPort yourport</span><br></pre></td></tr></table></figure>
<p>å†å®‰è£…æ’ä»¶ï¼Œåœ¨åˆ°jenkinsé¡µé¢ï¼Œæ’ä»¶ç®¡ç†ä¸­å®‰è£…ä»¥ä¸‹æ’ä»¶</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">GIT <span class="keyword">plugin</span></span><br><span class="line">GitHub <span class="keyword">plugin</span></span><br><span class="line">Gitlab <span class="keyword">plugin</span></span><br><span class="line"><span class="keyword">Post</span>-Build Script Plug-<span class="keyword">in</span></span><br><span class="line">Xcode integration</span><br></pre></td></tr></table></figure>
<p>å®‰è£…fir-cli,è¯¦ç»†çš„å‚è€ƒ<a href="https://github.com/FIRHQ/fir-cli/blob/master/README.md" target="_blank" rel="external">æ–‡æ¡£</a></p>
<figure class="highlight avrasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ sudo gem install fir-<span class="keyword">cli</span></span><br></pre></td></tr></table></figure>
<h3 id="æ–°å»ºé¡¹ç›®">æ–°å»ºé¡¹ç›®</h3><p>æ–°å»ºä¸€ä¸ªé¡¹ç›®ï¼Œé€‰æ‹©è‡ªç”±é£æ ¼çš„è½¯ä»¶é¡¹ç›®ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blognewItem.png" alt="newItem"><br>ç»§ç»­å¡«å†™åŸºæœ¬ä¿¡æ¯ä¸æºç ç®¡ç†,è‹¥é€‰ç”¨Gitåˆ™éœ€æ³¨æ„å¡«å†™Repositoriesåœ°å€ä¸    Branches to build<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blogbasicInfo.png" alt="basicInfo"></p>
<h3 id="æ„å»ºé…ç½®">æ„å»ºé…ç½®</h3><p>æ·»åŠ æ„å»ºè§¦å‘å™¨,è¿™é‡Œå°±æ˜¯å‘Šè¯‰Jenkinsä»€ä¹ˆæ—¶å€™è‡ªåŠ¨æ„å»ºã€‚<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blogbuildWhen.png" alt="buildWhen"><br>è¿™é‡Œé€‰æ‹©çš„æ˜¯æœ‰pushåˆ°githubæ—¶æ„å»ºï¼Œä¹Ÿå¯ä»¥é€‰Poll SCMè®¾ç½®æ„å»ºæ—¶é—´<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blogbuildPoll.png" alt="buildPoll"><br>è¿™é‡Œçš„é…ç½®ä¸ºå‘¨ä¸€åˆ°å‘¨äº”æ¯å¤©8ç‚¹åˆ°9ç‚¹ä¹‹é—´æ‰§è¡Œä¸€æ¬¡ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blogexecuteShell.png" alt="executeShell"><br>é€‰æ‹©æ„å»ºé…ç½®ä¸ºExecute Shellï¼Œå¡«å…¥</p>
<figure class="highlight nginx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">fir</span> build_ipa <span class="variable">$&#123;WORKSPACE1&#125;</span> -o <span class="variable">$&#123;WORKSPACE2&#125;</span>/TestJenkins.ipa -p -T <span class="comment">#API Token#</span></span><br></pre></td></tr></table></figure>
<ul>
<li>WORKSPACE1â€”â€”â€“ä¸ºé¡¹ç›®è·¯å¾„</li>
<li>WORKSPACE2â€”â€”â€“ipaè¾“å‡ºè·¯å¾„</li>
<li>#API Token#â€”â€”â€”â€”fir API Token</li>
</ul>
<p>ç„¶åä¿å­˜é€€å‡ºã€‚</p>
<h3 id="æ„å»º">æ„å»º</h3><p>å»ºè®®é€æ­¥æ„å»ºï¼Œé¿å…é”™è¯¯ï¼Œæ„å»ºå†å²å¦‚ä¸‹<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blogbuildHistory.png" alt=""></p>
<p>è“è‰²çš„ä¸ºæ„å»ºæˆåŠŸï¼Œçº¢è‰²ä¸ºå¤±è´¥ï¼Œè‹¥é‡åˆ°ä»¥ä¸‹ç±»ä¼¼çš„é”™è¯¯</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">PluginLoading</span>: <span class="string">Required plug-in compatibility UUID F41BD31E-2683-44B8-</span></span><br><span class="line"></span><br><span class="line"><span class="dos">AE7F-<span class="number">5</span>F09E919790E <span class="flow">for</span> plug-<span class="flow">in</span> <span class="built_in">at</span> <span class="built_in">path</span> '~/Library/Application Support/</span><br><span class="line"></span><br><span class="line">Developer/Shared/Xcode/Plug-ins/KSImageNamed.xcplugin' <span class="flow">not</span> present <span class="flow">in</span> </span><br><span class="line"></span><br><span class="line">DVTPlugInCompatibilityUUIDs</span></span><br></pre></td></tr></table></figure>
<p>å¯ä»¥å‚è€ƒ<a href="http://stackoverflow.com/questions/20732327/xcode-5-required-plug-in-not-present-in-dvtplugincompatibilityuuids" target="_blank" rel="external">stackoverflow</a>ã€‚</p>
<h3 id="å‘å¸ƒ">å‘å¸ƒ</h3><p>æ„å»ºæˆåŠŸåå°±å¯ä»¥åœ¨firä¸Šçœ‹åˆ°åº”ç”¨äº†ï¼Œæ‰«ç æˆ–æ‰“å¼€çŸ­é“¾æ¥ä¸‹è½½åº”ç”¨ã€‚<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blogfirim.png" alt="firim"></p>
<p>æ³¨æ„è¿™é‡Œåªèƒ½å®‰è£…å¼€å‘è€…è´¦å·è®¾å¤‡åˆ—è¡¨é‡Œçš„è®¾å¤‡ï¼Œä¸ªäººå¼€å‘è€…è´¦å·å’Œä¼ä¸šè´¦å·æœ‰æ‰€åŒºåˆ«</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blogdeviceslist.png" alt="deviceslist"></p>
<p>è¯¦æƒ…å¯ä»¥æŸ¥çœ‹<a href="http://fir.im/support/articles/faq/ios_certificate" target="_blank" rel="external">fir support</a>ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="å‰è¨€_Continuous_integration">å‰è¨€ Continuous integration</h3><p>CI æ˜¯æ•æ·å¼€å‘çš„å¿…å¤‡ï¼Œç®€å•è¯´å°±æ˜¯æœ‰è¿™æ ·ä¸€å¥—å·¥å…·ï¼Œä½¿å¾—å¼€å‘äººå‘˜åšå¥½å¼€å‘å’Œå•å…ƒæµ‹è¯•å† push ä»£ç åå°±ä¸ç”¨ç®¡äº†ï¼Œè¿™å¥—å·¥å…·èƒ½è‡ªåŠ¨åœ° check ä»£ç çš„å˜åŒ–ï¼Œè‡ªåŠ¨ buildï¼Œ è‡ªåŠ¨åšé›†æˆæµ‹è¯•å’Œåœºæ™¯æµ‹è¯•ç­‰ï¼Œè‡ªåŠ¨éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒã€‚</p>
<p>æœ¬æ–‡ä¸ºiOSä¸‹çš„è‡ªåŠ¨åŒ–æ‰“åŒ…ï¼Œæ­å»ºå¯æŒç»­é›†æˆç¯å¢ƒï¼Œçœå»ç»™æµ‹è¯•å®‰è£…æ–°ç‰ˆæœ¬çš„æ—¶é—´ï¼Œæé«˜å·¥ä½œæ•ˆç‡ã€‚è¿™é‡Œé€‰æ‹©çš„æ–¹æ¡ˆæ˜¯Jenkins+ Gitlab/Github+Xcode+Firã€‚</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[PDPullToRefresh]]></title>
    <link href="http://v2panda.com/2016/01/17/PDPullToRefresh/"/>
    <id>http://v2panda.com/2016/01/17/PDPullToRefresh/</id>
    <published>2016-01-17T09:03:45.000Z</published>
    <updated>2016-01-18T12:34:13.000Z</updated>
    <content type="html"><![CDATA[<p>å‘¨æœ«ä»¿å†™äº†åŠç³–çš„ä¸‹æ‹‰åˆ·æ–°ï¼Œå­¦äº†ä¸¤å¥æ³•è¯­</p>
<ul>
<li>Câ€™est La Vie    </li>
<li>La Vie est belle</li>
</ul>
<p>Câ€™est La Vie é€šå¸¸æ˜¯ç”¨åœ¨è¾ƒä¸ºæ¶ˆæçš„äº‹æƒ…å‘ç”Ÿæ—¶ï¼Œç”¨äºè‡ªæˆ‘å®‰æ…°æˆ–è‡ªæˆ‘è§£å˜²ï¼Œé¼“åŠ±è‡ªå·±æˆ–ä»–äººå³ä½¿é‡åˆ°äº†å†å¤§çš„éš¾å¤„ï¼Œä¹Ÿè¦å¦ç„¶ç¬‘å¯¹ç”Ÿæ´»ã€‚é¸¡æ±¤ä¸€ä¸‹ï¼Œå¼€å§‹æ­£æ–‡ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/2015-cheers.jpg" alt=""></p>
<a id="more"></a>
<h1 id="ç¤ºä¾‹">ç¤ºä¾‹</h1><ul>
<li>åŠç³–</li>
</ul>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/PDPullToRefresh-bantang.gif" alt="åŠç³–"></p>
<ul>
<li>PDPullToRefresh</li>
</ul>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/PDPullToRefresh.gif" alt="PDPullToRefresh"></p>
<h1 id="æ€è·¯">æ€è·¯</h1><p>PDPullToRefreshæ˜¯ç»™UIScrollViewåŠ çš„åˆ†ç±»ï¼ŒåŒ…æ‹¬PDHeaderRefreshViewå’ŒPDFooterRefreshView ,æ•´ä¸ªåˆ·æ–°è¿‡ç¨‹å¯åˆ†ä¸ºä¸¤éƒ¨åˆ†</p>
<ul>
<li>ä¸‹æ‹‰æ—¶ - Câ€™est La Vie åŠ¨ç”»</li>
<li>åˆ·æ–°æ—¶ - La Vie est belle åŠ¨ç”»</li>
</ul>
<h3 id="Câ€™est_La_Vie_åŠ¨ç”»">Câ€™est La Vie åŠ¨ç”»</h3><p>é¦–å…ˆå¾—æ‹¿åˆ°Câ€™est La Vieçš„å­—å½¢ï¼Œè¿™é‡Œç”¨åˆ°äº†CoreTextï¼Œæ‹¿åˆ°å­—å½¢åæ·»åŠ åˆ°layer.pathä¸Šæ˜¾ç¤º</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGMutablePathRef</span> letters = <span class="built_in">CGPathCreateMutable</span>();</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  CTFontRef font = CTFontCreateWithName(<span class="built_in">CFSTR</span>(<span class="string">"HelveticaNeue-UltraLight"</span>), pFontSize, <span class="literal">NULL</span>);</span><br><span class="line">Â  Â  <span class="built_in">NSDictionary</span> *attrs = [<span class="built_in">NSDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  (__bridge <span class="keyword">id</span>)font, kCTFontAttributeName,</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  <span class="literal">nil</span>];</span><br><span class="line">Â  Â  <span class="built_in">NSAttributedString</span> *attrString = [[<span class="built_in">NSAttributedString</span> alloc] initWithString:animationString</span><br><span class="line">Â Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  Â  attributes:attrs];</span><br><span class="line">Â  Â  CTLineRef line = CTLineCreateWithAttributedString((<span class="built_in">CFAttributedStringRef</span>)attrString);</span><br><span class="line">Â  Â  <span class="built_in">CFArrayRef</span> runArray = CTLineGetGlyphRuns(line);</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="comment">// for each RUN</span></span><br><span class="line">Â  Â  <span class="keyword">for</span> (<span class="built_in">CFIndex</span> runIndex = <span class="number">0</span>; runIndex &lt; <span class="built_in">CFArrayGetCount</span>(runArray); runIndex++)</span><br><span class="line">Â  Â  &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// Get FONT for this run</span></span><br><span class="line">Â  Â  Â  Â  CTRunRef run = (CTRunRef)<span class="built_in">CFArrayGetValueAtIndex</span>(runArray, runIndex);</span><br><span class="line">Â  Â  Â  Â  CTFontRef runFont = <span class="built_in">CFDictionaryGetValue</span>(CTRunGetAttributes(run), kCTFontAttributeName);</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// for each GLYPH in run</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">for</span> (<span class="built_in">CFIndex</span> runGlyphIndex = <span class="number">0</span>; runGlyphIndex &lt; CTRunGetGlyphCount(run); runGlyphIndex++)</span><br><span class="line">Â  Â  Â  Â  &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// get Glyph &amp; Glyph-data</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">CFRange</span> thisGlyphRange = <span class="built_in">CFRangeMake</span>(runGlyphIndex, <span class="number">1</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">CGGlyph</span> glyph;</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="built_in">CGPoint</span> position;</span><br><span class="line">Â  Â  Â  Â  Â  Â  CTRunGetGlyphs(run, thisGlyphRange, &amp;glyph);</span><br><span class="line">Â  Â  Â  Â  Â  Â  CTRunGetPositions(run, thisGlyphRange, &amp;position);</span><br><span class="line">Â  Â  Â  Â  Â  Â  <span class="comment">// Get PATH of outline</span></span><br><span class="line">Â  Â  Â  Â  Â  Â  &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGPathRef</span> letter = CTFontCreatePathForGlyph(runFont, glyph, <span class="literal">NULL</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGAffineTransform</span> t = <span class="built_in">CGAffineTransformMakeTranslation</span>(position<span class="variable">.x</span>, position<span class="variable">.y</span>);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGPathAddPath</span>(letters, &amp;t, letter);</span><br><span class="line">Â  Â  Â  Â  Â  Â  Â  Â  <span class="built_in">CGPathRelease</span>(letter);</span><br><span class="line">Â  Â  Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="built_in">CFRelease</span>(line);</span><br><span class="line">Â  Â  <span class="built_in">UIBezierPath</span> *path = [<span class="built_in">UIBezierPath</span> bezierPath];</span><br><span class="line">Â  Â  [path moveToPoint:<span class="built_in">CGPointZero</span>];</span><br><span class="line">Â  Â  [path appendPath:[<span class="built_in">UIBezierPath</span> bezierPathWith<span class="built_in">CGPath</span>:letters]];</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="built_in">CGPathRelease</span>(letters);</span><br><span class="line">Â  Â  <span class="built_in">CFRelease</span>(font);</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="built_in">CAShapeLayer</span> *pathLayer = [<span class="built_in">CAShapeLayer</span> layer];</span><br><span class="line">Â  Â  pathLayer<span class="variable">.frame</span> = <span class="keyword">self</span><span class="variable">.animationLayer</span><span class="variable">.bounds</span>;</span><br><span class="line">Â  Â  pathLayer<span class="variable">.bounds</span> = <span class="built_in">CGPathGetBoundingBox</span>(path<span class="variable">.CGPath</span>);</span><br><span class="line">Â  Â  pathLayer<span class="variable">.geometryFlipped</span> = <span class="literal">YES</span>;</span><br><span class="line">Â  Â  pathLayer<span class="variable">.path</span> = path<span class="variable">.CGPath</span>;</span><br><span class="line">Â  Â  pathLayer<span class="variable">.strokeColor</span> = [<span class="built_in">UIColor</span> colorWithRed:<span class="number">234.0</span>/<span class="number">255</span> green:<span class="number">84.0</span>/<span class="number">255</span> blue:<span class="number">87.0</span>/<span class="number">255</span> alpha:<span class="number">1</span>]<span class="variable">.CGColor</span>;</span><br><span class="line">Â  Â  pathLayer<span class="variable">.fillColor</span> = <span class="literal">nil</span>;</span><br><span class="line">Â  Â  pathLayer<span class="variable">.lineWidth</span> = <span class="number">1.0</span>f;</span><br><span class="line">Â  Â  pathLayer<span class="variable">.lineJoin</span> = k<span class="built_in">CALineJoinBevel</span>;</span><br></pre></td></tr></table></figure>
<p>ç„¶åç”¨KVOç›‘å¬ScrollViewçš„contentOffsetå±æ€§ï¼Œä¸pathLayerçš„strokeEndå…³è”èµ·æ¥ï¼ŒCâ€™est La Vieå°±å¯ä»¥éšç€ä¸‹æ‹‰åšåŠ¨ç”»å•¦ã€‚</p>
<h3 id="La_Vie_est_belle_åŠ¨ç”»">La Vie est belle åŠ¨ç”»</h3><p>La Vie est belleä¸Câ€™est La Vieçš„åŠ¨ç”»ä¸åŒï¼Œå®ƒæ˜¯ä¸€ç›´é—ªåŠ¨ç€çš„ï¼Œè¿˜æ˜¯å…ˆæ‹¿åˆ°La Vie est belleçš„å­—å½¢ï¼Œè¿™é‡Œç”¨CAGradientLayerå¯ä»¥æ–¹ä¾¿çš„å¤„ç†é¢œè‰²æ¸å˜ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CAGradientLayer</span> *gradientLayer = (<span class="built_in">CAGradientLayer</span> *)<span class="keyword">self</span><span class="variable">.gradientLayer</span>;</span><br><span class="line">Â  Â  <span class="keyword">if</span>([gradientLayer animationForKey:kAnimationKey] == <span class="literal">nil</span>)</span><br><span class="line">Â  Â  &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">// é€šè¿‡ä¸æ–­æ”¹å˜æ¸å˜çš„èµ·æ­¢èŒƒå›´ï¼Œæ¥å®ç°å…‰æ™•æ•ˆæœ</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">CABasicAnimation</span> *startPointAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:gradientStartPointKey];</span><br><span class="line">Â  Â  Â  Â  startPointAnimation<span class="variable">.toValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">1.0</span>, <span class="number">0</span>)];</span><br><span class="line">Â  Â  Â  Â  startPointAnimation<span class="variable">.timingFunction</span> = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:_animationPacing];</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="built_in">CABasicAnimation</span> *endPointAnimation = [<span class="built_in">CABasicAnimation</span> animationWithKeyPath:gradientEndPointKey];</span><br><span class="line">Â  Â  Â  Â  endPointAnimation<span class="variable">.toValue</span> = [<span class="built_in">NSValue</span> valueWith<span class="built_in">CGPoint</span>:<span class="built_in">CGPointMake</span>(<span class="number">1</span> + pHaloWidth, <span class="number">0</span>)];</span><br><span class="line">Â  Â  Â  Â  endPointAnimation<span class="variable">.timingFunction</span> = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:_animationPacing];</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="built_in">CAAnimationGroup</span> *group = [<span class="built_in">CAAnimationGroup</span> animation];</span><br><span class="line">Â  Â  Â  Â  group<span class="variable">.animations</span> = @[startPointAnimation, endPointAnimation];</span><br><span class="line">Â  Â  Â  Â  group<span class="variable">.duration</span> = pHaloDuration;</span><br><span class="line">Â  Â  Â  Â  group<span class="variable">.timingFunction</span> = [<span class="built_in">CAMediaTimingFunction</span> functionWithName:_animationPacing];</span><br><span class="line">Â  Â  Â  Â  group<span class="variable">.repeatCount</span> = HUGE_VALF;</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  [gradientLayer addAnimation:group forKey:kAnimationKey];</span><br><span class="line">Â  Â  &#125;</span><br></pre></td></tr></table></figure>
<h1 id="ä½¿ç”¨">ä½¿ç”¨</h1><h3 id="å®‰è£…">å®‰è£…</h3><ul>
<li>æ·»åŠ  <code>pod &#39;PDPullToRefresh&#39;</code> åˆ°ä½ çš„ Podfile ï¼Œç„¶å<code>pod install</code>ã€‚</li>
<li>æ‰‹åŠ¨æ·»åŠ åˆ°ä½ çš„Xcodeé¡¹ç›®ä¸­ï¼Œ<code>#import &quot;PDPullToRefresh.h&quot;</code>ã€‚</li>
</ul>
<h3 id="æ·»åŠ ä¸‹æ‹‰åˆ·æ–°">æ·»åŠ ä¸‹æ‹‰åˆ·æ–°</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[tableView <span class="string">pd_addHeaderRefreshWithNavigationBar:</span>YES <span class="string">andActionHandler:</span>^&#123;</span><br><span class="line">    <span class="comment">// prepend data to dataSource, insert cells at top of table view</span></span><br><span class="line">    <span class="comment">// call [tableView.pdHeaderRefreshView stopRefreshing] when done</span></span><br><span class="line"> &#125;];</span><br></pre></td></tr></table></figure>
<h3 id="æ·»åŠ ä¸Šæ‹‰åˆ·æ–°">æ·»åŠ ä¸Šæ‹‰åˆ·æ–°</h3><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[tableView <span class="string">pd_addFooterRefreshWithNavigationBar:</span>YES <span class="string">andActionHandler:</span>^&#123;</span><br><span class="line">    <span class="comment">// prepend data to dataSource, insert cells at top of table view</span></span><br><span class="line">    <span class="comment">// call [tableView.pdFooterRefreshView stopRefreshing] when done</span></span><br><span class="line"> &#125;];</span><br></pre></td></tr></table></figure>
<h3 id="ç«‹å³åˆ·æ–°">ç«‹å³åˆ·æ–°</h3><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[tableView.pdHeaderRefreshView startRefreshing]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<h3 id="è‡ªå®šä¹‰">è‡ªå®šä¹‰</h3><p>ç›®å‰ä»…æ”¯æŒä¸‹æ‹‰è·ç¦»è‡ªå®šä¹‰ï¼Œé»˜è®¤é«˜åº¦ä¸º80</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> pdHeaderRefreshViewHeight;</span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> pdFooterRefreshViewHeight;</span><br></pre></td></tr></table></figure>
<h1 id="æœ€å">æœ€å</h1><p>é™„ä¸Š<a href="https://github.com/v2panda/PDPullToRefresh" target="_blank" rel="external">Githubåœ°å€</a>ï¼Œå¤–åŠ æ„Ÿè°¢<a href="https://itunes.apple.com/cn/app/ban-tang/id955357564?mt=8" target="_blank" rel="external">åŠç³–</a>ã€<a href="https://github.com/samvermette/SVPullToRefresh" target="_blank" rel="external">SVPullToRefresh</a>å¯¹æˆ‘çš„å¯å‘ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>å‘¨æœ«ä»¿å†™äº†åŠç³–çš„ä¸‹æ‹‰åˆ·æ–°ï¼Œå­¦äº†ä¸¤å¥æ³•è¯­</p>
<ul>
<li>Câ€™est La Vie    </li>
<li>La Vie est belle</li>
</ul>
<p>Câ€™est La Vie é€šå¸¸æ˜¯ç”¨åœ¨è¾ƒä¸ºæ¶ˆæçš„äº‹æƒ…å‘ç”Ÿæ—¶ï¼Œç”¨äºè‡ªæˆ‘å®‰æ…°æˆ–è‡ªæˆ‘è§£å˜²ï¼Œé¼“åŠ±è‡ªå·±æˆ–ä»–äººå³ä½¿é‡åˆ°äº†å†å¤§çš„éš¾å¤„ï¼Œä¹Ÿè¦å¦ç„¶ç¬‘å¯¹ç”Ÿæ´»ã€‚é¸¡æ±¤ä¸€ä¸‹ï¼Œå¼€å§‹æ­£æ–‡ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/2015-cheers.jpg" alt=""></p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[2015 - å¼€ç«¯]]></title>
    <link href="http://v2panda.com/2015/12/26/2015-summary/"/>
    <id>http://v2panda.com/2015/12/26/2015-summary/</id>
    <published>2015-12-26T07:25:29.000Z</published>
    <updated>2015-12-29T13:36:51.000Z</updated>
    <content type="html"><![CDATA[<p>è¿™ä¸€å¹´æ¯•ä¸šäº†ï¼Œå‘Šåˆ«äº†å¯èƒ½æ˜¯äººç”Ÿæœ€è‡ªç”±çš„æ—¶å…‰ã€‚è¿™ä¸€å¹´å·¥ä½œäº†ï¼Œç”±å­¦ç”Ÿæˆä¸ºäº†èŒä¸šå·¥ä½œè€…ã€‚ç°åœ¨æ˜¯26å·ï¼Œç¦»æœ¬å‘½å¹´å°±å‰©å‡ å¤©äº†ï¼Œæœ‰äº›å¿å¿‘ï¼Œæœ‰äº›æ„Ÿæ‚Ÿï¼Œæœ‰äº›åæ§½ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹æˆ‘çš„2015ã€‚æ„è¯†æµâ€”â€”æƒ³åˆ°å“ªé‡Œâ€”â€”è¯´åˆ°å“ªé‡Œã€‚</p>
<a id="more"></a>
<h3 id="å·¥ä½œ">å·¥ä½œ</h3><p>2015æ˜¯æˆ‘æ­£å¼å·¥ä½œçš„ç¬¬ä¸€å¹´ï¼Œæ­£å¼å·¥ä½œè·Ÿä¹‹å‰å¤§åŠå¹´çš„å®ä¹ ç”Ÿæ´»å®Œå…¨ä¸åŒã€‚å®ä¹ æ—¶å†™çš„ä¸œè¥¿è§„æ¨¡éƒ½å¾ˆå°ï¼ŒæŠ€æœ¯å«é‡ä¹Ÿä¸é«˜ï¼ŒåŸºæœ¬ä¸Šéƒ½æ˜¯åœ¨è‡ªå­¦çé¼“æ£ã€‚æ­£å¼å·¥ä½œåçœŸæ­£é¢†ç•¥åˆ°äº†ä¼ä¸šé¡¹ç›®å¼€å‘çš„è‰°è¾›ï¼Œå›¢é˜Ÿåä½œçš„é­…åŠ›ï¼Œä»¥åŠä¸€ä¸ªå¥½å›¢é˜Ÿçš„é‡è¦æ€§ã€‚è¿™ç§ç›Šå¤„ä¸ä»…ä»…ä½“ç°åœ¨å·¥ä½œä¸Šï¼Œè¿˜èƒ½åœ¨ç”Ÿæ´»ä¸Šè®©ä½ æœ‰ä¸ªå¥½å¿ƒæƒ…ã€‚</p>
<p>åº†å¹¸çš„æ˜¯æˆ‘æ­£èº«å¤„ä¸è¿™æ ·çš„å›¢é˜Ÿä¸­ï¼Œå›¢é˜Ÿé‡Œè½»æ¾èæ´½çš„æ°›å›´æ˜¯æˆ‘æ¯å¤©å·¥ä½œçš„åŠ¨åŠ›ï¼Œç®€å•çš„è¯´å°±æ˜¯ä¸€å£æ°”æ”¹10ä¸ªbugï¼Œéƒ½ä¸è´¹åŠ²å„¿ã€‚è¿™åœ¨æˆ‘å®ä¹ çš„å…¬å¸æ˜¯å®Œå…¨ä¸èƒ½æƒ³è±¡çš„ï¼Œé‚£é‡Œä»¿ä½›äººä¸äººä¹‹é—´éƒ½æœ‰é“å¢™ï¼Œæ²¡æœ‰ä»»ä½•å·¥ä½œä¹‹å¤–çš„äº‹æƒ…äº¤æµã€‚æ‰€ä»¥åœ¨æ¯•ä¸šæ—¶æ²¡æœ‰æ¥å—å‰è€å¤§çš„æŒ½ç•™ç•™åœ¨é‚£ï¼Œå½“ç„¶è¿˜æ˜¯å¾—æ„Ÿè°¢å®ä¹ çš„å…¬å¸ï¼Œåœ¨é‚£é‡Œæˆ‘å­¦åˆ°äº†å¾ˆå¤šåœ¨å­¦æ ¡å­¦ä¸åˆ°çš„ä¸œè¥¿ï¼Œä¹Ÿæ˜¯åœ¨é‚£é‡Œå­¦ä¼šäº†ç¢°åˆ°é—®é¢˜ï¼Œä½ åº”è¯¥å»è§£å†³å®ƒï¼Œè€Œä¸æ˜¯é€‰æ‹©é€ƒé¿ã€‚ç„¶è€Œé‚£æ®µæ—¶é—´çš„ç»å†æä¸ºå®è´µï¼Œæ„Ÿè°¢ä»–ä»¬å¯¹æˆ‘çš„æ— ç§å¸®åŠ©ä¸è€å¿ƒã€‚</p>
<h3 id="å­¦ä¹ ">å­¦ä¹ </h3><p>talk is cheap,show me the code.è¿™è¯æ˜¯Linus Torvaldsè¯´çš„ã€‚æˆ‘çš„ç†è§£æ˜¯å¤šåšäº‹å°‘BBï¼Œç®€å•çš„æ˜¯å…ˆåšå†è¯´ã€‚<br>å­¦ä¹ åœ¨æˆ‘å®ä¹ ä¹‹åå°±æˆäº†æˆ‘ç”Ÿå‘½ä¸­çš„ä¸»çº¿ï¼Œå¾ˆæƒ­æ„§åœ¨å­¦æ ¡ä¸­æ²¡æŠ•å…¥100%ç²¾åŠ›åœ¨å­¦ä¹ ä¸Šã€‚ç„¶è€Œå·¥ä½œåå¯¹å­¦ä¹ çš„æ¸´æ±‚æ¯”åœ¨å­¦æ ¡æ›´åŠ å¼ºçƒˆï¼Œæœ‰å¤ªå¤šä¸œè¥¿ä¸çŸ¥é“ï¼Œå¤ªå¤šä¸œè¥¿ä¸ç†Ÿæ‚‰ï¼Œå¤ªå¤šä¸œè¥¿ä¸ä¼šã€‚æœ€å¯æ€•çš„æ˜¯æ¨¡æ£±ä¸¤å¯çš„è®¤çŸ¥ï¼Œåˆšå·¥ä½œæ—¶è¯´çš„æœ€å¤šçš„å°±æ˜¯æˆ‘æƒ³æ˜¯è¿™æ ·ï¼Œæˆ‘è§‰å¾—æ˜¯è¿™æ ·ã€‚åˆ«äººé—®èƒ½ç¡®å®šå—ï¼Ÿæˆ‘å¹¶ä¸èƒ½ï¼Œç„¶åå°±ä¼šç¾æ„§çš„å›å»çœ‹ä»£ç ã€çœ‹æ–‡æ¡£ã€æŸ¥èµ„æ–™ã€è¯·æ•™åŒäº‹ç›´åˆ°å½»åº•ææ¸…æ¥šä¸ºæ­¢ã€‚</p>
<p>ä¹Ÿä¼šå¸¸å¸¸ä¼šæ„Ÿåˆ°æ¯å¤©çš„æå‡å¤ªæ…¢ï¼Œæƒ³å­¦çš„ä¸œè¥¿å¥½å¤ªå¤šï¼ŒAndroidå¾ˆæœ‰æ„æ€ï¼Œå‰ç«¯ä¹Ÿæœ‰è¶£ï¼ŒPHPä¸–ç•Œä¸Šæœ€å¥½çš„è¯­è¨€æˆ‘ç«Ÿç„¶ä¸ä¼šã€‚æ‰€ä»¥å¹³å¸¸ä¹Ÿä¼šçœ‹ä¸€äº›ç›¸å…³çš„åšå®¢æ–‡ç« ï¼Œä½†å¤§å¤šéƒ½æµ…å°è¾„æ­¢ï¼Œæ²¡æœ‰æ·±å…¥ã€‚æˆ‘å¼ºè¿«è‡ªå·±å†·é™ä¸‹æ¥ï¼Œæ˜ç¡®è‡ªå·±çš„ä¸»è¦ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Œæƒ³åˆ°Swiftéƒ½æ²¡ç©ç†Ÿç»ƒï¼Œå“ªæœ‰æ—¶é—´å»æAndroidæå‰ç«¯ï¼Œå­¦ä¹ é‡è¦çš„æ˜¯å¾ªåºæ¸è¿›ï¼Œä¸€æ­¥ä¸€æ­¥æ¥ã€‚</p>
<p>å¾ˆç¾æ„§åœ¨å­¦æ ¡æ²¡æœ‰å¥½å¥½å­¦ä¹ è‹±è¯­ï¼Œè‡´ä½¿æˆ‘ç°åœ¨ä¸å¤ªèƒ½æ— éšœç¢çš„é˜…è¯»ã€‚è™½ç„¶å¸¸å¸¸å€ŸåŠ©ç¿»è¯‘ï¼Œä½†å¾ˆå¤šè‹±æ–‡æ–‡ç« ï¼Œä¸è®ºæ˜¯æŠ€æœ¯ä¸Šçš„è¿˜æ˜¯ç”Ÿæ´»ä¸Šçš„ï¼Œéƒ½æ·±æ·±çš„æ”¹å˜äº†æˆ‘å¯¹è¿™ä¸ªä¸–ç•Œçš„è®¤è¯†ï¼Œæ‰“å¼€äº†å¦ä¸€æ‰‡çª—æˆ·ã€‚å­¦ä¹ çš„é“è·¯ä¸Šè¿˜æœ‰è®¸å¤šéœ€è¦åŠªåŠ›ï¼Œè‹±è¯­æ˜¯å¿…ä¸å¯å°‘çš„ä¸€éƒ¨åˆ†ã€‚</p>
<h3 id="æˆé•¿">æˆé•¿</h3><p>æŠ€æœ¯æ–¹é¢ç›¸å¯¹äºåœ¨æ ¡æˆé•¿äº†ä¸å°‘ï¼Œä½†ç¦»è‡ªå·±çš„æœŸæœ›è¿˜æœ‰ä¸å°‘å·®è·ã€‚</p>
<p>äº¤é™…æ–¹é¢åŸºæœ¬æ²¡æœ‰ä»€ä¹ˆæˆé•¿ï¼Œæ¥åŒ—äº¬åå¤ªå®…äº†ï¼Œè¿™ä¹Ÿæ˜¯æ˜å¹´é‡ç‚¹è¦è§£å†³çš„é—®é¢˜ã€‚</p>
<h3 id="åšå®¢">åšå®¢</h3><p>ä»¥å‰éƒ½æ˜¯åœ¨åšå®¢å›­ç®€å•çš„å†™å†™ç”»ç”»ï¼Œcopy&amp;pasteä»£ç ï¼Œå®Œå…¨æ²¡æœ‰ç« æ³•ï¼Œç°åœ¨æœ‰äº†å›ºå®šçš„åœ°æ–¹å¾ˆé«˜å…´èƒ½æŠŠåšå®¢åšæŒä¸‹æ¥ã€‚è™½ç„¶æ–‡ç¬”å¾ˆçƒ‚å¾ˆå¤šå†…å®¹æ·±åº¦ä¸å¤Ÿï¼Œæ–‡å­—ç»„ç»‡çš„ä¹Ÿä¸å¥½ï¼Œä½†æˆ‘è¿˜æ˜¯å¾ˆå…´å¥‹ï¼Œå› ä¸ºè¿™é‡Œæ˜¯è®°å½•æˆ‘æ‰€æ€æ‰€æƒ³çš„è‡ªç•™åœ°ã€‚æœ‰æ—¶éå¸¸ç¾¡æ…•é‚£äº›æ–‡ç¬”å¥½çš„äººï¼Œå¯ä»¥è‡ªç”±è‡ªåœ¨åœ°ç”¨æ–‡å­—æŠ’å‘è‡ªå·±çš„æƒ³æ³•å’Œæƒ…æ„Ÿï¼Œå› æ­¤è™½ç„¶æ˜¯ä¸ªç¨‹åºå‘˜ï¼Œè¿˜æ˜¯æƒ³æ–‡è‰ºç‚¹ã€‚å»ºç«‹è¿™ä¸ªåšå®¢è®°å½•ä¸‹æ—¥å¸¸çš„ç‚¹ç‚¹æ»´æ»´ï¼Œä¸è®ºæ˜¯æŠ€æœ¯ä¸Šçš„è¿˜æ˜¯ç”Ÿæ´»ä¸Šçš„ï¼Œå¦‚åŒæ¯ä¸ªäººå¯¹æ¯ä»¶äº‹çš„ç†è§£å’Œæ„Ÿæ‚Ÿéƒ½ä¸åŒï¼Œæˆ‘èƒ½åšçš„æ˜¯åœ¨è¿™é‡Œè®°å½•ä¸‹æˆ‘çš„äº²èº«ç»å†ã€‚ä»Šå¹´çš„åšå®¢å†™å¾—æ¯”è¾ƒå°‘ï¼Œå¯èƒ½æ˜¯å› ä¸ºå¿™ï¼Œå·¥ä½œåæ²¡æ—¶é—´äº†ã€‚16å¹´ï¼Œæ¯ä¸ªæœˆä¸€å®šè‡³å°‘ä¼šæœ‰ä¸€ç¯‡ã€‚</p>
<p>åœ¨è¿™é‡Œè´´ä¸Šå”å·§çš„ä¸€ç¯‡æ–‡ç« <a href="http://mp.weixin.qq.com/s?__biz=MjM5NTIyNTUyMQ==&amp;mid=440158123&amp;idx=2&amp;sn=f61b9cd6948edd7109662aafd3e147e2&amp;3rd=MzA3MDU4NTYzMw==&amp;scene=6#rd" target="_blank" rel="external">ä½œä¸ºç å†œï¼Œæˆ‘ä»¬ä¸ºä»€ä¹ˆè¦å†™ä½œ</a>ã€‚</p>
<h3 id="é˜…è¯»">é˜…è¯»</h3><h5 id="çº¸è´¨ä¹¦">çº¸è´¨ä¹¦</h5><p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/2015summary.png" alt="å›¾"></p>
<h5 id="ç”µå­ä¹¦">ç”µå­ä¹¦</h5><ul>
<li><p><a href="http://book.douban.com/subject/6709809/" target="_blank" rel="external">æš—æ—¶é—´</a></p>
</li>
<li><p><a href="http://book.douban.com/subject/6709783/" target="_blank" rel="external">æµªæ½®ä¹‹å·…</a></p>
</li>
<li><p><a href="https://gumroad.com/l/JnWS" target="_blank" rel="external">A GUIDE TO IOS ANIMATION</a></p>
</li>
<li><p><a href="https://selfstore.io/products/171" target="_blank" rel="external">Swifter</a></p>
</li>
<li><p><a href="http://shop.oreilly.com/product/0636920044352.do" target="_blank" rel="external">Programming iOS 9</a></p>
</li>
<li><p><a href="https://developer.apple.com/library/ios/documentation/Swift/Conceptual/Swift_Programming_Language/index.html#//apple_ref/doc/uid/TP40014097-CH3-ID0" target="_blank" rel="external">The Swift Programming Language</a></p>
</li>
</ul>
<p>ç”µå­ä¹¦è¿˜æœ‰ä¸€éƒ¨åˆ†æ²¡çœ‹å®Œï¼Œä½†æ€»çš„æ¥è¯´è¿˜æ˜¯çœ‹çš„å¤ªå°‘äº†ï¼Œæ‰“ç®—åœ¨16å¹´è¯»ä¸€äº›æ·±å…¥çš„ä¸“ä¸šä¹¦ç±ã€‚</p>
<h3 id="æœ€å">æœ€å</h3><blockquote>
<p>å¿™æ´»äº†ä¸€å¹´,</p>
<blockquote>
<p>æ¢¦æƒ³è¿‘äº†è¿˜æ˜¯è¿œäº†ï¼Ÿè¿œäº†ã€‚ </p>
<blockquote>
<p>å¹´åˆåˆ¶å®šçš„è®¡åˆ’éƒ½å®æ–½äº†å—ï¼Ÿæ²¡æœ‰ã€‚ </p>
<blockquote>
<p>bugæ”¹å®Œäº†å—ï¼Ÿæ²¡æœ‰ã€‚</p>
<blockquote>
<p>æ•°æ®ä¿®å®Œäº†å—ï¼Ÿæ²¡æœ‰ã€‚</p>
<blockquote>
<p>é¥­å°‘åƒä¸€å£äº†å—ï¼Œæ²¡æœ‰ã€‚</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<p>å¾®åšä¸Šçœ‹åˆ°è¿™å¥è¯è§‰å¾—å¥½è´´åˆ‡ï¼Œ2015è™½ç•™æœ‰é—æ†¾ï¼Œä½†æ–°çš„ä¸€å¹´å¿«åˆ°äº†ï¼ŒåŠ æ²¹2016ï¼Œæ„¿æ–°çš„ä¸€å¹´é‡Œï¼Œæˆ‘å¯ä»¥æ²‰è¿·å­¦ä¹ æ— æ³•è‡ªæ‹”ã€‚<img src="http://7xnmlk.com1.z0.glb.clouddn.com/2015-cheers.jpg" alt="12"></p>
<p>æœ€åï¼Œå¥½å¥½æ‰¾ä¸ªå¥³ç¥¨ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>è¿™ä¸€å¹´æ¯•ä¸šäº†ï¼Œå‘Šåˆ«äº†å¯èƒ½æ˜¯äººç”Ÿæœ€è‡ªç”±çš„æ—¶å…‰ã€‚è¿™ä¸€å¹´å·¥ä½œäº†ï¼Œç”±å­¦ç”Ÿæˆä¸ºäº†èŒä¸šå·¥ä½œè€…ã€‚ç°åœ¨æ˜¯26å·ï¼Œç¦»æœ¬å‘½å¹´å°±å‰©å‡ å¤©äº†ï¼Œæœ‰äº›å¿å¿‘ï¼Œæœ‰äº›æ„Ÿæ‚Ÿï¼Œæœ‰äº›åæ§½ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸€ä¸‹æˆ‘çš„2015ã€‚æ„è¯†æµâ€”â€”æƒ³åˆ°å“ªé‡Œâ€”â€”è¯´åˆ°å“ªé‡Œã€‚</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[å¦‚ä½•ä»¿å†™ä¸€ä¸ªApp]]></title>
    <link href="http://v2panda.com/2015/12/06/how-to-imitation-app/"/>
    <id>http://v2panda.com/2015/12/06/how-to-imitation-app/</id>
    <published>2015-12-06T12:47:37.000Z</published>
    <updated>2015-12-14T09:20:33.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1><p>æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç« <a href="http://www.infoq.com/cn/news/2015/11/ibireme-interview?utm_source=infoq&amp;utm_medium=popular_widget&amp;utm_campaign=popular_content_list&amp;utm_content=homepage" target="_blank" rel="external">ä¸“è®¿YYKitä½œè€…éƒ­æ›œæºï¼šå¼€æºå¤§ç‰›æ˜¯æ€æ ·ç‚¼æˆçš„</a>,å…¶ä¸­ <a href="http://weibo.com/239801242" target="_blank" rel="external">ibireme</a>æåˆ°äº†ä»–çš„å­¦ä¹ æ–¹æ³•ï¼Œä¸€ä¸ªå°±æ˜¯å¤§é‡åœ°é˜…è¯»ä¼˜ç§€é¡¹ç›®çš„æºä»£ç ï¼Œå¦ä¸€ä¸ªå°±æ˜¯è‡ªå·±åŠ¨æ‰‹å®è·µæ¥å°è¯•ã€‚è¿™éå¸¸å€¼å¾—å­¦ä¹ ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œæ²‰ä¸‹å¿ƒæ¥å¥½å¥½å†™ä»£ç æ‰æ˜¯æé«˜å§¿åŠ¿æ°´å¹³çš„ä¸Šç­–ï¼ŒTalk is cheap, Show me the code!<br>è¿™ç¯‡blogä¸»è¦è®°å½•ä»¿å†™ä¸€ä¸ªAppçš„å‡†å¤‡å·¥ä½œ,è¿™é‡Œä»¥ç¾å›¢ä¸ºä¾‹ã€‚</p>
<a id="more"></a>
<h1 id="ç´ æ">ç´ æ</h1><p>é¦–å…ˆåˆ°iTunesä¸‹è½½ç¾å›¢åˆ°æœ¬åœ°<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appå±å¹•å¿«ç…§%202015-12-01%20ä¸‹åˆ5.57.20.png" alt="åœ¨Finderä¸­æ˜¾ç¤º"></p>
<p>åœ¨Finderä¸­æ˜¾ç¤º,è§£å‹ipaæ–‡ä»¶<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appå±å¹•å¿«ç…§%202015-12-01%20ä¸‹åˆ5.53.53.png" alt="è§£å‹ipa"><br>ç‚¹å‡»imeituanï¼Œæ˜¾ç¤ºåŒ…å†…å®¹<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appå±å¹•å¿«ç…§%202015-12-01%20ä¸‹åˆ5.54.07.png" alt="æ˜¾ç¤ºåŒ…å†…å®¹"><br>å°±èƒ½éšæ„æŸ¥çœ‹imeituançš„ç´ æå†…å®¹ã€‚<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appå±å¹•å¿«ç…§%202015-12-01%20ä¸‹åˆ5.54.26.png" alt="ç´ æ"></p>
<h1 id="æ¥å£">æ¥å£</h1><ul>
<li><a href="https://www.charlesproxy.com/" target="_blank" rel="external">Charles</a><br>è¿™æ˜¯ä¸€æ¬¾åœ¨ Mac ä¸‹å¸¸ç”¨çš„ç½‘ç»œå°åŒ…æˆªå–å·¥å…·ï¼ŒCharles é€šè¿‡å°†è‡ªå·±è®¾ç½®æˆç³»ç»Ÿçš„ç½‘ç»œè®¿é—®ä»£ç†æœåŠ¡å™¨ï¼Œä½¿å¾—æ‰€æœ‰çš„ç½‘ç»œè®¿é—®è¯·æ±‚éƒ½é€šè¿‡å®ƒæ¥å®Œæˆ,è¿™é‡Œæˆ‘ä»¬ä¸»è¦ç”¨å®ƒæ¥æˆªå–ç½‘ç»œå°åŒ…æ¥åˆ†æã€‚</li>
</ul>
<p>è¿™é‡Œæˆ‘ä»¬ä¸»è¦æˆªå–iPhoneä¸ŠAppçš„ç½‘ç»œè¯·æ±‚ï¼Œæ‰€ä»¥ä½¿ç”¨ Charles çš„ç¬¬ä¸€æ­¥åœ¨èœå•æ ä¸Šé€‰æ‹© â€œProxyâ€â€“&gt;â€œProxy Settingsâ€ï¼Œå¡«å…¥ä»£ç†ç«¯å£ 8888ï¼Œå¹¶ä¸”å‹¾ä¸Š â€œEnable transparent HTTP proxyingâ€ å°±å®Œæˆäº†åœ¨ Charles ä¸Šçš„è®¾ç½®ã€‚å¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appå±å¹•å¿«ç…§%202015-12-01%20ä¸‹åˆ5.36.11.png" alt="Proxy"><br>ç„¶åæˆ‘ä»¬éœ€è¦è·å– Charles è¿è¡Œæ‰€åœ¨ç”µè„‘çš„ IP åœ°å€ï¼ŒCharles çš„é¡¶éƒ¨èœå•çš„ â€œHelpâ€â€“&gt;â€œLocal IP Addressâ€ï¼Œå³å¯åœ¨å¼¹å‡ºçš„å¯¹è¯æ¡†ä¸­çœ‹åˆ° IP åœ°å€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appå±å¹•å¿«ç…§%202015-12-01%20ä¸‹åˆ5.36.53.png" alt="IP"></p>
<p>æœ€ååœ¨ iPhone çš„ã€ŒHTTP ä»£ç†ã€ï¼Œå°†å…¶åˆ‡æ¢æˆæ‰‹åŠ¨ï¼Œç„¶åå¡«ä¸Š Charles è¿è¡Œæ‰€åœ¨çš„ç”µè„‘çš„ IPï¼Œä»¥åŠç«¯å£å· 8888ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appUntitled3.png" alt="8888"></p>
<p>æ¥ä¸‹æ¥åœ¨æ‰‹æœºä¸Šè¿è¡Œç¾å›¢ï¼Œå°±èƒ½å†Charlesä¸ŠæŸ¥çœ‹ç½‘ç»œè¯·æ±‚ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appå±å¹•å¿«ç…§%202015-12-01%20ä¸‹åˆ5.51.13.png" alt="flurry"><br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appå±å¹•å¿«ç…§%202015-12-01%20ä¸‹åˆ5.52.48.png" alt="http"><br>è¿™æ˜¯ç¾å›¢å¯åŠ¨æ˜¯Charlesçš„æ˜¾ç¤ºï¼Œå¯ä»¥çœ‹åˆ°<code>http://data.flurry.com</code>çš„è¯·æ±‚ï¼Œæ˜¾è€Œæ˜“è§ç¾å›¢iOSæ˜¯ä½¿ç”¨flurryç»Ÿè®¡æ•°æ®çš„ã€‚å…³äºCharlesè¯¦ç»†ä½¿ç”¨æ–¹æ³•å¯ä»¥æŸ¥çœ‹<a href="http://blog.devtang.com/blog/2015/11/14/charles-introduction/" target="_blank" rel="external">è¿™ç¯‡åšå®¢</a>ã€‚</p>
<h1 id="Appç»“æ„">Appç»“æ„</h1><p>è¿™é‡Œä½¿ç”¨Reaveal + iPhone(è¶Šç‹±)æ¥åˆ†æAppçš„UIè§†å›¾ç»“æ„ã€‚</p>
<p>å‡†å¤‡å·¥ä½œï¼š<br>1.iPhoneè¶Šç‹±ã€‚<br>2.è¶Šç‹±åiPhoneä¸Šä¼šè‡ªè¡Œå®‰è£…ä¸ŠCydiaå•†åº—ï¼Œæ‰“å¼€Cydiaï¼Œå…ˆåœ¨tabBarçš„â€œå˜æ›´â€é¡µé¢åˆ·æ–°è½¯ä»¶æºã€‚åˆ·æ–°æˆåŠŸåç”¨Cydiaæœç´¢å¹¶å®‰è£…Reveal loader ï¼Œå®‰è£…å®Œæˆåç‚¹å‡»é‡å¯springboardã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appUntitled.png" alt="Reveal loader"></p>
<p>3.åœ¨ç³»ç»Ÿè®¾ç½®ä¸­æ‰¾åˆ°Revealï¼Œç‚¹å‡»Reveal - Enabled Applicationsï¼Œå°†ç¾å›¢é€‰ä¸ºEnabledã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appUntitled2.png" alt="Enabled"></p>
<p>4.å®‰è£…<a href="http://revealapp.com/" target="_blank" rel="external">Reveal</a>ã€‚<br>5.é¦–å…ˆä¿è¯iPhoneå’ŒMacåœ¨åŒä¸€å±€åŸŸç½‘ï¼ˆWiFiï¼‰ä¸­ï¼Œåœ¨iPhoneä¸­è¿è¡Œä½ è¦ç›‘è§†çš„appï¼Œå¦‚æœappå·²ç»è¿è¡Œï¼Œéœ€åœ¨åå°æ€æ­»è¿›ç¨‹é‡æ–°æ‰“å¼€ï¼Œä¿æŒappåœ¨å‰å°ï¼Œç„¶ååœ¨Macä¸­æ‰“å¼€Revealï¼Œç‚¹å‡»å·¦ä¸Šè§’çš„No Connectionï¼Œç„¶åé€‰æ‹©å³å¯ã€‚<br>6.Commend+5 åˆ‡æ¢3Dæ¨¡å¼ã€‚æ¯å½“iPhoneä¸Šçš„appé¡µé¢åˆ‡æ¢åï¼Œéœ€è¦ç‚¹å‡»Revealçª—å£å³ä¸Šè§’åˆ·æ–°ï¼ˆCommend+Rï¼‰ã€‚åœ¨å±€åŸŸç½‘å†…è´Ÿè·è¾ƒå¤§æ—¶ï¼Œè§†å›¾åˆ·æ–°ä¼šå¾ˆæ…¢ï¼Œå¯ä»¥ç”¨iPhoneå…±äº«çƒ­ç‚¹ç»™Macè§£å†³ã€‚</p>
<p>å‡†å¤‡å®Œæ¯•åï¼Œå°±èƒ½åœ¨Revealä¸Šéšæ„æŸ¥çœ‹Appç»“æ„äº†ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-how-to-imitation-appå±å¹•å¿«ç…§%202015-12-01%20ä¸‹åˆ5.56.41.png" alt="Appç»“æ„"></p>
<h1 id="åè®°">åè®°</h1><p>è¿™ç¯‡blogä¸»è¦è®°å½•ä»¿å†™ä¸€ä¸ªAppçš„å‡†å¤‡å·¥ä½œ,åŒ…æ‹¬è·å–ç´ æï¼Œæ¥å£ï¼Œä»¥åŠæŸ¥çœ‹Appå±‚çº§ç»“æ„ï¼Œå…³äºå¦‚ä½•ä»¿å†™æ€ä¹ˆä»¿å†™ï¼Œå°±å¾—è‡ªå·±å»Codingäº†ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1><p>æœ€è¿‘çœ‹åˆ°ä¸€ç¯‡æ–‡ç« <a href="http://www.infoq.com/cn/news/2015/11/ibireme-interview?utm_source=infoq&amp;utm_medium=popular_widget&amp;utm_campaign=popular_content_list&amp;utm_content=homepage">ä¸“è®¿YYKitä½œè€…éƒ­æ›œæºï¼šå¼€æºå¤§ç‰›æ˜¯æ€æ ·ç‚¼æˆçš„</a>,å…¶ä¸­ <a href="http://weibo.com/239801242">ibireme</a>æåˆ°äº†ä»–çš„å­¦ä¹ æ–¹æ³•ï¼Œä¸€ä¸ªå°±æ˜¯å¤§é‡åœ°é˜…è¯»ä¼˜ç§€é¡¹ç›®çš„æºä»£ç ï¼Œå¦ä¸€ä¸ªå°±æ˜¯è‡ªå·±åŠ¨æ‰‹å®è·µæ¥å°è¯•ã€‚è¿™éå¸¸å€¼å¾—å­¦ä¹ ï¼Œå¯¹æˆ‘æ¥è¯´ï¼Œæ²‰ä¸‹å¿ƒæ¥å¥½å¥½å†™ä»£ç æ‰æ˜¯æé«˜å§¿åŠ¿æ°´å¹³çš„ä¸Šç­–ï¼ŒTalk is cheap, Show me the code!<br>è¿™ç¯‡blogä¸»è¦è®°å½•ä»¿å†™ä¸€ä¸ªAppçš„å‡†å¤‡å·¥ä½œ,è¿™é‡Œä»¥ç¾å›¢ä¸ºä¾‹ã€‚</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[è‡ªå»ºç½‘ç»œè°ƒè¯•å·¥å…·]]></title>
    <link href="http://v2panda.com/2015/11/25/network-debugging-tools/"/>
    <id>http://v2panda.com/2015/11/25/network-debugging-tools/</id>
    <published>2015-11-25T07:30:51.000Z</published>
    <updated>2015-12-14T09:19:48.000Z</updated>
    <content type="html"><![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1><p>æœ€è¿‘ç”¨çš„VPNè¶Šæ¥è¶Šä¸ç¨³å®šäº†ï¼Œå†³å®šæ­ä¸ªå°æ¢¯å­è‡ªç”¨ã€‚</p>
<table>
<thead>
<tr>
<th>My Choice</th>
<th style="text-align:center">Before</th>
<th style="text-align:center">Now</th>
</tr>
</thead>
<tbody>
<tr>
<td>Phone</td>
<td style="text-align:center">Hydro</td>
<td style="text-align:center">Surge</td>
</tr>
<tr>
<td>PC</td>
<td style="text-align:center">VPN + Lantern</td>
<td style="text-align:center">Shadowsocks</td>
</tr>
</tbody>
</table>
<a id="more"></a>
<p>è€Œåœ¨Surgeä¸Šä¹Ÿæ˜¯å¯ä»¥ç”¨Shadowsocksçš„ï¼Œå¹¶ä¸”Shadowsocksæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p>
<ul>
<li>çœç”µï¼Œåœ¨ç”µé‡æŸ¥çœ‹é‡Œå‡ ä¹çœ‹ä¸åˆ°å®ƒçš„èº«å½±ï¼›</li>
<li>æ”¯æŒå¼€æœºè‡ªå¯åŠ¨ï¼Œä¸”æ–­ç½‘æ— å½±å“ï¼Œæ— éœ€æ‰‹åŠ¨é‡è¿ï¼Œæ–¹ä¾¿ç½‘ç»œä¸ç¨³å®šæˆ–è€…3G&amp;Wi-Fié¢‘ç¹åˆ‡æ¢çš„å°ä¼™ä¼´ï¼›</li>
<li>å¯ä½¿ç”¨è‡ªå·±çš„æœåŠ¡å™¨ï¼Œå®‰å…¨å’Œé€Ÿåº¦çš„ä¿è¯ï¼›</li>
<li>æ”¯æŒåŒºåˆ†å›½å†…å¤–æµé‡ï¼Œä¼ ç»ŸVPNåœ¨ç¿»å‡ºå¢™å¤–åè®¿é—®å›½å†…ç«™ç‚¹ä¼šå˜æ…¢ï¼›</li>
<li>å¯å¯¹åº”ç”¨è®¾ç½®å•ç‹¬ä»£ç†ï¼Œ5.0ä¹‹åçš„ç³»ç»Ÿæ— éœ€rootã€‚</li>
</ul>
<p>è™½ç„¶ç”±äº<a href="http://www.freebuf.com/news/76451.html" target="_blank" rel="external">å–èŒ¶äº‹ä»¶</a>ï¼Œss çš„ä½œè€…å·²ç»åˆ é™¤é¡¹ç›®ï¼Œä¸è¿‡ç›®å‰è¿˜èƒ½ç”¨,æ‰€ä»¥æ­å»ºä¸€ä¸ªVPSå®‰è£…Shadowsocksæ˜¯æˆ‘çš„æœ€ä½³é€‰æ‹©ã€‚</p>
<h1 id="VPS">VPS</h1><p>VPSæœ‰è®¸è®¸å¤šå¤šï¼Œä½†æƒ³è¦è¾¾åˆ°ç½‘ç»œè°ƒè¯•çš„ç›®çš„è¿˜æ˜¯å¾—é€‰æ‹©æµ·å¤–çš„æœåŠ¡å™¨ã€‚<br>ç›®å‰ä¸»æµçš„VPSæä¾›å•†æœ‰3ä¸ª</p>
<ul>
<li>Banwagong</li>
<li>DigitalOcean</li>
<li>Linode</li>
</ul>
<p>è‹¥ä¸çŸ¥é“å¦‚ä½•é€‰æ‹©ï¼Œå¯ä»¥å‚è€ƒä¸‹è¡¨(æ¯”è¾ƒçš„éƒ½æ˜¯æœ€ä½å¥—é¤)</p>
<table>
<thead>
<tr>
<th>VPS</th>
<th style="text-align:center">æ¶æ„</th>
<th style="text-align:center">å†…å­˜</th>
<th style="text-align:center">ç¡¬ç›˜</th>
<th style="text-align:center">æµé‡</th>
<th style="text-align:center">è´¹ç”¨</th>
</tr>
</thead>
<tbody>
<tr>
<td>Banwagong</td>
<td style="text-align:center">OpenVZ</td>
<td style="text-align:center">256M</td>
<td style="text-align:center">10G</td>
<td style="text-align:center">500G/M</td>
<td style="text-align:center">19.99 $/Y</td>
</tr>
<tr>
<td>DigitalOcean</td>
<td style="text-align:center">KVM</td>
<td style="text-align:center">512M</td>
<td style="text-align:center">20G</td>
<td style="text-align:center">1T/M</td>
<td style="text-align:center">5 $/M</td>
</tr>
<tr>
<td>Linode</td>
<td style="text-align:center">Xen</td>
<td style="text-align:center">1G</td>
<td style="text-align:center">24G</td>
<td style="text-align:center">2T/M</td>
<td style="text-align:center">10 $/M</td>
</tr>
</tbody>
</table>
<p>ä¸ªäººå»ºè®®ï¼Œå¯¹è¿æ¥é€Ÿåº¦å’Œç¨³å®šæ€§å°¤å…¶æ˜¯ç½‘ç»œå»¶è¿Ÿæœ‰æé«˜è¦æ±‚çš„é¦–é€‰Linodeï¼Œæœ‰è¾ƒé«˜è¦æ±‚çš„æ¨èDigitalOceanï¼Œå¯¹äºæ™®é€šç”¨æˆ·æ¥è®²ï¼Œæ¬ç“¦å·¥å°±å¯ä»¥ã€‚<br>ä¸€èˆ¬ç”¨ paypal æ”¯ä»˜ï¼Œå› ä¸ºç”¨ä¿¡ç”¨å¡å¯èƒ½ä¼šè¦æ±‚ä½ ä¸Šä¼ èº«ä»½è¯æ˜ä»¥åŠä¿¡ç”¨å¡ç…§ç‰‡ä»€ä¹ˆçš„ï¼Œè€Œä¸”å®¡æ ¸è¿‡ç¨‹ä¹Ÿéœ€è¦ç­‰å¾…ï¼Œæ¯”è¾ƒéº»çƒ¦ã€‚æ³¨æ„è¦ç”¨å›½é™… paypal å¸å·ï¼Œå›½å†…çš„æ˜¯ä¸èƒ½ç”¨å¤–å¸ä»˜æ¬¾çš„ã€‚</p>
<h1 id="Shadowsocks">Shadowsocks</h1><p>VPSé€‰æ‹©å®Œæ¯•åï¼Œç›´æ¥ç™»å½•å¼€å§‹å®‰è£…ã€‚</p>
<p>Mac OS X æˆ– Linux ä¸‹ç›´æ¥åœ¨ç»ˆç«¯ä¸­ ssh root@your_vps_ip -p your_ssh_port   å³å¯ã€‚</p>
<p>Debian / Ubuntu:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get <span class="keyword">install</span> python-pip</span><br><span class="line">pip <span class="keyword">install</span> shadowsocks</span><br></pre></td></tr></table></figure>
<p>CentOS:</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">yum <span class="keyword">install</span> python-setuptools &amp;&amp; easy_install pip</span><br><span class="line">pip <span class="keyword">install</span> shadowsocks</span><br></pre></td></tr></table></figure>
<p>é…ç½®</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    "<span class="attribute">server</span>":<span class="value"><span class="string">"0.0.0.0"</span></span>,</span><br><span class="line">    "<span class="attribute">server_port</span>":<span class="value">yourport</span>,</span><br><span class="line">    "<span class="attribute">local_address</span>": <span class="value"><span class="string">"127.0.0.1"</span></span>,</span><br><span class="line">    "<span class="attribute">local_port</span>":<span class="value"><span class="number">1080</span></span>,</span><br><span class="line">    "<span class="attribute">password</span>":<span class="value"><span class="string">"yourpassword"</span></span>,</span><br><span class="line">    "<span class="attribute">timeout</span>":<span class="value"><span class="number">300</span></span>,</span><br><span class="line">    "<span class="attribute">method</span>":<span class="value"><span class="string">"aes-256-cfb"</span></span>,</span><br><span class="line">    "<span class="attribute">fast_open</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">workers</span>": <span class="value"><span class="number">1</span></span><br><span class="line"></span>&#125;</span><br></pre></td></tr></table></figure>
<p>ä½¿ç”¨</p>
<p><code>ssserver -p 443 -k password -m rc4-md5</code></p>
<p>åå°è¿è¡Œï¼š</p>
<p><code>sudo ssserver -p 443 -k password -m rc4-md5 --user nobody -d start</code></p>
<p>åœæ­¢ï¼š</p>
<p><code>sudo ssserver -d stop</code></p>
<p>æ£€æŸ¥æ—¥å¿—ï¼š</p>
<p><code>sudo less /var/log/shadowsocks.log</code></p>
<p>æ›´å…·ä½“çš„å¯ä»¥æŸ¥çœ‹<a href="https://github.com/shadowsocks/shadowsocks/wiki/Shadowsocks-%E4%BD%BF%E7%94%A8%E8%AF%B4%E6%98%8E" target="_blank" rel="external">wiki</a>ã€‚</p>
<h1 id="Surge">Surge</h1><p>Surge æ˜¯åŸºäº iOS 9 çš„æ–°ç‰¹æ€§ <code>Network Extension</code> å¼€å‘çš„ä¸€æ¬¾ç½‘ç»œè°ƒè¯•å·¥å…·ï¼Œå·¥ä½œåŸç†æ˜¯ä½¿ç”¨ Packet Tunnel Provider ç»™ç³»ç»Ÿå¥—ä¸Šä¸€ä¸ªä»£ç†ï¼ŒSurge æœ‰ä¸¤ä¸ªä¸»è¦ç»„ä»¶ï¼šSurge ä»£ç†æœåŠ¡å™¨å’Œ Surge TUN æ¥å£ã€‚ç¨‹åºè¿è¡Œä¹‹åï¼ŒSurge ä¼šå°†è‡ªèº«è®¾ç½®ä¸ºé»˜è®¤çš„ HTTP/HTTPS ä»£ç†æœåŠ¡å™¨æ¥å¤„ç†æ‰€æœ‰çš„ HTTP/HTTPS æµé‡ã€‚é’ˆå¯¹ä¸€äº›ä¸æœä»ç³»ç»Ÿä»£ç†è®¾ç½®çš„åº”ç”¨ç¨‹åº ï¼Œå°†ç”± Surge çš„ TUN æ¥å£æ¥è¿›è¡Œå¤„ç†ã€‚</p>
<p>Surgeå…·ä½“çš„ä½¿ç”¨å¯ä»¥æŸ¥çœ‹<a href="http://surge.run/manual/" target="_blank" rel="external">manual</a>ï¼Œè¿™é‡Œæˆ‘ä»¬ä¸»è¦é…ç½®Surgeåœ¨iOSä¸Šä½¿ç”¨Shadowsocksã€‚</p>
<p>å¦‚æœéœ€è¦ä½¿ç”¨shadowsocksï¼Œç›®å‰surge é€šè¿‡moduleæ”¯æŒé…ç½®ï¼Œå…·ä½“é…ç½®è§„åˆ™ç±»ä¼¼ä¸‹é¢çš„é…ç½®ï¼Œå…·ä½“çš„æœåŠ¡å™¨ã€ç«¯å£ã€åŠ å¯†æ–¹å¼ã€å¯†ç å‚ç…§ä½ è‡ªå·±çš„SSé…ç½®ï¼š</p>
<figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[Proxy]</span><br><span class="line"></span><br><span class="line">Proxy = custom, IP, Port, <span class="function"><span class="keyword">Method</span>, <span class="title">password</span>, <span class="title">Module</span></span></span><br></pre></td></tr></table></figure>
<p>Proxyç±»å‹å¿…é¡»æ˜¯customï¼Œå¦‚æœæ”¹æˆå…¶ä»–åç§°ä¼šæŠ¥é”™ï¼Œå‰©ä¸‹çš„åœ°å€æŒ‰ç…§æœåŠ¡å•†æä¾›çš„æ¥å¡«ï¼Œæœ€åè¦åŠ ä¸ŠSS moduleçš„åœ°å€ï¼Œç›®å‰surge çš„å®˜ç½‘å·²ç»åˆ æ‰äº†moduleæ–‡ä»¶ï¼Œå¯ä»¥ä»<a href="https://www.dropbox.com/s/jfvicg5omhlgg6g/SSEncrypt.module?dl=0" target="_blank" rel="external">è¿™é‡Œ</a>ä¸‹è½½ï¼Œä¸‹è½½åä¸Šä¼ åˆ°ä½ è‡ªå·±çš„ç½‘å€ã€‚</p>
<h1 id="æˆ‘çš„é€‰æ‹©">æˆ‘çš„é€‰æ‹©</h1><p>æˆ‘ä¸ªäººçš„é€‰æ‹©ä¾›å¤§å®¶å‚è€ƒï¼š</p>
<p>DigitalOceanï¼ŒSan FranciscoèŠ‚ç‚¹ï¼Œ1TBæµé‡ã€‚</p>
<p>è‹¥æœ‰æƒ³ç”¨DigitalOceanå¯ä»¥ä½¿ç”¨<a href="https://www.digitalocean.com/?refcode=93cc79d1d49b" target="_blank" rel="external">æ­¤é“¾æ¥</a>æ³¨å†Œ,å¯ä»¥å¾—åˆ°10$ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h1 id="å‰è¨€">å‰è¨€</h1><p>æœ€è¿‘ç”¨çš„VPNè¶Šæ¥è¶Šä¸ç¨³å®šäº†ï¼Œå†³å®šæ­ä¸ªå°æ¢¯å­è‡ªç”¨ã€‚</p>
<table>
<thead>
<tr>
<th>My Choice</th>
<th style="text-align:center">Before</th>
<th style="text-align:center">Now</th>
</tr>
</thead>
<tbody>
<tr>
<td>Phone</td>
<td style="text-align:center">Hydro</td>
<td style="text-align:center">Surge</td>
</tr>
<tr>
<td>PC</td>
<td style="text-align:center">VPN + Lantern</td>
<td style="text-align:center">Shadowsocks</td>
</tr>
</tbody>
</table>]]>
    
    </summary>
    
      <category term="Shadowsocks" scheme="http://v2panda.com/tags/Shadowsocks/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[æ»‘åŠ¨è¿”å›æ‰‹åŠ¿æ¢ç©¶]]></title>
    <link href="http://v2panda.com/2015/10/13/research-slidingback-gesture/"/>
    <id>http://v2panda.com/2015/10/13/research-slidingback-gesture/</id>
    <published>2015-10-13T08:44:49.000Z</published>
    <updated>2015-12-14T09:18:07.000Z</updated>
    <content type="html"><![CDATA[<h4 id="å‰è¨€">å‰è¨€</h4><p>ä»iOS7å¼€å§‹ï¼Œè‹¹æœå¢åŠ äº†é¡µé¢å³æ»‘è¿”å›çš„æ•ˆæœï¼Œå…·ä½“çš„æ˜¯ä»¥UINavigationControllerä¸ºå®¹å™¨çš„ViewControlleré—´å³æ»‘åˆ‡æ¢é¡µé¢ã€‚</p>
<p>ä»£ç é‡Œçš„è®¾ç½®æ˜¯ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span><span class="variable">.navigationController</span><span class="variable">.interactivePopGestureRecognizer</span><span class="variable">.enabled</span> = <span class="literal">YES</span>;ï¼ˆ<span class="keyword">default</span> is <span class="literal">YES</span>ï¼‰</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è‹¹æœç»™navigationControlleræ·»åŠ äº†ä¸€ä¸ªæ‰‹åŠ¿ï¼ˆå…·ä½“ä¸º<code>UIScreenEdgePanGestureRecognizer</code>ï¼ˆè¾¹ç¼˜æ‰‹åŠ¿ï¼ŒåŒæ ·æ˜¯ios7ä»¥åæ‰æœ‰çš„ï¼‰ï¼‰ï¼Œå°±æ˜¯åˆ©ç”¨è¿™ä¸ªæ‰‹åŠ¿å®ç°çš„ iOS7çš„ä¾§æ»‘è¿”å›ã€‚</p>
<p>ä½†åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¤§å¤šä¼šè‡ªå®šä¹‰è¿”å›æŒ‰é’®ï¼Œæ­¤æ—¶ç³»ç»Ÿçš„å³æ»‘è¿”å›å°±ä¼šå¤±æ•ˆã€‚ç„¶è€Œæ”¯æŒæ»‘åŠ¨è¿”å›å·²æˆä¸ºiOSä¸Šå¿…é¡»å®ç°çš„äº¤äº’ï¼Œè‹¥æ²¡æœ‰é‚£APPç¦»è¢«å¸è½½å°±ä¸è¿œäº†ã€‚</p>
<a id="more"></a>
<h4 id="è®¾ç½®interactivePopGestureRecognizer">è®¾ç½®interactivePopGestureRecognizer</h4><p>å¯¹äºè¿™ç§å¤±æ•ˆçš„æƒ…å†µï¼Œè€ƒè™‘åˆ°<code>interactivePopGestureRecognizer</code>ä¹Ÿæœ‰delegateå±æ€§ï¼Œæ›¿æ¢é»˜è®¤çš„self.navigationController.interactivePopGestureRecognizer.delegateæ¥é…ç½®å³æ»‘è¿”å›çš„è¡¨ç°ä¹Ÿæ˜¯å¯è¡Œçš„ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ä¸»NavigationControllerä¸­è®¾ç½®ä¸€ä¸‹ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">self<span class="class">.navigationController</span><span class="class">.interactivePopGestureRecognizer</span><span class="class">.delegate</span> =(id)self</span><br></pre></td></tr></table></figure>
<p>ç„¶è€Œè¿™æ ·åˆä¼šå‡ºç°å¾ˆå¤šé—®é¢˜ï¼Œæ¯”å¦‚è¯´åœ¨rootViewControllerçš„æ—¶å€™è¿™ä¸ªæ‰‹åŠ¿ä¹Ÿå¯ä»¥å“åº”ï¼Œå¯¼è‡´æ•´ä¸ªç¨‹åºé¡µé¢ä¸å“åº”ï¼›pushäº†å¤šå±‚åï¼Œå¿«é€Ÿçš„è§¦å‘ä¸¤æ¬¡æ‰‹åŠ¿ï¼Œä¹Ÿä¼šé”™ä¹±ã€‚</p>
<h4 id="æœ€ä½³æ–¹æ¡ˆ">æœ€ä½³æ–¹æ¡ˆ</h4><p>æœ€ä½³æ–¹æ¡ˆå‚è€ƒè‡ªsunnyxxçš„åšå®¢ï¼Œä»–æ˜¯æ€ä¹ˆåšçš„å‘¢ã€‚<br>é€šè¿‡è®¾ç½®interactivePopGestureRecognizerå¯ä»¥ç®€å•çš„å®ç°ï¼Œä½†åˆä¼šå‡ºç°å¾ˆå¤šé—®é¢˜ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥è‡ªå·±å®ç°ä¸€ä¸ªæ‰‹åŠ¿å»æ›¿æ¢æ‰ç³»ç»Ÿçš„ï¼Œè¿ç”¨</p>
<ul>
<li>runtime+KVC+AOP</li>
</ul>
<p>çš„æ–¹å¼ï¼Œç”¨KVCæ‹¿åˆ°interactivePopGestureRecognizerçš„targetå’Œactionï¼Œç”¨runtimeåŠ¨æ€æ›¿æ¢æ‰ï¼Œé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œä¸ç”¨åœ¨åŸå·¥ç¨‹ä¸Šå¢åˆ ä»£ç ã€‚</p>
<h4 id="å®ç°">å®ç°</h4><p>è¿˜æ˜¯å†™ç æœ€çœäº‹ï¼Œç›´æ¥åŠ¨æ‰‹ï¼</p>
<p>é¦–å…ˆï¼Œåˆ›å»ºä¸€ä¸ªUINavigationControllerçš„åˆ†ç±»,å†æ·»åŠ UIViewControllerçš„åˆ†ç±»,åœ¨UINavigationController.hé‡Œå£°æ˜è‡ªå®šä¹‰çš„æ‰‹åŠ¿ï¼Œåœ¨UIViewController.hé‡Œå£°æ˜<code>pda_interactivePopDisabled</code>æ˜¯å¦æ˜¾ç¤ºæ‰‹åŠ¿å’Œpda_interactivePopMaxAllowedInitialDistanceToLeftEdgeæ‰‹åŠ¿æ»‘åŠ¨è·å·¦è¾¹æœ€å¤§çš„è·ç¦»ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;UIKit/UIKit.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UINavigationController</span> (<span class="title">PDAPopGesture</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">strong</span>, <span class="keyword">readonly</span>) <span class="built_in">UIPanGestureRecognizer</span> *pda_popGestureRecognizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">UIViewController</span> (<span class="title">PDAPopGesture</span>)</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">BOOL</span> pda_interactivePopDisabled;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">assign</span>) <span class="built_in">CGFloat</span> pda_interactivePopMaxAllowedInitialDistanceToLeftEdge;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>åœ¨.mé‡Œå®šä¹‰ä¸€ä¸ªç§æœ‰ç±»ï¼Œè®¾ç½®æ‰‹åŠ¿çš„æ‰§è¡Œæ¡ä»¶ã€‚</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"UINavigationController+PDAPopGesture.h"</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;objc/runtime.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">PDAFullscreenPopGestureRecognizerDelegate</span> : <span class="title">NSObject</span> &lt;<span class="title">UIGestureRecognizerDelegate</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span>, <span class="keyword">weak</span>) <span class="built_in">UINavigationController</span> *navigationController;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">PDAFullscreenPopGestureRecognizerDelegate</span></span></span><br><span class="line"></span><br><span class="line">- (<span class="built_in">BOOL</span>)gestureRecognizerShouldBegin:(<span class="built_in">UIPanGestureRecognizer</span> *)gestureRecognizer</span><br><span class="line">&#123;</span><br><span class="line">Â  Â  <span class="comment">// å½“ä¸ºæ ¹æ§åˆ¶å™¨æ—¶ï¼Œæ‰‹åŠ¿ä¸æ‰§è¡Œã€‚</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (<span class="keyword">self</span><span class="variable">.navigationController</span><span class="variable">.viewControllers</span><span class="variable">.count</span> &lt;= <span class="number">1</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="comment">// è®¾ç½®ä¸€ä¸ªé¡µé¢æ˜¯å¦æ˜¾ç¤ºæ­¤æ‰‹åŠ¿ï¼Œé»˜è®¤ä¸ºNO æ˜¾ç¤ºã€‚</span></span><br><span class="line">Â  Â  <span class="built_in">UIViewController</span> *topViewController = <span class="keyword">self</span><span class="variable">.navigationController</span><span class="variable">.viewControllers</span><span class="variable">.lastObject</span>;</span><br><span class="line">Â  Â  <span class="keyword">if</span> (topViewController<span class="variable">.pda_interactivePopDisabled</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="comment">//Â  æ‰‹åŠ¿æ»‘åŠ¨è·å·¦è¾¹æ¡†çš„è·ç¦»è¶…è¿‡maxAllowedInitialDistance æ‰‹åŠ¿ä¸æ‰§è¡Œã€‚</span></span><br><span class="line">Â  Â  <span class="built_in">CGPoint</span> beginningLocation = [gestureRecognizer locationInView:gestureRecognizer<span class="variable">.view</span>];</span><br><span class="line">Â  Â  <span class="built_in">CGFloat</span> maxAllowedInitialDistance = topViewController<span class="variable">.pda_interactivePopMaxAllowedInitialDistanceToLeftEdge</span>;</span><br><span class="line">Â  Â  <span class="keyword">if</span> (maxAllowedInitialDistance &gt; <span class="number">0</span> &amp;&amp; beginningLocation<span class="variable">.x</span> &gt; maxAllowedInitialDistance) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="comment">// å½“pushã€popåŠ¨ç”»æ­£åœ¨æ‰§è¡Œæ—¶ï¼Œæ‰‹åŠ¿ä¸æ‰§è¡Œã€‚</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> ([[<span class="keyword">self</span><span class="variable">.navigationController</span> valueForKey:<span class="string">@"_isTransitioning"</span>] boolValue]) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="comment">//Â  å‘å·¦è¾¹(åæ–¹å‘)æ‹–åŠ¨ï¼Œæ‰‹åŠ¿ä¸æ‰§è¡Œã€‚</span></span><br><span class="line">Â  Â  <span class="built_in">CGPoint</span> translation = [gestureRecognizer translationInView:gestureRecognizer<span class="variable">.view</span>];</span><br><span class="line">Â  Â  <span class="keyword">if</span> (translation<span class="variable">.x</span> &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> <span class="literal">NO</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â Â  Â </span><br><span class="line">Â  Â  <span class="keyword">return</span> <span class="literal">YES</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>å†åœ¨UINavigationControllerçš„å®ç°é‡Œç”¨Method Swizzlingæ›¿æ¢pushViewControlleræ–¹æ³•ã€‚</p>
<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">+(void)load</span><br><span class="line">&#123;</span><br><span class="line">Â  Â  static dispatch_once_t onceToken;</span><br><span class="line">Â  Â  dispatch_once(&amp;onceToken, ^&#123;</span><br><span class="line">Â  Â  Â  Â  Class <span class="class"><span class="keyword">class</span> = [<span class="title">self</span> <span class="title">class</span>];</span></span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  SEL originalSelector = @selector(pushViewController:animated:);</span><br><span class="line">Â  Â  Â  Â  SEL swizzledSelector = @selector(pda_pushViewController:animated:);</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  Method originalMethod = class_getInstanceMethod(<span class="class"><span class="keyword">class</span>, <span class="typename">originalSelector);</span></span></span><br><span class="line">Â  Â  Â  Â  Method swizzledMethod = class_getInstanceMethod(<span class="class"><span class="keyword">class</span>, <span class="typename">swizzledSelector);</span></span></span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  BOOL success = class_addMethod(<span class="class"><span class="keyword">class</span>, <span class="typename">originalSelector</span>, <span class="typename">method_getImplementation</span></span>(swizzledMethod), method_getTypeEncoding(swizzledMethod));</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">if</span> (success) &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  class_replaceMethod(<span class="class"><span class="keyword">class</span>, <span class="typename">swizzledSelector</span>, <span class="typename">method_getImplementation</span></span>(originalMethod), method_getTypeEncoding(originalMethod));</span><br><span class="line">Â  Â  Â  Â  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">Â  Â  Â  Â  Â  Â  method_exchangeImplementations(originalMethod, swizzledMethod);</span><br><span class="line">Â  Â  Â  Â  &#125;</span><br><span class="line">Â  Â  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯Method Swizzling API æä¾›çš„ä¸‰ä¸ªæ–¹æ³•æ¥åŠ¨æ€æ›¿æ¢ç±»æ–¹æ³•æˆ–å®ä¾‹æ–¹æ³•ã€‚</p>
<ul>
<li>class_replaceMethod                         æ›¿æ¢ç±»æ–¹æ³•çš„å®šä¹‰</li>
<li>method_exchangeImplementations   äº¤æ¢ 2 ä¸ªæ–¹æ³•çš„å®ç°</li>
<li>method_setImplementation               è®¾ç½® 1 ä¸ªæ–¹æ³•çš„å®ç°</li>
</ul>
<p>è€Œè¿™ä¸‰ä¸ªåˆæœ‰äº›ä½¿ç”¨ä¸Šçš„åŒºåˆ«ï¼Œclass_replaceMethod, å½“éœ€è¦æ›¿æ¢çš„æ–¹æ³•å¯èƒ½æœ‰ä¸å­˜åœ¨çš„æƒ…å†µæ—¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨è¯¥æ–¹æ³•ã€‚method_exchangeImplementationsï¼Œå½“éœ€è¦äº¤æ¢ 2 ä¸ªæ–¹æ³•çš„å®ç°æ—¶ä½¿ç”¨ã€‚method_setImplementation æœ€ç®€å•çš„ç”¨æ³•ï¼Œå½“ä»…ä»…éœ€è¦ä¸ºä¸€ä¸ªæ–¹æ³•è®¾ç½®å…¶å®ç°æ–¹å¼æ—¶ä½¿ç”¨ã€‚</p>
<p>æ‰€ä»¥è¿™é‡Œå¾—å…ˆç¡®è®¤æ·»åŠ çš„æ–¹æ³•æ˜¯å¦å­˜åœ¨ï¼Œä¸¾ä¸ªå…·ä½“çš„ä¾‹å­, å‡è®¾è¦æ›¿æ¢æ‰[NSView description]æ–¹æ³•ï¼Œå¦‚æœNSView æ²¡æœ‰å®ç°-description (å¯é€‰çš„) é‚£ä½ å°±å¯ä¼šå¾—åˆ°NSObjectçš„æ–¹æ³•ã€‚ å¦‚æœè°ƒç”¨method_exchangeImplementations , ä½ å°±ä¼šæŠŠNSObject çš„æ–¹æ³•æ›¿æ¢æˆä½ çš„ä»£ç ï¼Œè¿™æ˜¾ç„¶ä¸æ˜¯æˆ‘ä»¬æƒ³è¦çš„ã€‚</p>
<p>æ‰€ä»¥åœ¨è¿™é‡Œå®šä¹‰ä¸€ä¸ªBOOLå€¼æ¥æ¥æ”¶class_addMethodçš„è¿”å›å€¼ï¼Œclass_addMethodä¼šåŠ¨æ€çš„ç»™ç±»æ·»åŠ æ–¹æ³•ï¼Œè‹¥æ–¹æ³•fd_viewWillAppearå·²å­˜åœ¨ï¼Œclass_addMethodä¼šè¿”å›å¤±è´¥ï¼Œæ­¤æ—¶è°ƒç”¨method_exchangeImplementationså»æ›¿æ¢ï¼Œè‹¥ä¸å­˜åœ¨ï¼Œåˆ™ç”¨class_replaceMethodæ›¿æ¢ã€‚</p>
<p>ç»§ç»­å®ç°pda_pushViewController:animatedæ–¹æ³•</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)pda_pushViewController:(<span class="built_in">UIViewController</span> *)viewController animated:(<span class="built_in">BOOL</span>)animated</span><br><span class="line">&#123;</span><br><span class="line">Â  Â  <span class="keyword">if</span> (![<span class="keyword">self</span><span class="variable">.interactivePopGestureRecognizer</span><span class="variable">.view</span><span class="variable">.gestureRecognizers</span> containsObject:<span class="keyword">self</span><span class="variable">.pda_popGestureRecognizer</span>])</span><br><span class="line">    &#123;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">//Â  æ·»åŠ æˆ‘ä»¬è‡ªå·±çš„ä¾§æ»‘è¿”å›æ‰‹åŠ¿</span></span><br><span class="line">Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.interactivePopGestureRecognizer</span><span class="variable">.view</span> addGestureRecognizer:<span class="keyword">self</span><span class="variable">.pda_popGestureRecognizer</span>];</span><br><span class="line">Â  Â  Â  Â  <span class="comment">/*</span><br><span class="line">Â Â  Â  Â  Â  æ–°å»ºä¸€ä¸ªUIPanGestureRecognizerï¼Œè®©å®ƒçš„è§¦å‘å’Œç³»ç»Ÿçš„è¿™ä¸ªæ‰‹åŠ¿ç›¸åŒï¼Œ</span><br><span class="line">Â Â  Â  Â  Â  è¿™å°±éœ€è¦åˆ©ç”¨runtimeè·å–ç³»ç»Ÿæ‰‹åŠ¿çš„targetå’Œactionã€‚</span><br><span class="line">Â Â  Â  Â  Â  */</span></span><br><span class="line">Â  Â  Â  Â  <span class="comment">//Â  ç”¨KVCå–å‡ºtargetå’Œaction</span></span><br><span class="line">Â  Â  Â  Â  <span class="built_in">NSArray</span> *internalTargets = [<span class="keyword">self</span><span class="variable">.interactivePopGestureRecognizer</span> valueForKey:<span class="string">@"targets"</span>];</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">id</span> internalTarget = [internalTargets<span class="variable">.firstObject</span> valueForKey:<span class="string">@"target"</span>];</span><br><span class="line">Â  Â  Â  Â  SEL internalAction = <span class="built_in">NSSelectorFromString</span>(<span class="string">@"handleNavigationTransition:"</span>);</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="comment">//Â  å°†è‡ªå®šä¹‰çš„ä»£ç†ï¼ˆæ‰‹åŠ¿æ‰§è¡Œæ¡ä»¶ï¼‰ä¼ ç»™æ‰‹åŠ¿çš„delegate</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">self</span><span class="variable">.pda_popGestureRecognizer</span><span class="variable">.delegate</span> = <span class="keyword">self</span><span class="variable">.pda_popGestureRecognizerDelegate</span>;</span><br><span class="line">Â  Â  Â  Â  <span class="comment">//Â  å°†targetå’Œactionä¼ ç»™æ‰‹åŠ¿</span></span><br><span class="line">Â  Â  Â  Â  [<span class="keyword">self</span><span class="variable">.pda_popGestureRecognizer</span> addTarget:internalTarget action:internalAction];</span><br><span class="line">Â Â  Â  Â  Â </span><br><span class="line">Â  Â  Â  Â  <span class="comment">//Â  è®¾ç½®ç³»ç»Ÿçš„ä¸ºNO</span></span><br><span class="line">Â  Â  Â  Â  <span class="keyword">self</span><span class="variable">.interactivePopGestureRecognizer</span><span class="variable">.enabled</span> = <span class="literal">NO</span>;</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  <span class="comment">//Â  æ‰§è¡ŒåŸæœ¬çš„æ–¹æ³•</span></span><br><span class="line">Â  Â  <span class="keyword">if</span> (![<span class="keyword">self</span><span class="variable">.viewControllers</span> containsObject:viewController]) &#123;</span><br><span class="line">Â  Â  Â  Â  [<span class="keyword">self</span> pda_pushViewController:viewController animated:animated];</span><br><span class="line">Â  Â  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>å…¶ä¸­è¦æ³¨æ„çš„æ˜¯å°†å‰é¢å®šä¹‰çš„æ‰‹åŠ¿è§¦å‘æ¡ä»¶çš„delegateä¼ ç»™pda_popGestureRecognizerçš„delegateã€‚</p>
<p>æœ€åè¡¥ä¸Špda_popGestureRecognizerçš„getterå’Œpda_popGestureRecognizerDelegateçš„setteræ–¹æ³•ã€‚</p>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">- <span class="list">(<span class="keyword">PDAFullscreenPopGestureRecognizerDelegate</span> <span class="variable">*)pda_popGestureRecognizerDelegate</span><br><span class="line">&#123;</span><br><span class="line">Â  Â  PDAFullscreenPopGestureRecognizerDelegate *</span>delegate = objc_getAssociatedObject<span class="list">(<span class="keyword">self</span>, _cmd)</span><span class="comment">;</span></span><br><span class="line">Â  Â  if <span class="list">(!delegate)</span> &#123;</span><br><span class="line">Â  Â  Â  Â  delegate = [[PDAFullscreenPopGestureRecognizerDelegate alloc] init]<span class="comment">;</span></span><br><span class="line">Â  Â  Â  Â  delegate.navigationController = self<span class="comment">;</span></span><br><span class="line">Â  Â  Â  Â  objc_setAssociatedObject<span class="list">(<span class="keyword">self</span>, _cmd, delegate, OBJC_ASSOCIATION_RETAIN_NONATOMIC)</span><span class="comment">;</span></span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  return delegate<span class="comment">;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">- <span class="list">(<span class="keyword">UIPanGestureRecognizer</span> <span class="variable">*)pda_fullscreenPopGestureRecognizer</span><br><span class="line">&#123;</span><br><span class="line">Â  Â  UIPanGestureRecognizer *</span>panGestureRecognizer = objc_getAssociatedObject<span class="list">(<span class="keyword">self</span>, _cmd)</span><span class="comment">;</span></span><br><span class="line">Â  Â  if <span class="list">(!panGestureRecognizer)</span> &#123;</span><br><span class="line">Â  Â  Â  Â  panGestureRecognizer = [[UIPanGestureRecognizer alloc] init]<span class="comment">;</span></span><br><span class="line">Â  Â  Â  Â  panGestureRecognizer.maximumNumberOfTouches = <span class="number">1</span><span class="comment">;</span></span><br><span class="line">Â  Â  Â  Â  objc_setAssociatedObject<span class="list">(<span class="keyword">self</span>, _cmd, panGestureRecognizer, OBJC_ASSOCIATION_RETAIN_NONATOMIC)</span><span class="comment">;</span></span><br><span class="line">Â  Â  &#125;</span><br><span class="line">Â  Â  return panGestureRecognizer<span class="comment">;</span></span><br><span class="line">&#125;</span></span></span><br></pre></td></tr></table></figure>
<p>åé¢UIViewControlleråªéœ€è¦ç»™å‡º<code>pda_interactivePopMaxAllowedInitialDistanceToLeftEdge</code><br>å’Œ<code>pda_interactivePopDisabled</code>çš„setterå’Œgetterå³å¯ã€‚</p>
<h4 id="åè®°">åè®°</h4><p>å¤§åŠŸå‘Šæˆï¼Œç›´æ¥æ·»åŠ åˆ°å·¥ç¨‹é‡Œï¼Œä¸ç”¨é¢å¤–ä»£ç å³å¯ä¸ºä½ çš„é¡¹ç›®æ·»åŠ æ»‘åŠ¨è¿”å›æ•ˆæœï¼Œå¿«å»è¯•è¯•å§ï¼</p>
<h4 id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</h4><p><a href="http://blog.sunnyxx.com/2015/06/07/fullscreen-pop-gesture/" target="_blank" rel="external">http://blog.sunnyxx.com/2015/06/07/fullscreen-pop-gesture/</a></p>
]]></content>
    <summary type="html">
    <![CDATA[<h4 id="å‰è¨€">å‰è¨€</h4><p>ä»iOS7å¼€å§‹ï¼Œè‹¹æœå¢åŠ äº†é¡µé¢å³æ»‘è¿”å›çš„æ•ˆæœï¼Œå…·ä½“çš„æ˜¯ä»¥UINavigationControllerä¸ºå®¹å™¨çš„ViewControlleré—´å³æ»‘åˆ‡æ¢é¡µé¢ã€‚</p>
<p>ä»£ç é‡Œçš„è®¾ç½®æ˜¯ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">self</span><span class="variable">.navigationController</span><span class="variable">.interactivePopGestureRecognizer</span><span class="variable">.enabled</span> = <span class="literal">YES</span>;ï¼ˆ<span class="keyword">default</span> is <span class="literal">YES</span>ï¼‰</span><br></pre></td></tr></table></figure>
<p>å¯ä»¥çœ‹åˆ°è‹¹æœç»™navigationControlleræ·»åŠ äº†ä¸€ä¸ªæ‰‹åŠ¿ï¼ˆå…·ä½“ä¸º<code>UIScreenEdgePanGestureRecognizer</code>ï¼ˆè¾¹ç¼˜æ‰‹åŠ¿ï¼ŒåŒæ ·æ˜¯ios7ä»¥åæ‰æœ‰çš„ï¼‰ï¼‰ï¼Œå°±æ˜¯åˆ©ç”¨è¿™ä¸ªæ‰‹åŠ¿å®ç°çš„ iOS7çš„ä¾§æ»‘è¿”å›ã€‚</p>
<p>ä½†åœ¨æ—¥å¸¸å¼€å‘ä¸­ï¼Œæˆ‘ä»¬å¤§å¤šä¼šè‡ªå®šä¹‰è¿”å›æŒ‰é’®ï¼Œæ­¤æ—¶ç³»ç»Ÿçš„å³æ»‘è¿”å›å°±ä¼šå¤±æ•ˆã€‚ç„¶è€Œæ”¯æŒæ»‘åŠ¨è¿”å›å·²æˆä¸ºiOSä¸Šå¿…é¡»å®ç°çš„äº¤äº’ï¼Œè‹¥æ²¡æœ‰é‚£APPç¦»è¢«å¸è½½å°±ä¸è¿œäº†ã€‚</p>]]>
    
    </summary>
    
      <category term="iOS" scheme="http://v2panda.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[é“¾å¼ç¼–ç¨‹åˆæ¢]]></title>
    <link href="http://v2panda.com/2015/09/29/chain-programming/"/>
    <id>http://v2panda.com/2015/09/29/chain-programming/</id>
    <published>2015-09-29T08:44:49.000Z</published>
    <updated>2015-12-14T06:43:57.000Z</updated>
    <content type="html"><![CDATA[<h4 id="å‰è¨€">å‰è¨€</h4><p>æœ€è¿‘å­¦ä¹ äº†ä¸‹<a href="https://github.com/SnapKit/Masonry" target="_blank" rel="external">masonry</a>çš„æºç ,çœ‹åˆ°æœ‰è®¸å¤šå¦‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">make</span><span class="class">.top</span><span class="class">.equalTo</span>(<span class="tag">self</span><span class="class">.mas_topLayoutGuide</span>);Â </span><br><span class="line"><span class="tag">make</span><span class="class">.left</span><span class="class">.equalTo</span>(<span class="tag">self</span><span class="class">.view</span>);</span><br><span class="line"><span class="tag">make</span><span class="class">.right</span><span class="class">.equalTo</span>(<span class="tag">self</span><span class="class">.view</span>);</span><br><span class="line"><span class="tag">make</span><span class="class">.height</span><span class="class">.equalTo</span>(<span class="at_rule">@<span class="keyword">40);</span></span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„ä»£ç ï¼Œå¯¹è¿™ç§é“¾å¼çš„å†™æ³•å¾ˆæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥å‡†å¤‡ç ”ç©¶ä¸€ä¸‹ï¼Œå­¦ä¹ å®ƒçš„ç¼–ç¨‹æ€æƒ³ã€‚</p>
<a id="more"></a>
<h4 id="é“¾å¼ç¼–ç¨‹æ€æƒ³">é“¾å¼ç¼–ç¨‹æ€æƒ³</h4><p>æ˜¯å°†å¤šä¸ªæ“ä½œï¼ˆå¤šè¡Œä»£ç ï¼‰é€šè¿‡ç‚¹å·(.)é“¾æ¥åœ¨ä¸€èµ·æˆä¸ºä¸€å¥ä»£ç ,ä½¿ä»£ç å¯è¯»æ€§å¥½ã€‚å¦‚a(1).b(2).c(3)</p>
<h4 id="é“¾å¼ç¼–ç¨‹ç‰¹ç‚¹">é“¾å¼ç¼–ç¨‹ç‰¹ç‚¹</h4><p>æ–¹æ³•çš„è¿”å›å€¼æ˜¯block,blockå¿…é¡»æœ‰è¿”å›å€¼ï¼ˆæœ¬èº«å¯¹è±¡ï¼‰ï¼Œblockå‚æ•°ï¼ˆéœ€è¦æ“ä½œçš„å€¼ï¼‰</p>
<h4 id="å®æˆ˜">å®æˆ˜</h4><p>æ¨¡ä»¿masonryï¼Œå†™ä¸€ä¸ªåŠ æ³•è®¡ç®—å™¨ï¼Œç»ƒä¹ é“¾å¼ç¼–ç¨‹ã€‚</p>
<p>1.æ–°å»ºç±»ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/234048-193e56372a1f9b54.png" alt="a.png"></p>
<p>2.åœ¨CaculatorMaker.hé‡Œå®šä¹‰å››åˆ™è¿ç®—</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">@<span class="keyword">interface</span> <span class="type">CaculatorMaker</span> : <span class="type">NSObject</span></span><br><span class="line"></span><br><span class="line">@property (nonatomic, assign) <span class="type">int</span> <span class="literal">result</span>;</span><br><span class="line"></span><br><span class="line">- (<span class="type">CaculatorMaker</span> *(^)(<span class="type">int</span>))add;</span><br><span class="line">- (<span class="type">CaculatorMaker</span> *(^)(<span class="type">int</span>))sub;</span><br><span class="line">- (<span class="type">CaculatorMaker</span> *(^)(<span class="type">int</span>))multi;</span><br><span class="line">- (<span class="type">CaculatorMaker</span> *(^)(<span class="type">int</span>))divide;</span><br><span class="line"></span><br><span class="line">@<span class="keyword">end</span></span><br></pre></td></tr></table></figure>
<p>3.åœ¨CaculatorMaker.mé‡Œå®ç°</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="type">CaculatorMaker</span> *(^)(<span class="type">int</span>))add</span><br><span class="line">&#123;</span><br><span class="line">Â  Â  <span class="keyword">return</span> ^id(<span class="type">int</span> x) &#123;</span><br><span class="line">Â  Â  Â  Â  self.<span class="literal">result</span> += x;</span><br><span class="line">Â  Â  Â  Â  <span class="keyword">return</span> self;</span><br><span class="line">Â  Â  &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>4.å®šä¹‰è¿ç®—æ–¹æ³•</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">@class</span> <span class="title">CaculatorMaker</span>;</span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">NSObject</span> (<span class="title">Caculator</span>)</span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">int</span>)makeCaculators:(<span class="keyword">void</span>(^)(CaculatorMaker *maker))caculatorMaker;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>5.å®ç°</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">+ (<span class="type">int</span>)makeCaculators:(<span class="type">void</span>(^)(<span class="type">CaculatorMaker</span> *maker))caculatorMaker</span><br><span class="line">&#123;</span><br><span class="line">Â  Â  <span class="type">CaculatorMaker</span> *maker = [[<span class="type">CaculatorMaker</span> alloc]init];</span><br><span class="line">Â  Â  caculatorMaker(maker);</span><br><span class="line">Â  Â  <span class="keyword">return</span> maker.<span class="literal">result</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>6.æœ€åå°±èƒ½éšæ„è°ƒç”¨äº†</p>
<figure class="highlight nimrod"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="literal">result</span> = [<span class="type">NSObject</span> makeCaculators:^(<span class="type">CaculatorMaker</span> *maker) &#123;</span><br><span class="line">Â  Â  Â  Â  maker.add(<span class="number">1</span>).add(<span class="number">1</span>).add(<span class="number">3</span>).multi(<span class="number">3</span>).sub(<span class="number">5</span>).divide(<span class="number">2</span>);</span><br><span class="line">Â  Â  &#125;];</span><br></pre></td></tr></table></figure>
<h4 id="åè®°">åè®°</h4><p>éå¸¸ç®€å•çš„ä»£ç ï¼Œåˆæ­¥çš„æ¥è§¦äº†ä¸‹é“¾å¼ç¼–ç¨‹ï¼Œæ„Ÿè§‰è¿™ç§ç¼–ç¨‹æ–¹å¼å¾ˆçˆ½ï¼Œåˆ†äº«ç»™å¤§å®¶ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h4 id="å‰è¨€">å‰è¨€</h4><p>æœ€è¿‘å­¦ä¹ äº†ä¸‹<a href="https://github.com/SnapKit/Masonry">masonry</a>çš„æºç ,çœ‹åˆ°æœ‰è®¸å¤šå¦‚</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">make</span><span class="class">.top</span><span class="class">.equalTo</span>(<span class="tag">self</span><span class="class">.mas_topLayoutGuide</span>);Â </span><br><span class="line"><span class="tag">make</span><span class="class">.left</span><span class="class">.equalTo</span>(<span class="tag">self</span><span class="class">.view</span>);</span><br><span class="line"><span class="tag">make</span><span class="class">.right</span><span class="class">.equalTo</span>(<span class="tag">self</span><span class="class">.view</span>);</span><br><span class="line"><span class="tag">make</span><span class="class">.height</span><span class="class">.equalTo</span>(<span class="at_rule">@<span class="keyword">40);</span></span></span><br></pre></td></tr></table></figure>
<p>è¿™æ ·çš„ä»£ç ï¼Œå¯¹è¿™ç§é“¾å¼çš„å†™æ³•å¾ˆæ„Ÿå…´è¶£ï¼Œæ‰€ä»¥å‡†å¤‡ç ”ç©¶ä¸€ä¸‹ï¼Œå­¦ä¹ å®ƒçš„ç¼–ç¨‹æ€æƒ³ã€‚</p>]]>
    
    </summary>
    
      <category term="ç¼–ç¨‹æ€æƒ³" scheme="http://v2panda.com/tags/%E7%BC%96%E7%A8%8B%E6%80%9D%E6%83%B3/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[iOSå¼€å‘Tips]]></title>
    <link href="http://v2panda.com/2015/07/27/iOS-develop-tips/"/>
    <id>http://v2panda.com/2015/07/27/iOS-develop-tips/</id>
    <published>2015-07-27T08:44:49.000Z</published>
    <updated>2015-12-13T08:04:35.000Z</updated>
    <content type="html"><![CDATA[<h3 id="ä»‹ç»">ä»‹ç»</h3><p>éšç€å¼€å‘çš„è¿›è¡Œï¼Œç”¨åˆ°çš„ä¸€äº›å°æŠ€å·§å’Œæ’ä»¶å·¥å…·ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚åœ¨è¿™é‡Œç»Ÿä¸€çš„æ€»ç»“ä¸€ä¸‹ï¼Œæ–¹ä¾¿æŸ¥é˜…ï¼Œæ—¶æ—¶æ›´æ–°ã€‚</p>
<a id="more"></a>
<h5 id="å°æŠ€å·§">å°æŠ€å·§</h5><ul>
<li>ä¸€ä¸ª GCC éå¸¸æ¨¡ç³Šçš„ç‰¹æ€§ï¼Œä»¥åŠ Clang ä¹Ÿæœ‰çš„ç‰¹æ€§æ˜¯ï¼Œä»£ç å—å¦‚æœåœ¨é—­åˆçš„åœ†æ‹¬å·å†…çš„è¯ï¼Œä¼šè¿”å›æœ€åè¯­å¥çš„å€¼ã€‚</li>
</ul>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSURL</span> *url = (&#123; </span><br><span class="line">    <span class="built_in">NSString</span> *urlString = [<span class="built_in">NSString</span> stringWithFormat:<span class="string">@"%@/%@"</span>, baseURLString, endpoint]; </span><br><span class="line">    [<span class="built_in">NSURL</span> URLWithString:urlString];</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>è¿™ä¸ªç‰¹æ€§éå¸¸é€‚åˆç»„ç»‡å°å—çš„ä»£ç ï¼Œé€šå¸¸æ˜¯è®¾ç½®ä¸€ä¸ªç±»ã€‚ç»™å‡ºä¸€ä¸ªé‡è¦çš„å…¥å£å¹¶ä¸”å‡å°‘ç›¸å…³å¹²æ‰°ï¼Œèƒ½è®©ä»£ç èšç„¦äºå…³é”®çš„å˜é‡å’Œå‡½æ•°ä¸­ã€‚æ­¤å¤–ï¼Œè¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªä¼˜ç‚¹ï¼Œæ‰€æœ‰çš„å˜é‡éƒ½åœ¨ä»£ç å—ä¸­ï¼Œä¹Ÿå°±æ˜¯åªåœ¨ä»£ç å—çš„åŒºåŸŸä¸­æœ‰æ•ˆï¼Œè¿™æ„å‘³ç€å¯ä»¥å‡å°‘å¯¹å…¶ä»–ä½œç”¨åŸŸçš„å‘½åæ±¡æŸ“ã€‚</p>
<ul>
<li><p>åœ¨ Block å†…å¦‚æœéœ€è¦è®¿é—® self çš„æ–¹æ³•ã€å˜é‡ï¼Œå»ºè®®ä½¿ç”¨ weakSelfã€‚</p>
<p>å¦‚æœåœ¨ Block å†…éœ€è¦å¤šæ¬¡ è®¿é—® selfï¼Œåˆ™éœ€è¦ä½¿ç”¨ strongSelfã€‚</p>
</li>
</ul>
<figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">__weak __typeof__<span class="list">(<span class="keyword">self</span>)</span> weakSelf = self<span class="comment">;</span></span><br><span class="line"> dispatch_async<span class="list">(<span class="keyword">dispatch_get_global_queue</span><span class="list">(<span class="keyword">DISPATCH_QUEUE_PRIORITY_DEFAULT</span>, <span class="number">0</span>)</span>, ^&#123;</span><br><span class="line">    __strong __typeof<span class="list">(<span class="keyword">self</span>)</span> strongSelf = weakSelf<span class="comment">;</span></span><br><span class="line">    if <span class="list">(<span class="keyword">strongSelf</span>)</span> &#123; </span><br><span class="line">     [strongSelf doSomething]<span class="comment">; </span></span><br><span class="line">     [strongSelf doSomethingElse]<span class="comment">; </span></span><br><span class="line">    &#125; else &#123; </span><br><span class="line">     // Probably nothing... return<span class="comment">; </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>åœ¨ doSomething ä¸­ï¼ŒweakSelf ä¸ä¼šå˜æˆ nilï¼Œä¸è¿‡åœ¨ doSomething æ‰§è¡Œå®Œæˆï¼Œè°ƒç”¨ç¬¬äºŒä¸ªæ–¹æ³• doOtherThing çš„æ—¶å€™ï¼ŒweakSelf æœ‰å¯èƒ½è¢«é‡Šæ”¾ã€‚å³åœ¨æ²¡æœ‰å¾ªç¯å¼•ç”¨çš„æ—¶å€™ï¼Œblock æ˜¯å¦è¢« retain æˆ–è€…æ˜¯ä¸€ä¸ªå±æ€§éƒ½æ²¡å…³ç³»ã€‚å¦‚æœ block è¢«ä¼ é€’æˆ–è€… copy äº†ï¼Œåœ¨æ‰§è¡Œçš„æ—¶å€™ï¼ŒweakSelf å¯èƒ½ä¼šå˜æˆ nilã€‚äºæ˜¯ï¼ŒstrongSelf å°±æ´¾ä¸Šç”¨åœºäº†,è€Œ__strongç¡®ä¿åœ¨ Block å†…ï¼ŒstrongSelf ä¸ä¼šè¢«é‡Šæ”¾ã€‚</p>
<h5 id="Xcodeæ’ä»¶">Xcodeæ’ä»¶</h5><p>1.<a href="https://github.com/omz/ColorSense-for-Xcode" target="_blank" rel="external">ColorSense for Xcode</a> - ç”¨UIColoræˆ–è€… NSColorçš„æ–¹æ³•ä¼šå¼¹å‡ºè‰²ç›˜å’Œé¢œè‰²è§’æ ‡ï¼Œèµï¼</p>
<p>2.<a href="https://github.com/markohlebar/Peckham" target="_blank" rel="external">Peckham</a> - èƒ½ååˆ†æ–¹ä¾¿çš„åœ¨ä»£ç ä¸­å¼•å…¥å¤´æ–‡ä»¶,æ”¯æŒæ¨¡ç³Šæœç´¢ï¼Œå¿«æ·é”®control+command+pã€‚</p>
<p>3.<a href="https://github.com/stefanceriu/SCXcodeMiniMap" target="_blank" rel="external">SCXcodeMinimap</a> - å¯ä»¥å†ä»£ç ä¾§é¢æ·»åŠ ä¸€ä¸ªå°åœ°å›¾ï¼Œæ–¹ä¾¿æœç´¢çš„æ—¶å€™å¿«é€Ÿå®šä½ï¼Œå¿«æ·é”®control+shift+mã€‚</p>
<p>4.<a href="https://github.com/trawor/XToDo" target="_blank" rel="external">XToDo</a> - å¿«é€Ÿæ·»åŠ todo list(view -&gt;snippets),ä¸”èƒ½ç²¾ç¡®æŸ¥æ‰¾todoï¼Œå¿«æ·é”®control+tã€‚</p>
<p>5.<a href="https://github.com/onevcat/VVDocumenter-Xcode" target="_blank" rel="external">VVDocumenter</a> - å¿«é€Ÿæ³¨é‡Šï¼Œå¿«æ·é”®///ã€‚</p>
<p>6.<a href="https://github.com/ksuther/KSImageNamed-Xcode" target="_blank" rel="external">KSImageNamed</a> - è‡ªåŠ¨åœ¨ imageNamed:æ–¹æ³•åé¢åˆ—å‡ºé¡¹ç›®é‡Œæ‰€æœ‰çš„æ–‡ä»¶åï¼Œå¸¦ç¼©ç•¥å›¾ã€‚</p>
<p>7.<a href="https://github.com/holtwick/HOStringSense-for-Xcode" target="_blank" rel="external">HOStringSense</a> - æ ¼å¼åŒ–å­—ç¬¦ä¸²ï¼Œæ–¹ä¾¿å¥½ç”¨ã€‚</p>
<p>8.<a href="https://github.com/FuzzyAutocomplete/FuzzyAutocompletePlugin" target="_blank" rel="external">FuzzyAutocompletePlugin</a> - æ–¹æ³•åæ¨¡ç³ŠåŒ¹é…ï¼Œæé«˜æ•ˆç‡çš„å¥½å·¥å…·ã€‚</p>
<p>9.<a href="https://github.com/travisjeffery/ClangFormat-Xcode" target="_blank" rel="external">ClangFormat-Xcode</a> - ä¸€é”®æ ¼å¼åŒ–ä»£ç ã€‚</p>
<h5 id="å‡ ç§å¤„ç†JSONçš„å·¥å…·orç½‘ç«™">å‡ ç§å¤„ç†JSONçš„å·¥å…·orç½‘ç«™</h5><p><a href="http://www.bejson.com/" target="_blank" rel="external">JSONæ ¡éªŒ</a></p>
<p><a href="http://www.runoob.com/tool/json/index.html" target="_blank" rel="external">JSONæ ¼å¼åŒ–å·¥å…·</a></p>
<p><a href="http://www.jsoneditoronline.org/" target="_blank" rel="external">json editor online</a></p>
<h5 id="å›¾ç‰‡å‹ç¼©">å›¾ç‰‡å‹ç¼©</h5><p><a href="https://tinypng.com/" target="_blank" rel="external">tinypng</a> - æ— æŸå‹ç¼©ï¼Œé«˜æ•ˆå¥½ç”¨ã€‚</p>
<h5 id="è°ƒè¯•æ¥å£">è°ƒè¯•æ¥å£</h5><p>Postman(chromeæ’ä»¶ - è§å›¾)</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/20150727/a.png" alt="Postman"></p>
<h5 id="æ³¨é‡Š">æ³¨é‡Š</h5><p>å‡ ç§å¸¸ç”¨çš„æ³¨é‡Šæ ·å¼ï¼š</p>
<p>1.</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span> ,<span class="keyword">strong</span>) RHBankCard *bankCard;<span class="comment">/**&lt;é“¶è¡Œå¡ä¿¡æ¯*/</span></span><br><span class="line"><span class="keyword">@property</span> (<span class="keyword">nonatomic</span> ,<span class="keyword">strong</span>) RHBankCard *bankCard;<span class="comment">///&lt;é“¶è¡Œå¡ä¿¡æ¯</span></span><br></pre></td></tr></table></figure>
<p>2.</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span>é“¶è¡Œå¡ä¿¡æ¯<span class="keyword">*</span>/</span><br><span class="line"><span class="comment">@property (nonatomic ,strong) RHBankCard *bankCard;</span></span><br></pre></td></tr></table></figure>
<p>3.</p>
<figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">typedef <span class="class"><span class="keyword">enum</span></span></span><br><span class="line">&#123;</span><br><span class="line"> <span class="constant">ShareTypeSinaWeibo</span> = <span class="number">1</span>, Â  Â  Â  Â  <span class="regexp">/**&lt; æ–°æµªå¾®åš */</span></span><br><span class="line"> <span class="constant">ShareTypeTencentWeibo</span> = <span class="number">2</span>,Â  Â  Â  <span class="regexp">/**&lt; è…¾è®¯å¾®åš */</span></span><br><span class="line"> <span class="constant">ShareTypeDouBan</span> = <span class="number">5</span>,Â  Â  Â  Â  Â  Â  <span class="regexp">/**&lt; è±†ç“£ç¤¾åŒº */</span></span><br><span class="line"> <span class="constant">ShareTypeQQSpace</span> = <span class="number">6</span>, Â  Â  Â  Â  Â  <span class="regexp">/**&lt; QQç©ºé—´ */</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="constant">ShareType</span>;</span><br></pre></td></tr></table></figure>
<p>4.</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span><span class="keyword">*</span></span><br><span class="line">Â <span class="keyword">*</span>Â  initWithStyle</span><br><span class="line">Â <span class="keyword">*</span></span><br><span class="line">Â <span class="keyword">*</span>Â  <span class="comment">@param style Â  Â  Â  Â  Â  style description</span></span><br><span class="line">Â <span class="keyword">*</span>Â  <span class="comment">@param reuseIdentifier reuseIdentifier description</span></span><br><span class="line">Â <span class="keyword">*</span></span><br><span class="line">Â <span class="keyword">*</span>Â  <span class="comment">@return self</span></span><br><span class="line">Â <span class="keyword">*</span>/</span><br><span class="line">- (id)initWithStyle:(UITableViewCellStyle)style reuseIdentifier:(NSString <span class="keyword">*</span>)reuseIdentifier;</span><br></pre></td></tr></table></figure>
<p>å‰ä¸¤ç§æ³¨é‡Šæ–¹å¼å¯ä»¥è‡ªç”±é€‰æ‹©ï¼Œè®©ä»£ç æ›´ç¾è§‚ã€‚ç¬¬ä¸‰ç§æ˜¯ç”¨åœ¨enumç±»å‹ï¼Œç¬¬å››ç§ç”¨çš„æ˜¯å–µç¥çš„<a href="https://github.com/onevcat/VVDocumenter-Xcode" target="_blank" rel="external">VVDocumenter</a>æ’ä»¶ï¼Œé€‚ç”¨äºparamå¤šçš„æ–¹æ³•ã€‚</p>
<h5 id="æ­£ç¡®åœ°å®šä¹‰å¸¸é‡">æ­£ç¡®åœ°å®šä¹‰å¸¸é‡</h5><p>ä»¥å‰å®šä¹‰å¸¸é‡éƒ½æ˜¯ç”¨çš„#defineï¼Œå¾ˆç®€å•ä¹Ÿæ–¹ä¾¿ï¼Œä»æ²¡æƒ³è¿‡å¯èƒ½å‡ºç°çš„é—®é¢˜ã€‚ä¸€èˆ¬è¿™ä¹ˆå®šä¹‰ï¼š</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="hexcolor">#def</span>ine ANIMATION_DURATION_SHORT <span class="number">0.3</span></span><br><span class="line"><span class="hexcolor">#def</span>ine ANIMATION_DURATION_MIDDLE <span class="number">0.6</span></span><br><span class="line"><span class="hexcolor">#def</span>ine ANIMATION_DURATION_LONG <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<p>è¿™æ®µä»£ç æ˜¯ä¸æ˜¯çœ‹èµ·æ¥å¾ˆç†Ÿæ‚‰ï¼Œåœ¨å¼€å‘ä¸­ä¹Ÿä¼šç»å¸¸ç”¨åˆ°ã€‚é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼Œå®å®šä¹‰åªæ˜¯ç®€å•åœ°æ›¿æ¢ï¼Œå³å°†ä¸€åˆ‡å®å®šä¹‰æ›¿æ¢æˆå®šä¹‰åé¢çš„å†…å®¹ï¼Œæ‰€ä»¥</p>
<ul>
<li>å®å®šä¹‰ä¸ä¼šæ£€æŸ¥æ›¿æ¢çš„â€œ<strong>ç±»å‹</strong>â€ï¼Œåªè¦é‡åˆ°ï¼Œå°±åšæ›¿æ¢ã€‚</li>
<li>å®å®šä¹‰ä¸ä¿è¯â€œ<strong>ä¸å¯å˜</strong>â€ï¼Œå› ä¸ºå¯ä»¥<strong>é‡å¤å®šä¹‰</strong>ï¼Œä¸èƒ½ä¿è¯å€¼ä¸å˜ã€‚</li>
</ul>
<p>æ‰€ä»¥ï¼Œæ°å½“çš„å¸¸é‡åº”è¯¥å…·å¤‡åˆé€‚çš„åå­—ã€æ­£ç¡®çš„ç±»å‹ï¼Œè¿˜æœ‰constã€externç­‰å…³é”®å­—çš„ä¿®é¥°ã€‚ä¾‹ï¼š</p>
<figure class="highlight cpp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åŠ¨ç”»æ—¶é—´é•¿åº¦å¸¸é‡ </span></span><br><span class="line"><span class="keyword">static</span> <span class="keyword">const</span> NSTimeInterval kAnimationDurationLong = <span class="number">1.0f</span>;</span><br></pre></td></tr></table></figure>
<p>é¦–å…ˆåŠ staticï¼Œé™å®šåœ¨æœ¬æ–‡ä»¶ä¸­ä½¿ç”¨ï¼Œç¡®ä¿ä¸ä¸å…¶ä»–çš„å¸¸é‡å†²çªï¼Œå…¶æ¬¡åŠ constç¡®ä¿å¸¸é‡ä¸è¢«æ”¹å˜ã€‚è‹¥è¦å®šä¹‰ä¸€ä¸ªå…¨å±€å˜é‡ï¼Œåˆ™åœ¨.hæ–‡ä»¶ä¸­ç”¨externå£°æ˜ï¼Œåœ¨.mä¸­å®šä¹‰ï¼Œè¿™æ ·:</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//.h</span></span><br><span class="line"><span class="keyword">extern</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> PDUserInfoNotification;</span><br><span class="line"><span class="comment">//.m</span></span><br><span class="line"><span class="built_in">NSString</span> * <span class="keyword">const</span> PDUserInfoNotification = <span class="string">@"PDUserInfoNotification"</span>;</span><br></pre></td></tr></table></figure>
<p>å…³äºè¿™ç‚¹ï¼Œæ›´è¯¦ç»†çš„å¯ä»¥çœ‹<a href="http://tutuge.me/2015/03/11/Effective-Objective-C-è¯»ä¹¦ç¬”è®°-Item-4-å¦‚ä½•æ­£ç¡®å®šä¹‰å¸¸é‡/" target="_blank" rel="external">è¿™é‡Œ</a>ã€‚</p>
<h5 id="CGRectå‡½æ•°">CGRectå‡½æ•°</h5><p>å½“è®¿é—®CGRecté‡Œçš„x, y, width, æˆ– heightæ—¶ï¼Œåº”è¯¥ä½¿ç”¨<a href="http://developer.apple.com/library/ios/#documentation/graphicsimaging/reference/CGGeometry/Reference/reference.html" target="_blank" rel="external">CGGeometryå‡½æ•°</a>è€Œä¸æ˜¯ç›´æ¥é€šè¿‡ç»“æ„ä½“æ¥è®¿é—®ã€‚å¼•ç”¨Appleçš„CGGeometry:åœ¨è¿™ä¸ªå‚è€ƒæ–‡æ¡£ä¸­æ‰€æœ‰çš„å‡½æ•°ï¼Œæ¥å—CGRectç»“æ„ä½“ä½œä¸ºè¾“å…¥ï¼Œåœ¨è®¡ç®—å®ƒä»¬ç»“æœæ—¶éšå¼åœ°æ ‡å‡†åŒ–è¿™äº›rectanglesã€‚å› æ­¤ï¼Œä½ çš„åº”ç”¨ç¨‹åºåº”è¯¥é¿å…ç›´æ¥è®¿é—®å’Œä¿®æ”¹ä¿å­˜åœ¨CGRectæ•°æ®ç»“æ„ä¸­çš„æ•°æ®ã€‚ç›¸åï¼Œä½¿ç”¨è¿™äº›å‡½æ•°æ¥æ“çºµrectangleså’Œè·å–å®ƒä»¬çš„ç‰¹æ€§ã€‚</p>
<p><strong>åº”è¯¥:</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGRect</span> frame = <span class="keyword">self</span><span class="variable">.view</span><span class="variable">.frame</span>;</span><br><span class="line"><span class="built_in">CGFloat</span> x = <span class="built_in">CGRectGetMinX</span>(frame);</span><br><span class="line"><span class="built_in">CGFloat</span> y = <span class="built_in">CGRectGetMinY</span>(frame);</span><br><span class="line"><span class="built_in">CGFloat</span> width = <span class="built_in">CGRectGetWidth</span>(frame);</span><br><span class="line"><span class="built_in">CGFloat</span> height = <span class="built_in">CGRectGetHeight</span>(frame);</span><br><span class="line"><span class="built_in">CGRect</span> frame = <span class="built_in">CGRectMake</span>(<span class="number">0.0</span>, <span class="number">0.0</span>, width, height);</span><br></pre></td></tr></table></figure>
<p><strong>ä¸åº”è¯¥:</strong></p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">CGRect</span> frame = <span class="keyword">self</span><span class="variable">.view</span><span class="variable">.frame</span>;</span><br><span class="line"><span class="built_in">CGFloat</span> x = frame<span class="variable">.origin</span><span class="variable">.x</span>;</span><br><span class="line"><span class="built_in">CGFloat</span> y = frame<span class="variable">.origin</span><span class="variable">.y</span>;</span><br><span class="line"><span class="built_in">CGFloat</span> width = frame<span class="variable">.size</span><span class="variable">.width</span>;</span><br><span class="line"><span class="built_in">CGFloat</span> height = frame<span class="variable">.size</span><span class="variable">.height</span>;</span><br><span class="line"><span class="built_in">CGRect</span> frame = (<span class="built_in">CGRect</span>)&#123; <span class="variable">.origin</span> = <span class="built_in">CGPointZero</span>, <span class="variable">.size</span> = frame<span class="variable">.size</span> &#125;;</span><br></pre></td></tr></table></figure>
<hr>
<p><a href="https://github.com/samlaudev/Objective-C-Coding-Style#é»„é‡‘è·¯å¾„" target="_blank" rel="external"></a></p>
<h5 id="é»„é‡‘è·¯å¾„">é»„é‡‘è·¯å¾„</h5><p>å½“ä½¿ç”¨æ¡ä»¶è¯­å¥ç¼–ç æ—¶ï¼Œå·¦æ‰‹è¾¹çš„ä»£ç åº”è¯¥æ˜¯â€goldenâ€ æˆ– â€œhappyâ€è·¯å¾„ã€‚ä¹Ÿå°±æ˜¯ä¸è¦åµŒå¥—if</p>
<p>è¯­å¥ï¼Œå¤šä¸ªè¿”å›è¯­å¥ä¹Ÿæ˜¯OKã€‚</p>
<p><strong>åº”è¯¥:</strong></p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">- (<span class="keyword">void</span>)someMethod &#123; </span><br><span class="line">  <span class="keyword">if</span> (![someOther boolValue])</span><br><span class="line">   &#123; </span><br><span class="line">        <span class="keyword">return</span>; </span><br><span class="line">   &#125; </span><br><span class="line">  <span class="comment">//Do something important</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>ä¸åº”è¯¥:</strong></p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">-</span> (void)<span class="tag">someMethod</span> &#123;</span><br><span class="line"> <span class="tag">if</span> ([someOther boolValue]) </span><br><span class="line">   &#123; </span><br><span class="line">    <span class="comment">//Do something important</span></span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>æ›´å¤šçš„å¯ä»¥æŸ¥çœ‹<a href="https://github.com/futurice/ios-good-practices" target="_blank" rel="external">iOS-Good-Practices</a>ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="ä»‹ç»">ä»‹ç»</h3><p>éšç€å¼€å‘çš„è¿›è¡Œï¼Œç”¨åˆ°çš„ä¸€äº›å°æŠ€å·§å’Œæ’ä»¶å·¥å…·ä¹Ÿè¶Šæ¥è¶Šå¤šã€‚åœ¨è¿™é‡Œç»Ÿä¸€çš„æ€»ç»“ä¸€ä¸‹ï¼Œæ–¹ä¾¿æŸ¥é˜…ï¼Œæ—¶æ—¶æ›´æ–°ã€‚</p>]]>
    
    </summary>
    
      <category term="iOS" scheme="http://v2panda.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[iOSå¤šè¯­è¨€è®¾ç½®]]></title>
    <link href="http://v2panda.com/2015/03/23/app-language-setting/"/>
    <id>http://v2panda.com/2015/03/23/app-language-setting/</id>
    <published>2015-03-23T03:47:00.000Z</published>
    <updated>2015-12-15T07:16:35.000Z</updated>
    <content type="html"><![CDATA[<p>æœ€è¿‘ä¸ºè‡ªå·±å†™çš„ä¸€ä¸ªåº”ç”¨ï¼Œåšäº†å¤šè¯­è¨€æ”¯æŒ(English&amp;Chinese)ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸‹æ¥ã€‚</p>
<a id="more"></a>
<h3 id="åŸºæœ¬è®¾ç½®">åŸºæœ¬è®¾ç½®</h3><p>ç¬¬ä¸€æ­¥ï¼šå…ˆåœ¨Projectçš„infoé‡Œæ·»åŠ æ‰€éœ€è¦æ”¯æŒçš„è¯­è¨€ï¼Œè¿™é‡Œé€‰æ‹©çš„æ˜¯Chinese(Simplified)å’ŒEnglish-Development Languageã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/language1.png" alt=""><br>ç¬¬äºŒæ­¥ï¼šåˆ›å»ºLocalizable.stringsæ–‡ä»¶(æ³¨æ„:æ–‡ä»¶åæœ€å¥½ä¸è¦éšæ„æ›´æ”¹)ä½œä¸ºå¤šè¯­è¨€å¯¹åº”çš„è¯å…¸ï¼Œå­˜å‚¨å¤šç§è¯­è¨€ã€‚</p>
<p>ç‚¹å‡»Localizable.stringsæ–‡ä»¶å³ä¾§Localizeâ€¦</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/language2.png" alt="">         </p>
<p>ç»§ç»­åœ¨Localizationé‡Œæ·»åŠ æ‰€è¦æ”¯æŒçš„è¯­è¨€ï¼Œå°†å…¶å‹¾é€‰ä¸Šã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/language3.png" alt=""></p>
<p>ç¬¬ä¸‰æ­¥:æœ€åå°±å¯ä»¥åœ¨Localizable.stringsé‡Œéšæ„è®¾ç½®æ‰€éœ€è¦æ”¯æŒçš„è¯­è¨€å•¦ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/language4.png" alt=""></p>
<h4 id="æ ¼å¼">æ ¼å¼</h4><p>Localizable.stringså†…è®¾ç½®æ ¼å¼: </p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"testName"</span> = <span class="string">"æµ‹è¯•åç§°"</span></span><br></pre></td></tr></table></figure>
<p>NSLocalizedStringä»£æ›¿String:</p>
<figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">NSLocalizedString</span><span class="params">(@<span class="string">"testName"</span>,nil)</span></span></span><br></pre></td></tr></table></figure>
<h3 id="StoryBoardè®¾ç½®">StoryBoardè®¾ç½®</h3><p>storyboardåŒLocalizable.stringsç±»ä¼¼ã€‚</p>
<p>ç¬¬ä¸€æ­¥ï¼šé€‰ä¸­storyboardï¼Œé€‰æ‹©ShowtheFileInspectorï¼Œåœ¨Localizationé€‰æ‹©æ‰€éœ€è¦æ”¯æŒçš„è¯­è¨€ã€‚</p>
<p>ç¬¬äºŒæ­¥ï¼šåœ¨Main.strings(Chinese(Simplified))å’ŒMain.strings(English)é‡Œè®¾ç½®è¯­è¨€ã€‚</p>
<h4 id="æ ¼å¼-1">æ ¼å¼</h4><p>Main.stringsé‡Œçš„æ ¼å¼æ¯”è¾ƒç‰¹æ®Šï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<figure class="highlight gherkin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">*</span> Class = <span class="string">"UILabel"</span>; text = <span class="string">"testName"</span>; ObjectID = <span class="string">"pUp-yc-27W"</span>; <span class="keyword">*</span>/</span><br><span class="line"><span class="string">"pUp-yc-27W.text"</span> = <span class="string">"testName"</span>;</span><br></pre></td></tr></table></figure>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œä¸è¦ç›´æ¥æ”¹å˜è‡ªåŠ¨ç”Ÿæˆçš„ObjectIDï¼Œä¹Ÿä¸è¦å¤åˆ¶å’Œç²˜è´´ä¸Šè¾¹çš„ä»£ç è¡Œï¼Œå› ä¸ºæ ‡ç­¾çš„ObjectIDå¯èƒ½å·²ç»è·Ÿä¸Šè¾¹å±•ç¤ºçš„ä¸ä¸€æ ·äº†ã€‚</p>
<h3 id="å›¾ç‰‡è®¾ç½®">å›¾ç‰‡è®¾ç½®</h3><p>å›¾ç‰‡è®¾ç½®ä¹Ÿå’ŒLocalizable.stringsç±»ä¼¼ï¼Œå›¾ç‰‡èµ„æºå­˜æ”¾åœ¨Images.xcassetsé‡Œï¼Œä½¿ç”¨æ—¶å°†ä¸åŒè¯­è¨€çš„å›¾ç‰‡èµ„æºåœ¨Localizable.stringsé‡Œä¸€ä¸€å¯¹åº”è®¾ç½®ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>Localizable.strings (English)</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"imageName"</span> = <span class="string">"pic-en"</span>;</span><br></pre></td></tr></table></figure>
<p>Localizable.strings (Chinese(Simplified))</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"imageName"</span> = <span class="string">"pic-cn"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="è´§å¸å€¼è®¾ç½®">è´§å¸å€¼è®¾ç½®</h3><p>è´§å¸æ˜¾ç¤ºåœ¨ä¸åŒçš„å›½å®¶æ˜¯æœ‰åŒºåˆ«çš„ï¼Œä¾‹å¦‚ï¼š10000å¯ä»¥å†™ä½œâ€10,000â€ä¹Ÿèƒ½å†™ä½œâ€10.000â€ã€‚é’ˆå¯¹è¿™ç§æƒ…å†µå¯ä»¥ä½¿ç”¨NSNumberFormatteræ ¼å¼åŒ–ï¼Œä¾‹å¦‚ï¼š</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSNumberFormatter</span> *numberFormatter = [[<span class="built_in">NSNumberFormatter</span> alloc] init]; </span><br><span class="line">[numberFormatter setNumberStyle:<span class="built_in">NSNumberFormatterDecimalStyle</span>]; </span><br><span class="line"><span class="built_in">NSString</span> *numberString = [numberFormatter stringFromNumber:@(<span class="number">10000</span>)]; </span><br><span class="line">testLabel<span class="variable">.text</span> = [<span class="built_in">NSString</span> stringWithFormat:<span class="built_in">NSLocalizedString</span>(<span class="string">@"testNum:%@"</span>, <span class="literal">nil</span>), numberString];</span><br></pre></td></tr></table></figure>
<h3 id="åº”ç”¨åè®¾ç½®">åº”ç”¨åè®¾ç½®</h3><p>Info.plistæœ‰ä¸€ä¸ªç‰¹æ®Šçš„æ–‡ä»¶ï¼ˆInfoPlist.stringsï¼‰ï¼Œåœ¨é‡Œè¾¹ç”¨å­—ç¬¦ä¸²è¦†ç›–å…¶ä»–è¯­è¨€,å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<p>InfoPlist.strings (English)</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"CFBundleDisplayName"</span> = <span class="string">"EnglishName"</span>;</span><br></pre></td></tr></table></figure>
<p>InfoPlist.strings (Chinese(Simplified))</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"imageName"</span> = <span class="string">"ä¸­æ–‡å"</span>;</span><br></pre></td></tr></table></figure>
]]></content>
    <summary type="html">
    <![CDATA[<p>æœ€è¿‘ä¸ºè‡ªå·±å†™çš„ä¸€ä¸ªåº”ç”¨ï¼Œåšäº†å¤šè¯­è¨€æ”¯æŒ(English&amp;Chinese)ï¼Œåœ¨è¿™é‡Œè®°å½•ä¸‹æ¥ã€‚</p>]]>
    
    </summary>
    
  </entry>
  
  <entry>
    <title><![CDATA[ä½¿ç”¨KeyChainå­˜å‚¨å¯†ç ]]></title>
    <link href="http://v2panda.com/2015/01/07/iOS-keychain/"/>
    <id>http://v2panda.com/2015/01/07/iOS-keychain/</id>
    <published>2015-01-07T09:54:07.000Z</published>
    <updated>2016-03-24T12:41:17.000Z</updated>
    <content type="html"><![CDATA[<p>Tips:åœ¨å®ä¹ è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªéœ€æ±‚æ˜¯å®ç°Appçš„ä¸ƒå¤©å…ç™»é™†ã€‚å½“æ—¶çš„æƒ³æ³•æ˜¯ç”¨NSUserDefaultså­˜å‚¨ï¼Œç”¨NSDateåˆ¤æ–­æ—¶é—´ï¼Œå–ä¸ƒå¤©çš„é—´éš”åˆ¤æ–­ç™»é™†çŠ¶æ€ã€‚ç°åœ¨æƒ³æƒ³ç”¨NSUserDefaultsç›´æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯æ˜¯éå¸¸ä¸å®‰å…¨çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨NSUserDefaultså­˜å‚¨æ•°æ®ä¿¡æ¯ï¼Œä½†æ˜¯å¯¹äºä¸€äº›ç§å¯†ä¿¡æ¯ï¼Œæ¯”å¦‚è´¦å·ã€å¯†ç ç­‰ç­‰ï¼Œå°±éœ€è¦ä½¿ç”¨æ›´ä¸ºå®‰å…¨çš„KeyChainäº†ã€‚è€ŒKeyChainçš„ä¿¡æ¯æ˜¯å­˜åœ¨äºæ¯ä¸ªåº”ç”¨ï¼ˆappï¼‰çš„æ²™ç›’ä¹‹å¤–çš„ï¼Œæ‰€ä»¥KeyChainé‡Œä¿å­˜çš„ä¿¡æ¯ä¸ä¼šå› Appè¢«åˆ é™¤è€Œä¸¢å¤±ï¼Œåœ¨ç”¨æˆ·é‡æ–°å®‰è£…Appåä¾ç„¶æœ‰æ•ˆï¼Œæ•°æ®è¿˜åœ¨ã€‚</p>
 <a id="more"></a>
<hr>
<p>2016.3.23æœ€æ–°æ›´æ–°<br>è¿‘æœŸé¡¹ç›®ä¸­åˆç”¨åˆ°keychainï¼Œäºæ˜¯å›å¤´ç¿»äº†ç¿»ä»¥å‰å†™çš„ä»£ç ï¼Œæ„Ÿè§‰å†™çš„/(ã„’oã„’)/~~<br>è®¾è®¡ä¸ç§‘å­¦ï¼Œå‘½åä¸è§„èŒƒï¼Œæ€ä¹ˆçœ‹æ€ä¹ˆåˆ«æ‰­ï¼Œé‚£å°±é‡å†™å§~</p>
<h3 id="KeyChain">KeyChain</h3><p>è¯ä¸å¤šè¯´ï¼Œå’±ä»¬ç›´æ¥æ¥çœ‹æ€ä¹ˆå¿«é€Ÿé›†æˆKeyChainã€‚</p>
<ol>
<li>è‡ªå®šä¹‰ä¸€ä¸ªç±»ï¼Œå–åXXXKeyChainï¼Œå¦‚ä¸‹ï¼š</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Security/Security.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#define KEY_PASSWORD  @<span class="title">"com.rry.app.password"</span></span></span><br><span class="line"><span class="preprocessor">#define KEY_USERNAME_PASSWORD  @<span class="title">"com.rry.app.usernamepassword"</span></span></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RRYKeyChain</span> : <span class="title">NSObject</span></span></span><br><span class="line">+ (<span class="keyword">void</span>)save:(<span class="built_in">NSString</span> *)service data:(<span class="keyword">id</span>)data;</span><br><span class="line">+ (<span class="keyword">id</span>)load:(<span class="built_in">NSString</span> *)service;</span><br><span class="line">+ (<span class="keyword">void</span>)delete:(<span class="built_in">NSString</span> *)service;</span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šä»£ç è‡ªå®šä¹‰äº†ä¸‰ä¸ªæ–¹æ³•ï¼Œå­˜ã€å–ã€åˆ ã€‚å¹¶ä¸”å®šä¹‰äº†å‡ ä¸ªå­—ç¬¦ä¸²ç”¨æ¥åškeyã€‚å½“ç„¶ï¼Œæƒ³ä½¿ç”¨keychainè¯·ä¸è¦å¿˜è®°å¼•å…¥SecurityåŒ…ï¼Œå¼•å…¥æ–‡ä»¶ <code>#import&lt;Security/Security.h&gt;</code>ã€‚ </p>
<ol>
<li>å†æ¥çœ‹.mæ–‡ä»¶çš„å…·ä½“å®ç°</li>
</ol>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">"RRYKeyChain.h"</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@implementation</span> <span class="title">RRYKeyChain</span></span></span><br><span class="line">+ (<span class="built_in">NSMutableDictionary</span> *)getKeychainQuery:(<span class="built_in">NSString</span> *)service &#123;</span><br><span class="line">    <span class="keyword">return</span> [<span class="built_in">NSMutableDictionary</span> dictionaryWithObjectsAndKeys:</span><br><span class="line">            (<span class="keyword">id</span>)kSecClassGenericPassword,(<span class="keyword">id</span>)kSecClass,</span><br><span class="line">            service, (<span class="keyword">id</span>)kSecAttrService,</span><br><span class="line">            service, (<span class="keyword">id</span>)kSecAttrAccount,</span><br><span class="line">            (<span class="keyword">id</span>)kSecAttrAccessibleAfterFirstUnlock,(<span class="keyword">id</span>)kSecAttrAccessible,</span><br><span class="line">            <span class="literal">nil</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)save:(<span class="built_in">NSString</span> *)service data:(<span class="keyword">id</span>)data &#123;</span><br><span class="line">    <span class="comment">//Get search dictionary</span></span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *keychainQuery = [<span class="keyword">self</span> getKeychainQuery:service];</span><br><span class="line">    <span class="comment">//Delete old item before add new item</span></span><br><span class="line">    SecItemDelete((<span class="built_in">CFDictionaryRef</span>)keychainQuery);</span><br><span class="line">    <span class="comment">//Add new object to search dictionary(Attention:the data format)</span></span><br><span class="line">    [keychainQuery setObject:[<span class="built_in">NSKeyedArchiver</span> archivedDataWithRootObject:data] forKey:(<span class="keyword">id</span>)kSecValueData];</span><br><span class="line">    <span class="comment">//Add item to keychain with the search dictionary</span></span><br><span class="line">    SecItemAdd((<span class="built_in">CFDictionaryRef</span>)keychainQuery, <span class="literal">NULL</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">id</span>)load:(<span class="built_in">NSString</span> *)service &#123;</span><br><span class="line">    <span class="keyword">id</span> ret = <span class="literal">nil</span>;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *keychainQuery = [<span class="keyword">self</span> getKeychainQuery:service];</span><br><span class="line">    <span class="comment">//Configure the search setting</span></span><br><span class="line">    <span class="comment">//Since in our simple case we are expecting only a single attribute to be returned (the password) we can set the attribute kSecReturnData to kCFBooleanTrue</span></span><br><span class="line">    [keychainQuery setObject:(<span class="keyword">id</span>)k<span class="built_in">CFBooleanTrue</span> forKey:(<span class="keyword">id</span>)kSecReturnData];</span><br><span class="line">    [keychainQuery setObject:(<span class="keyword">id</span>)kSecMatchLimitOne forKey:(<span class="keyword">id</span>)kSecMatchLimit];</span><br><span class="line">    <span class="built_in">CFDataRef</span> keyData = <span class="literal">NULL</span>;</span><br><span class="line">    <span class="keyword">if</span> (SecItemCopyMatching((<span class="built_in">CFDictionaryRef</span>)keychainQuery, (<span class="built_in">CFTypeRef</span> *)&amp;keyData) == noErr) &#123;</span><br><span class="line">        <span class="keyword">@try</span> &#123;</span><br><span class="line">            ret = [<span class="built_in">NSKeyedUnarchiver</span> unarchiveObjectWithData:(<span class="built_in">NSData</span> *)keyData];</span><br><span class="line">        &#125; <span class="keyword">@catch</span> (<span class="built_in">NSException</span> *e) &#123;</span><br><span class="line">            <span class="built_in">NSLog</span>(<span class="string">@"Unarchive of %@ failed: %@"</span>, service, e);</span><br><span class="line">        &#125; <span class="keyword">@finally</span> &#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (keyData)</span><br><span class="line">        <span class="built_in">CFRelease</span>(keyData);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)delete:(<span class="built_in">NSString</span> *)service &#123;</span><br><span class="line">    <span class="built_in">NSMutableDictionary</span> *keychainQuery = [<span class="keyword">self</span> getKeychainQuery:service];</span><br><span class="line">    SecItemDelete((<span class="built_in">CFDictionaryRef</span>)keychainQuery);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ç„¶åå°±æ˜¯å­˜ï¼Œå…¶ä¸­passwordæ˜¯è¦å­˜çš„å¯†ç å­—ç¬¦ä¸²ã€‚</p>
<figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">NSMutableDictionary *usernamepasswordKVPairs = [NSMutableDictionary dictionary];</span><br><span class="line">[usernamepasswordKVPairs <span class="string">setObject:</span>password <span class="string">forKey:</span>KEY_PASSWORD];</span><br><span class="line">[RRYKeyChain <span class="string">save:</span>KEY_USERNAME_PASSWORD <span class="string">data:</span>usernamepasswordKVPairs];</span><br></pre></td></tr></table></figure>
<p>å–</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">NSMutableDictionary</span> *usernamepasswordKVPairs = (<span class="built_in">NSMutableDictionary</span> *)[RRYKeyChain load:KEY_USERNAME_PASSWORD];</span><br><span class="line"></span><br><span class="line"><span class="built_in">NSLog</span>(<span class="string">@"%@"</span>,[usernamepasswordKVPairs objectForKey:KEY_PASSWORD]);</span><br></pre></td></tr></table></figure>
<p>åˆ </p>
<figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="title">[RRYKeyChain delete:KEY_USERNAME_PASSWORD]</span><span class="comment">;</span></span><br></pre></td></tr></table></figure>
<p>æå®šæ”¶å·¥ï¼Œä½¿ç”¨KeyChainå¿«é€Ÿå­˜å‚¨å¯†ç ã€‚</p>
<hr>
<p>2016.3.23æœ€æ–°æ›´æ–°</p>
<p>è¯ä¸å¤šè¯´ï¼Œç›´æ¥ä¸Šä»£ç ï¼Œé¦–å…ˆæ˜¯.h</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="preprocessor">#import <span class="title">&lt;Foundation/Foundation.h&gt;</span></span></span><br><span class="line"><span class="preprocessor">#import <span class="title">&lt;Security/Security.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">@interface</span> <span class="title">RHKeyChain</span> : <span class="title">NSObject</span></span></span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)rhKeyChainSave:(<span class="built_in">NSString</span> *)service;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSString</span> *)rhKeyChainLoad;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)rhKeyChainDelete:(<span class="built_in">NSString</span> *)service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">@end</span></span><br></pre></td></tr></table></figure>
<p>åªå¯¹å¤–æä¾›ä¸‰ä¸ªæ–¹æ³•ï¼Œå­˜ã€å–ã€åˆ ï¼Œå®ç°æ”¾åœ¨å†…éƒ¨ï¼Œå†æ˜¯.m</p>
<figure class="highlight objectivec"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> kRHDictionaryKey = <span class="string">@"com.xxxx.dictionaryKey"</span>;</span><br><span class="line"><span class="keyword">static</span> <span class="built_in">NSString</span> * <span class="keyword">const</span> kRHKeyChainKey = <span class="string">@"com.xxxx.keychainKey"</span>;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)rhKeyChainSave:(<span class="built_in">NSString</span> *)service &#123;</span><br><span class="line">Â  Â  <span class="built_in">NSMutableDictionary</span> *tempDic = [<span class="built_in">NSMutableDictionary</span> dictionary];</span><br><span class="line">Â  Â  [tempDic setObject:service forKey:kRHDictionaryKey];</span><br><span class="line">Â  Â  [<span class="keyword">self</span> save:kRHKeyChainKey data:tempDic];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="built_in">NSString</span> *)rhKeyChainLoad&#123;</span><br><span class="line">Â  Â  <span class="built_in">NSMutableDictionary</span> *tempDic = (<span class="built_in">NSMutableDictionary</span> *)[<span class="keyword">self</span> load:kRHKeyChainKey];</span><br><span class="line">Â  Â  <span class="keyword">return</span> [tempDic objectForKey:kRHDictionaryKey];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">+ (<span class="keyword">void</span>)rhKeyChainDelete&#123;</span><br><span class="line">Â  Â  [<span class="keyword">self</span> delete:kRHKeyChainKey];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ä¸‰ä¸ªæ–¹æ³•çš„å®ç°ã€‚</p>
]]></content>
    <summary type="html">
    <![CDATA[<p>Tips:åœ¨å®ä¹ è¿‡ç¨‹ä¸­ï¼Œæœ‰ä¸ªéœ€æ±‚æ˜¯å®ç°Appçš„ä¸ƒå¤©å…ç™»é™†ã€‚å½“æ—¶çš„æƒ³æ³•æ˜¯ç”¨NSUserDefaultså­˜å‚¨ï¼Œç”¨NSDateåˆ¤æ–­æ—¶é—´ï¼Œå–ä¸ƒå¤©çš„é—´éš”åˆ¤æ–­ç™»é™†çŠ¶æ€ã€‚ç°åœ¨æƒ³æƒ³ç”¨NSUserDefaultsç›´æ¥å­˜å‚¨ç”¨æˆ·ä¿¡æ¯æ˜¯éå¸¸ä¸å®‰å…¨çš„ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œå¯ä»¥ç”¨NSUserDefaultså­˜å‚¨æ•°æ®ä¿¡æ¯ï¼Œä½†æ˜¯å¯¹äºä¸€äº›ç§å¯†ä¿¡æ¯ï¼Œæ¯”å¦‚è´¦å·ã€å¯†ç ç­‰ç­‰ï¼Œå°±éœ€è¦ä½¿ç”¨æ›´ä¸ºå®‰å…¨çš„KeyChainäº†ã€‚è€ŒKeyChainçš„ä¿¡æ¯æ˜¯å­˜åœ¨äºæ¯ä¸ªåº”ç”¨ï¼ˆappï¼‰çš„æ²™ç›’ä¹‹å¤–çš„ï¼Œæ‰€ä»¥KeyChainé‡Œä¿å­˜çš„ä¿¡æ¯ä¸ä¼šå› Appè¢«åˆ é™¤è€Œä¸¢å¤±ï¼Œåœ¨ç”¨æˆ·é‡æ–°å®‰è£…Appåä¾ç„¶æœ‰æ•ˆï¼Œæ•°æ®è¿˜åœ¨ã€‚</p>]]>
    
    </summary>
    
      <category term="iOS" scheme="http://v2panda.com/tags/iOS/"/>
    
  </entry>
  
  <entry>
    <title><![CDATA[v2panda's blogçš„è¯ç”Ÿ]]></title>
    <link href="http://v2panda.com/2014/12/26/the-blog's%20birth/"/>
    <id>http://v2panda.com/2014/12/26/the-blog's birth/</id>
    <published>2014-12-26T03:28:11.000Z</published>
    <updated>2015-11-26T06:45:14.000Z</updated>
    <content type="html"><![CDATA[<h3 id="å‰è¨€">å‰è¨€</h3><p>è¿™æ˜¯æœ¬åšå®¢çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œç”¨æ¥è®°å½•è¿™ä¸ªç½‘ç«™çš„è¯ç”Ÿè¿‡ç¨‹ã€‚</p>
<a id="more"></a>
<h3 id="ç¯å¢ƒ">ç¯å¢ƒ</h3><p>Required</p>
<ul>
<li>OS X</li>
<li>HomeBrew</li>
<li>Node.js</li>
<li>Git</li>
<li>Hexo</li>
<li>Github</li>
</ul>
<p>Optional</p>
<ul>
<li>ç™¾åº¦ç»Ÿè®¡è´¦æˆ·</li>
<li>åŸŸå</li>
<li>DNSPodè´¦æˆ·</li>
</ul>
<h3 id="é…ç½®åŸºæœ¬ç¯å¢ƒ">é…ç½®åŸºæœ¬ç¯å¢ƒ</h3><p>å®‰è£…hexoå‰å…ˆé…ç½®å¥½åŸºæœ¬ç¯å¢ƒï¼Œæœ‰</p>
<ul>
<li>HomeBrew</li>
<li>Git</li>
<li>Node.js</li>
</ul>
<p>å®‰è£…å®Œåæµ‹è¯•ï¼Œæ‰“å¼€<code>Terminal</code>æˆ–è€…<code>iTerm</code>ï¼Œé”®å…¥â€œnpmâ€ï¼Œå‡ºç°</p>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Usage</span>: <span class="string">npm &lt;command&gt;</span></span><br></pre></td></tr></table></figure>
<p>è¡¨ç¤ºNode.jså·²å®‰è£…æˆåŠŸã€‚åŒç†ï¼Œé”®å…¥â€œgitâ€ï¼Œæ¥æ£€æµ‹Gitæ˜¯å¦å®‰è£…æˆåŠŸã€‚</p>
<h3 id="å®‰è£…Hexo">å®‰è£…Hexo</h3><p>ç›´æ¥è¾“å…¥</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="operator"><span class="keyword">install</span> hexo-cli -<span class="keyword">g</span></span></span><br></pre></td></tr></table></figure>
<p>Hexoä½¿ç”¨-gå‚æ•°å®‰è£…åˆ°å…¨å±€ï¼Œnpmå‰æœ€å¥½åŠ ä¸Šsudoï¼Œé¿å…æŠ¥æƒé™é”™è¯¯ã€‚</p>
<p>è‡³æ­¤å®‰è£…å®Œæ¯•ï¼Œæ›´å¤šç»†èŠ‚å‚ç…§Hexoçš„<a href="https://hexo.io/" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<h3 id="Hexoçš„å»ºç«™ä¸é…ç½®">Hexoçš„å»ºç«™ä¸é…ç½®</h3><p>Hexoçš„<a href="https://hexo.io/" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ã€‚</p>
<p>Hexoçš„<a href="https://hexo.io/themes/" target="_blank" rel="external">å®˜æ–¹ä¸»é¢˜</a>ã€‚</p>
<h4 id="éƒ¨ç½²åˆ°Github">éƒ¨ç½²åˆ°Github</h4><p>æƒ³è¦éƒ¨ç½²ï¼Œé¦–å…ˆä½ å¾—æœ‰Githubï¼Œè¿™æ— éœ€å¤šè¨€ã€‚</p>
<p>éƒ¨ç½²åˆ°GitHubä¸Šå…¶å®ä¹Ÿéå¸¸ç®€å•ï¼Œæ‰“å¼€ç«™ç‚¹é…ç½®æ–‡ä»¶_config.ymlï¼š</p>
<figure class="highlight julia"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Deployment</span></span><br><span class="line"><span class="comment">## Docs: http://hexo.io/docs/deployment.html</span></span><br><span class="line">deploy:</span><br><span class="line">    <span class="keyword">type</span>: github <span class="comment">#éƒ¨ç½²å·¥å…·çš„ç±»å‹ </span></span><br><span class="line">    repository:git<span class="macrocall">@github</span>.com:username/username.github.io.git <span class="comment">#SSHé“¾æ¥</span></span><br><span class="line">    branch: master <span class="comment">#åˆ†æ”¯</span></span><br></pre></td></tr></table></figure>
<h4 id="ç»‘å®šåŸŸå">ç»‘å®šåŸŸå</h4><p>å…ˆä¸Š<a href="https://www.godaddy.com/" target="_blank" rel="external">ç‹—çˆ¹</a>è´­ä¹°ï¼Œè¾“å…¥ä½ å–œæ¬¢çš„åŸŸåï¼Œæ£€æµ‹æ˜¯å¦å·²è¢«ä½¿ç”¨ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-birth234048-0933cd8c83f7f7e5.png" alt="firstIMG"></p>
<p>é€‰ä¸€ä¸ªæ²¡è¢«takençš„åŸŸåï¼Œä¹°ä¸‹æ¥ã€‚</p>
<p>å†è®¾ç½®DNSï¼Œç”¨DNSpodï¼Œå¿«ï¼Œå…è´¹ï¼Œç¨³å®šã€‚</p>
<p>æ³¨å†Œ<a href="https://www.dnspod.cn" target="_blank" rel="external">DNSpod</a>ï¼Œæ·»åŠ åŸŸåï¼Œå¦‚ä¸‹å›¾è®¾ç½®ã€‚</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-birth234048-05f6dbe1c03be571.png" alt="Paste_Image.png"></p>
<p>æœ€ååœ¨<a href="https://www.godaddy.com/" target="_blank" rel="external">ç‹—çˆ¹</a>ä¿®æ”¹DNSåœ°å€ï¼Œå¦‚å›¾æ‰€ç¤º</p>
<p><img src="http://7xnmlk.com1.z0.glb.clouddn.com/blog-birth234048-4b0266fc39370f70.png" alt="Paste_Image.png"></p>
<p>ç„¶åé™å¾…DNSè§£æå®Œæ¯•ï¼Œå°±å¯ä»¥é€šè¿‡ä½ çš„åŸŸåæ¥è®¿é—®äº†ã€‚</p>
<h4 id="æ­å»ºå®Œæˆ">æ­å»ºå®Œæˆ</h4><p>è‡³æ­¤ï¼Œå°±ç®—æ­å»ºå®Œæˆï¼Œå¦‚éœ€è¿›æ­¥ä¸€å®Œå–„è¯·å‚è€ƒHexo<a href="https://hexo.io/" target="_blank" rel="external">å®˜æ–¹æ–‡æ¡£</a>ï¼Œæ–‡ç« æ•´ç†éš¾å…æœ‰ç–æ¼ï¼Œå¦‚æœæœ‰é”™è¯¯çš„åœ°æ–¹è¯·ç•™è¨€é€šçŸ¥æˆ‘æ›´æ”¹ï¼Œè¿‡ç¨‹ä¸­æœ‰ç–‘é—®çš„ä¹Ÿå¯ä»¥ç•™è¨€ï¼Œæˆ‘çœ‹åˆ°äº†ä¼šå°½å¿«è§£å†³ï¼</p>
]]></content>
    <summary type="html">
    <![CDATA[<h3 id="å‰è¨€">å‰è¨€</h3><p>è¿™æ˜¯æœ¬åšå®¢çš„ç¬¬ä¸€ç¯‡æ–‡ç« ï¼Œç”¨æ¥è®°å½•è¿™ä¸ªç½‘ç«™çš„è¯ç”Ÿè¿‡ç¨‹ã€‚</p>]]>
    
    </summary>
    
      <category term="hexo" scheme="http://v2panda.com/tags/hexo/"/>
    
  </entry>
  
</feed>
